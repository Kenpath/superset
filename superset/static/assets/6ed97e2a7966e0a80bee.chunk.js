/*! For license information please see 6ed97e2a7966e0a80bee.chunk.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{1685:function(t,e,i){var s;!function(n,o,a){if(n){for(var r,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},h={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)l[111+d]="f"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();_.prototype.bind=function(t,e,i){return t=t instanceof Array?t:[t],this._bindMultiple.call(this,t,e,i),this},_.prototype.unbind=function(t,e){return this.bind.call(this,t,(function(){}),e)},_.prototype.trigger=function(t,e){return this._directMap[t+":"+e]&&this._directMap[t+":"+e]({},t),this},_.prototype.reset=function(){return this._callbacks={},this._directMap={},this},_.prototype.stopCallback=function(t,e){return!((" "+e.className+" ").indexOf(" mousetrap ")>-1)&&(!function t(e,i){return null!==e&&e!==o&&(e===i||t(e.parentNode,i))}(e,this.target)&&("INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable))},_.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},_.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(l[e]=t[e]);r=null},_.init=function(){var t=_(o);for(var e in t)"_"!==e.charAt(0)&&(_[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},_.init(),n.Mousetrap=_,t.exports&&(t.exports=_),void 0===(s=function(){return _}.call(e,i,e,t))||(t.exports=s)}function p(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function g(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return l[t.which]?l[t.which]:h[t.which]?h[t.which]:String.fromCharCode(t.which).toLowerCase()}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function m(t,e,i){return i||(i=function(){if(!r)for(var t in r={},l)t>95&&t<112||l.hasOwnProperty(t)&&(r[l[t]]=t);return r}()[t]?"keydown":"keypress"),"keypress"==i&&e.length&&(i="keydown"),i}function v(t,e){var i,s,n,o=[];for(i=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),n=0;n<i.length;++n)s=i[n],c[s]&&(s=c[s]),e&&"keypress"!=e&&u[s]&&(s=u[s],o.push("shift")),f(s)&&o.push(s);return{key:s,modifiers:o,action:e=m(s,o,e)}}function _(t){var e=this;if(t=t||o,!(e instanceof _))return new _(t);e.target=t,e._callbacks={},e._directMap={};var i,s={},n=!1,a=!1,r=!1;function l(t){t=t||{};var e,i=!1;for(e in s)t[e]?i=!0:s[e]=0;i||(r=!1)}function h(t,i,n,o,a,r){var l,h,u,c,d=[],p=n.type;if(!e._callbacks[t])return[];for("keyup"==p&&f(t)&&(i=[t]),l=0;l<e._callbacks[t].length;++l)if(h=e._callbacks[t][l],(o||!h.seq||s[h.seq]==h.level)&&p==h.action&&("keypress"==p&&!n.metaKey&&!n.ctrlKey||(u=i,c=h.modifiers,u.sort().join(",")===c.sort().join(",")))){var g=!o&&h.combo==a,m=o&&h.seq==o&&h.level==r;(g||m)&&e._callbacks[t].splice(l,1),d.push(h)}return d}function u(t,i,s,n){e.stopCallback(i,i.target||i.srcElement,s,n)||!1===t(i,s)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(i),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(i))}function c(t){"number"!=typeof t.which&&(t.which=t.keyCode);var i=g(t);i&&("keyup"!=t.type||n!==i?e.handleKey(i,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):n=!1)}function d(t,e,o,a){function h(e){return function(){r=e,++s[t],clearTimeout(i),i=setTimeout(l,1e3)}}function c(e){u(o,e,t),"keyup"!==a&&(n=g(e)),setTimeout(l,10)}s[t]=0;for(var d=0;d<e.length;++d){var p=d+1===e.length?c:h(a||v(e[d+1]).action);m(e[d],p,a,t,d)}}function m(t,i,s,n,o){e._directMap[t+":"+s]=i;var a,r=(t=t.replace(/\s+/g," ")).split(" ");r.length>1?d(t,r,i,s):(a=v(t,s),e._callbacks[a.key]=e._callbacks[a.key]||[],h(a.key,a.modifiers,{type:a.action},n,t,o),e._callbacks[a.key][n?"unshift":"push"]({callback:i,modifiers:a.modifiers,action:a.action,seq:n,level:o,combo:t}))}e._handleKey=function(t,e,i){var s,n=h(t,e,i),o={},c=0,d=!1;for(s=0;s<n.length;++s)n[s].seq&&(c=Math.max(c,n[s].level));for(s=0;s<n.length;++s)if(n[s].seq){if(n[s].level!=c)continue;d=!0,o[n[s].seq]=1,u(n[s].callback,i,n[s].combo,n[s].seq)}else d||u(n[s].callback,i,n[s].combo);var p="keypress"==i.type&&a;i.type!=r||f(t)||p||l(o),a=d&&"keydown"==i.type},e._bindMultiple=function(t,e,i){for(var s=0;s<t.length;++s)m(t[s],e,i)},p(t,"keypress",c),p(t,"keydown",c),p(t,"keyup",c)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},4640:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var s=i(4644),n=i(167);const o=[-90,90],a=[-180,180];function r(t,e,i){let[s,n]=t,[o,a]=e;return void 0===i&&(i=.25),s<n?[s,n]:[Math.max(o,s-i),Math.min(a,n+i)]}function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function h(t,e){let{points:i,width:h,height:u,minExtent:c,maxZoom:d,offset:p,padding:g=20}=e;const{bearing:f,pitch:m}=t,v=function(t){const e=r(Object(n.extent)(t,t=>t[1]),o),i=r(Object(n.extent)(t,t=>t[0]),a);return[[i[0],e[0]],[i[1],e[1]]]}(i);try{return l({},Object(s.c)({bounds:v,width:h,height:u,minExtent:c,maxZoom:d,offset:p,padding:g}),{bearing:f,pitch:m})}catch(t){console.error("Could not fit viewport",t)}return t}},4646:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i(37),n=i.n(s);const o=[1,0,1,0,0,0,0];function a(t,e){const i=parseInt(n()(e).format("x"),10);return parseInt(n()(e).add(t).format("x"),10)-i}function r(t,e){const i=n()(Number(t.reduce((t,e)=>t<e?t:e))),s=n()(Number(t.reduce((t,e)=>t>e?t:e)));let r,l,h;if(e.includes("/")){const t=e.split("/",2);t[0].endsWith("Z")?(l=n()(t[0]),r=n.a.duration(t[1])):(l=n()(t[1]),r=n.a.duration(t[0]))}else r=n.a.duration(e),l=function(t,e){const i=n()(t).subtract(e),s=t.toArray(),a=i.toArray(),r=s.map((t,e)=>a[e]!==t).indexOf(!0),l=s.map((t,e)=>{if(e===r){const i=t-a[e];return t-(t-o[e])%i}return e<r||-1===r?t:o[e]});return n()(l)}(i,r);const u=i.valueOf();for(h=l.clone();h.valueOf()<u;)h.add(r);for(;h.valueOf()>u;)h.subtract(r);let c;const d=s.valueOf();for(c=l.clone();c.valueOf()>d;)c.subtract(r);for(;c.valueOf()<d;)c.add(r);const p=null!=e?[h,h.clone().add(r)]:[h,c],g=t.every(t=>null===t);return{start:parseInt(h.format("x"),10),end:parseInt(c.format("x"),10),getStep:a.bind(this,r),values:p.map(t=>parseInt(t.format("x"),10)),disabled:g}}},4648:function(t,e,i){"use strict";i.d(e,"a",(function(){return _}));var s=i(0),n=i.n(s),o=i(2),a=i.n(o),r=i(4647),l=i(1685),h=i.n(l),u=i(13),c=i(4654),d=i.n(c);i(4656),i(4657);function p(t){return n.a.createElement("span",{className:"BootstrapSliderWrapper"},n.a.createElement(d.a,t))}i(4658);const g={start:a.a.number.isRequired,step:a.a.number.isRequired,end:a.a.number.isRequired,values:a.a.array.isRequired,onChange:a.a.func,loopDuration:a.a.number,maxFrames:a.a.number,orientation:a.a.oneOf(["horizontal","vertical"]),reversed:a.a.bool,disabled:a.a.bool,range:a.a.bool};class f extends n.a.PureComponent{constructor(t){super(t),this.state={intervalId:null};const e=t.end-t.start,i=Math.min(t.maxFrames,e/t.step),s=e/i;this.intervalMilliseconds=t.loopDuration/i,this.increment=s<t.step?t.step:s-s%t.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){h.a.bind(["space"],this.play)}componentWillUnmount(){h.a.unbind(["space"])}onChange(t){this.props.onChange(t.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const t=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:t})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:t,end:e,step:i,values:s,disabled:n}=this.props;if(n)return;const o=(Array.isArray(s)?s:[s,s+i]).map(t=>t+this.increment),a=o[1]>e?o[0]-t:0;this.props.onChange(o.map(t=>t-a))}stepBackward(){const{start:t,end:e,step:i,values:s,disabled:n}=this.props;if(n)return;const o=(Array.isArray(s)?s:[s,s+i]).map(t=>t-this.increment),a=o[0]<t?e-o[1]:0;this.props.onChange(o.map(t=>t+a))}formatter(t){if(this.props.disabled)return Object(u.e)("Data has no time steps");let e=t;return Array.isArray(t)?t[0]===t[1]&&(e=[t[0]]):e=[t],e.map(t=>new Date(t).toUTCString()).join(" : ")}render(){const{start:t,end:e,step:i,orientation:s,reversed:o,disabled:a,range:r,values:l}=this.props;return n.a.createElement("div",{className:"play-slider"},n.a.createElement("div",{className:"play-slider-controls padded"},n.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),n.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),n.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),n.a.createElement("div",{className:"play-slider-scrobbler padded"},n.a.createElement(p,{value:r?l:l[0],range:r,formatter:this.formatter,change:this.onChange,min:t,max:e,step:i,orientation:s,reversed:o,disabled:a?"disabled":"enabled"})))}}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}f.propTypes=g,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const v={getLayers:a.a.func.isRequired,start:a.a.number.isRequired,end:a.a.number.isRequired,getStep:a.a.func,values:a.a.array.isRequired,aggregation:a.a.bool,disabled:a.a.bool,viewport:a.a.object.isRequired,children:a.a.node,mapStyle:a.a.string,mapboxApiAccessToken:a.a.string.isRequired,setControlValue:a.a.func,onValuesChange:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired};class _ extends n.a.PureComponent{constructor(){super(...arguments),m(this,"containerRef",n.a.createRef()),m(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)})}render(){const{start:t,end:e,getStep:i,disabled:s,aggregation:o,children:a,getLayers:l,values:h,onValuesChange:u,viewport:c,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,height:m,width:v}=this.props,_=l(h);return n.a.createElement("div",null,n.a.createElement(r.a,{ref:this.containerRef,viewport:c,layers:_,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,bottomMargin:s?0:20,width:v,height:m}),!s&&n.a.createElement(f,{start:t,end:e,step:i(t),values:h,range:!o,onChange:u}),a)}}_.propTypes=v,_.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},4652:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return l}));const s={SUM:1,MEAN:2,MIN:3,MAX:4};function n(t,e){return t+e}function o(t,e){return e>t?e:t}function a(t,e){return e<t?e:t}function r(t,e,i){const r=s[t]||s.SUM;switch(e=function(t,e={}){if(Number.isFinite(t))return t;return i=>(e.index=i.index,t(i.source,e))}(e,i),r){case s.MIN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(a,1/0):null}(t,e);case s.SUM:return t=>function(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(n,0):null}(t,e);case s.MEAN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(n,0)/i.length:null}(t,e);case s.MAX:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(o,-1/0):null}(t,e);default:return null}}function l(t,e={}){return i=>(e.indices=i.map(t=>t.index),t(i.map(t=>t.source),e))}},4654:function(t,e,i){var s,n,o;n=[e,i(90),i(217),i(265),i(255),i(256),i(0),i(2),i(4655)],void 0===(o="function"==typeof(s=function(t,e,i,s,n,o,a,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactBootstrapSlider=void 0;var h=v(e),u=v(i),c=v(s),d=v(n),p=v(o),g=v(a),f=v(r),m=v(l);function v(t){return t&&t.__esModule?t:{default:t}}var _=t.ReactBootstrapSlider=function(t){function e(){var t,i,s,n;(0,u.default)(this,e);for(var o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];return i=s=(0,d.default)(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(a))),s.checkAndDoDisabled=function(){var t="disabled"!==s.props.disabled,e=s.mySlider.isEnabled();t?e||s.mySlider.enable():e&&s.mySlider.disable()},s.updateSliderValues=function(){void 0===s.props.min||void 0===s.mySlider.min&&void 0===s.mySlider.options.min||s.mySlider.setAttribute("min",s.props.min),void 0===s.props.max||void 0===s.mySlider.max&&void 0===s.mySlider.options.max||s.mySlider.setAttribute("max",s.props.max),void 0===s.props.step||void 0===s.mySlider.step&&void 0===s.mySlider.options.step||s.mySlider.setAttribute("step",s.props.step),s.mySlider.setValue(s.props.value),s.checkAndDoDisabled()},n=i,(0,d.default)(s,n)}return(0,p.default)(e,t),(0,c.default)(e,[{key:"componentDidMount",value:function(){var t=this,e=(0,h.default)({},this.props,{tooltip:this.props.tooltip||"show"});if(this.mySlider=new m.default(this.node,e),this.props.change||this.props.handleChange){var i=this.props.change||this.props.handleChange;this.mySlider.on("change",(function(t){var e={target:{}};e.target.value=t.newValue,i(e)}))}this.props.slideStop&&this.mySlider.on("slideStop",(function(e){var i={target:{}};i.target.value=e,t.props.slideStop(i)})),this.checkAndDoDisabled()}},{key:"componentDidUpdate",value:function(){this.updateSliderValues()}},{key:"componentWillUnmount",value:function(){this.mySlider.destroy()}},{key:"render",value:function(){var t=this;return g.default.createElement("div",{ref:function(e){return t.node=e}})}}]),e}(g.default.Component);_.propTypes={min:f.default.number,max:f.default.number,step:f.default.number,value:f.default.oneOfType([f.default.number,f.default.arrayOf(f.default.number.isRequired).isRequired]).isRequired,disabled:f.default.string,tooltip:f.default.string,change:f.default.func,handleChange:f.default.func,slideStop:f.default.func,labelledby:f.default.oneOfType([f.default.string,f.default.arrayOf(f.default.string)])},t.default=_})?s.apply(e,n):s)||(t.exports=o)},4655:function(t,e,i){"use strict";var s,n,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="object"===("undefined"==typeof window?"undefined":a(window));n=[i(107)],void 0===(o="function"==typeof(s=function(t){var e;return r&&!window.console&&(window.console={}),r&&!window.console.log&&(window.console.log=function(){}),r&&!window.console.warn&&(window.console.warn=function(){}),function(t){var e=Array.prototype.slice;function i(){}!function(t){if(t){var s="undefined"==typeof console?i:function(t){console.error(t)};t.bridget=function(i,n){!function(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}(n),function(i,n){t.fn[i]=function(o){if("string"==typeof o){for(var a=e.call(arguments,1),r=0,l=this.length;r<l;r++){var h=this[r],u=t.data(h,i);if(u)if(t.isFunction(u[o])&&"_"!==o.charAt(0)){var c=u[o].apply(u,a);if(void 0!==c&&c!==u)return c}else s("no such method '"+o+"' for "+i+" instance");else s("cannot call methods on "+i+" prior to initialization; attempted to call '"+o+"'")}return this}var d=this.map((function(){var e=t.data(this,i);return e?(e.option(o),e._init()):(e=new n(this,o),t.data(this,i,e)),t(this)}));return!d||d.length>1?d:d[0]}}(i,n)},t.bridget}}(t)}(t),function(t){var i=function(t){return"Invalid input value '"+t+"' passed in"},s={linear:{toValue:function(t){var e=t/100*(this.options.max-this.options.min),i=!0;if(this.options.ticks_positions.length>0){for(var s,n,o,a=0,r=1;r<this.options.ticks_positions.length;r++)if(t<=this.options.ticks_positions[r]){s=this.options.ticks[r-1],o=this.options.ticks_positions[r-1],n=this.options.ticks[r],a=this.options.ticks_positions[r];break}e=s+(t-o)/(a-o)*(n-s),i=!1}var l=(i?this.options.min:0)+Math.round(e/this.options.step)*this.options.step;return l<this.options.min?this.options.min:l>this.options.max?this.options.max:l},toPercentage:function(t){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var e,i,s,n=0,o=0;o<this.options.ticks.length;o++)if(t<=this.options.ticks[o]){e=o>0?this.options.ticks[o-1]:0,s=o>0?this.options.ticks_positions[o-1]:0,i=this.options.ticks[o],n=this.options.ticks_positions[o];break}if(o>0)return s+(t-e)/(i-e)*(n-s)}return 100*(t-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(t){var e=0===this.options.min?0:Math.log(this.options.min),i=Math.log(this.options.max),s=Math.exp(e+(i-e)*t/100);return Math.round(s)===this.options.max?this.options.max:(s=this.options.min+Math.round((s-this.options.min)/this.options.step)*this.options.step)<this.options.min?this.options.min:s>this.options.max?this.options.max:s},toPercentage:function(t){if(this.options.max===this.options.min)return 0;var e=Math.log(this.options.max),i=0===this.options.min?0:Math.log(this.options.min);return 100*((0===t?0:Math.log(t))-i)/(e-i)}}};function n(e,i){this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:!1,over:!1},this.ticksCallbackMap={},this.handleCallbackMap={},"string"==typeof e?this.element=document.querySelector(e):e instanceof HTMLElement&&(this.element=e),i=i||{};for(var n=Object.keys(this.defaultOptions),o=0;o<n.length;o++){var a=n[o],r=i[a];r=null!==(r=void 0!==r?r:l(this.element,a))?r:this.defaultOptions[a],this.options||(this.options={}),this.options[a]=r}function l(t,e){var i="data-slider-"+e.replace(/_/g,"-"),s=t.getAttribute(i);try{return JSON.parse(s)}catch(t){return s}}"auto"===this.options.rtl&&(this.options.rtl="rtl"===window.getComputedStyle(this.element).direction),"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.rtl?this.options.tooltip_position="left":this.options.tooltip_position="right";var h,u,c,d,p,g=this.element.style.width,f=!1,m=this.element.parentNode;if(this.sliderElem)f=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var v=document.createElement("div");v.className="slider-track",(u=document.createElement("div")).className="slider-track-low",(h=document.createElement("div")).className="slider-selection",(c=document.createElement("div")).className="slider-track-high",(d=document.createElement("div")).className="slider-handle min-slider-handle",d.setAttribute("role","slider"),d.setAttribute("aria-valuemin",this.options.min),d.setAttribute("aria-valuemax",this.options.max),(p=document.createElement("div")).className="slider-handle max-slider-handle",p.setAttribute("role","slider"),p.setAttribute("aria-valuemin",this.options.min),p.setAttribute("aria-valuemax",this.options.max),v.appendChild(u),v.appendChild(h),v.appendChild(c),this.rangeHighlightElements=[];var _=this.options.rangeHighlights;if(Array.isArray(_)&&_.length>0)for(var b=0;b<_.length;b++){var y=document.createElement("div"),x=_[b].class||"";y.className="slider-rangeHighlight slider-selection "+x,this.rangeHighlightElements.push(y),v.appendChild(y)}var C=Array.isArray(this.options.labelledby);if(C&&this.options.labelledby[0]&&d.setAttribute("aria-labelledby",this.options.labelledby[0]),C&&this.options.labelledby[1]&&p.setAttribute("aria-labelledby",this.options.labelledby[1]),!C&&this.options.labelledby&&(d.setAttribute("aria-labelledby",this.options.labelledby),p.setAttribute("aria-labelledby",this.options.labelledby)),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(this.ticksContainer=document.createElement("div"),this.ticksContainer.className="slider-tick-container",o=0;o<this.options.ticks.length;o++){var w=document.createElement("div");if(w.className="slider-tick",this.options.ticks_tooltip){var M=this._addTickListener(),E=M.addMouseEnter(this,w,o),S=M.addMouseLeave(this,w);this.ticksCallbackMap[o]={mouseEnter:E,mouseLeave:S}}this.ticks.push(w),this.ticksContainer.appendChild(w)}h.className+=" tick-slider-selection"}if(this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",o=0;o<this.options.ticks_labels.length;o++){var A=document.createElement("div"),k=0===this.options.ticks_positions.length,P=this.options.reversed&&k?this.options.ticks_labels.length-(o+1):o;A.className="slider-tick-label",A.innerHTML=this.options.ticks_labels[P],this.tickLabels.push(A),this.tickLabelContainer.appendChild(A)}var T=function(t){var e=document.createElement("div");e.className="tooltip-arrow";var i=document.createElement("div");i.className="tooltip-inner",t.appendChild(e),t.appendChild(i)},O=document.createElement("div");O.className="tooltip tooltip-main",O.setAttribute("role","presentation"),T(O);var L=document.createElement("div");L.className="tooltip tooltip-min",L.setAttribute("role","presentation"),T(L);var N=document.createElement("div");N.className="tooltip tooltip-max",N.setAttribute("role","presentation"),T(N),this.sliderElem.appendChild(v),this.sliderElem.appendChild(O),this.sliderElem.appendChild(L),this.sliderElem.appendChild(N),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),this.ticksContainer&&this.sliderElem.appendChild(this.ticksContainer),this.sliderElem.appendChild(d),this.sliderElem.appendChild(p),m.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(t&&(this.$element=t(this.element),this.$sliderElem=t(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.touchX=0,this.touchY=0,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),s[this.options.scale]&&(this.options.scale=s[this.options.scale]),!0===f&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.sliderElem,"slider-rtl"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","right","top","width","height"].forEach((function(t){this._removeProperty(this.trackLow,t),this._removeProperty(this.trackSelection,t),this._removeProperty(this.trackHigh,t)}),this),[this.handle1,this.handle2].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top")}),this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top"),this._removeProperty(t,"margin-left"),this._removeProperty(t,"margin-right"),this._removeProperty(t,"margin-top"),this._removeClass(t,"right"),this._removeClass(t,"left"),this._removeClass(t,"top")}),this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=g,this.options.orientation="horizontal",this.options.rtl?this.stylePos="right":this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this.options.rtl&&this._addClass(this.sliderElem,"slider-rtl"),this._setTooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this.options.range?this._state.value=[this.options.value,this.options.max]:this._state.value=this.options.value,this.trackLow=u||this.trackLow,this.trackSelection=h||this.trackSelection,this.trackHigh=c||this.trackHigh,"none"===this.options.selection?(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")):"after"!==this.options.selection&&"before"!==this.options.selection||(this._removeClass(this.trackLow,"hide"),this._removeClass(this.trackSelection,"hide"),this._removeClass(this.trackHigh,"hide")),this.handle1=d||this.handle1,this.handle2=p||this.handle2,!0===f)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),o=0;o<this.ticks.length;o++)this._removeClass(this.ticks[o],"round triangle hide");if(-1!==["round","triangle","custom"].indexOf(this.options.handle))for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),o=0;o<this.ticks.length;o++)this._addClass(this.ticks[o],this.options.handle);if(this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchstart=this._touchstart.bind(this),this.touchmove=this._touchmove.bind(this),this.touchCapable){var D=!1;try{var R=Object.defineProperty({},"passive",{get:function(){D=!0}});window.addEventListener("test",null,R)}catch(t){}var F=!!D&&{passive:!0};this.sliderElem.addEventListener("touchstart",this.touchstart,F),this.sliderElem.addEventListener("touchmove",this.touchmove,F)}if(this.sliderElem.addEventListener("mousedown",this.mousedown,!1),this.resize=this._resize.bind(this),window.addEventListener("resize",this.resize,!1),"hide"===this.options.tooltip)this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide");else if("always"===this.options.tooltip)this._showTooltip(),this._alwaysShowTooltip=!0;else{if(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.options.ticks_tooltip){var I=this._addTickListener(),z=I.addMouseEnter(this,this.handle1),j=I.addMouseLeave(this,this.handle1);this.handleCallbackMap.handle1={mouseEnter:z,mouseLeave:j},z=I.addMouseEnter(this,this.handle2),j=I.addMouseLeave(this,this.handle2),this.handleCallbackMap.handle2={mouseEnter:z,mouseLeave:j}}else this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1);this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)}this.options.enabled?this.enable():this.disable()}if((e=function(t,e){return n.call(this,t,e),this}).prototype={_init:function(){},constructor:e,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,rtl:"auto",enabled:!0,formatter:function(t){return Array.isArray(t)?t[0]+" : "+t[1]:t},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,ticks_tooltip:!1,scale:"linear",focus:!1,tooltip_position:null,labelledby:null,rangeHighlights:[]},getElement:function(){return this.sliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(t,e,i){t||(t=0);var s=this.getValue();this._state.value=this._validateInputValue(t);var n=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=n(this._state.value[0]),this._state.value[1]=n(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=n(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),"after"===this.options.selection?this._state.value[1]=this.options.max:this._state.value[1]=this.options.min),this.options.max>this.options.min?this._state.percentage=[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:this._state.percentage=[0,0,100],this._layout();var o=this.options.range?this._state.value:this._state.value[0];return this._setDataVal(o),!0===e&&this._trigger("slide",o),s!==o&&!0===i&&this._trigger("change",{oldValue:s,newValue:o}),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),t&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(t,e){return this._bindNonQueryEventHandler(t,e),this},off:function(e,i){t?(this.$element.off(e,i),this.$sliderElem.off(e,i)):this._unbindNonQueryEventHandler(e,i)},getAttribute:function(t){return t?this.options[t]:this.options},setAttribute:function(t,e){return this.options[t]=e,this},refresh:function(){return this._removeSliderEventHandlers(),n.call(this,this.element,this.options),t&&t.data(this.element,"slider",this),this},relayout:function(){return this._resize(),this._layout(),this},_removeSliderEventHandlers:function(){if(this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.options.ticks_tooltip){for(var t=this.ticksContainer.getElementsByClassName("slider-tick"),e=0;e<t.length;e++)t[e].removeEventListener("mouseenter",this.ticksCallbackMap[e].mouseEnter,!1),t[e].removeEventListener("mouseleave",this.ticksCallbackMap[e].mouseLeave,!1);this.handle1.removeEventListener("mouseenter",this.handleCallbackMap.handle1.mouseEnter,!1),this.handle2.removeEventListener("mouseenter",this.handleCallbackMap.handle2.mouseEnter,!1),this.handle1.removeEventListener("mouseleave",this.handleCallbackMap.handle1.mouseLeave,!1),this.handle2.removeEventListener("mouseleave",this.handleCallbackMap.handle2.mouseLeave,!1)}this.handleCallbackMap=null,this.ticksCallbackMap=null,this.showTooltip&&(this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle2.removeEventListener("focus",this.showTooltip,!1)),this.hideTooltip&&(this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("blur",this.hideTooltip,!1)),this.showTooltip&&this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.hideTooltip&&this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.touchstart,!1),this.sliderElem.removeEventListener("touchmove",this.touchmove,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1),window.removeEventListener("resize",this.resize,!1)},_bindNonQueryEventHandler:function(t,e){void 0===this.eventToCallbackMap[t]&&(this.eventToCallbackMap[t]=[]),this.eventToCallbackMap[t].push(e)},_unbindNonQueryEventHandler:function(t,e){var i=this.eventToCallbackMap[t];if(void 0!==i)for(var s=0;s<i.length;s++)if(i[s]===e){i.splice(s,1);break}},_cleanUpEventCallbacksMap:function(){for(var t=Object.keys(this.eventToCallbackMap),e=0;e<t.length;e++){var i=t[e];delete this.eventToCallbackMap[i]}},_showTooltip:function(){!1===this.options.tooltip_split?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hideTooltip:function(){!1===this._state.inDrag&&!0!==this.alwaysShowTooltip&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_setToolTipOnMouseOver:function(t){var e=this.options.formatter(t?t.value[0]:this._state.value[0]),i=s(t||this._state,this.options.reversed);function s(t,e){return e?[100-t.percentage[0],this.options.range?100-t.percentage[1]:t.percentage[1]]:[t.percentage[0],t.percentage[1]]}this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=i[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px")},_addTickListener:function(){return{addMouseEnter:function(t,e,i){var s=function(){var e=t._state,s=i>=0?i:this.attributes["aria-valuenow"].value,n=parseInt(s,10);e.value[0]=n,e.percentage[0]=t.options.ticks_positions[n],t._setToolTipOnMouseOver(e),t._showTooltip()};return e.addEventListener("mouseenter",s,!1),s},addMouseLeave:function(t,e){var i=function(){t._hideTooltip()};return e.addEventListener("mouseleave",i,!1),i}}},_layout:function(){var t,e;if(t=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=t[0]+"%",this.handle1.setAttribute("aria-valuenow",this._state.value[0]),isNaN(this.options.formatter(this._state.value[0]))&&this.handle1.setAttribute("aria-valuetext",this.options.formatter(this._state.value[0])),this.handle2.style[this.stylePos]=t[1]+"%",this.handle2.setAttribute("aria-valuenow",this._state.value[1]),isNaN(this.options.formatter(this._state.value[1]))&&this.handle2.setAttribute("aria-valuetext",this.options.formatter(this._state.value[1])),this.rangeHighlightElements.length>0&&Array.isArray(this.options.rangeHighlights)&&this.options.rangeHighlights.length>0)for(var i=0;i<this.options.rangeHighlights.length;i++){var s=this._toPercentage(this.options.rangeHighlights[i].start),n=this._toPercentage(this.options.rangeHighlights[i].end);if(this.options.reversed){var o=100-n;n=100-s,s=o}var a=this._createHighlightRange(s,n);a?"vertical"===this.options.orientation?(this.rangeHighlightElements[i].style.top=a.start+"%",this.rangeHighlightElements[i].style.height=a.size+"%"):(this.options.rtl?this.rangeHighlightElements[i].style.right=a.start+"%":this.rangeHighlightElements[i].style.left=a.start+"%",this.rangeHighlightElements[i].style.width=a.size+"%"):this.rangeHighlightElements[i].style.display="none"}if(Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var r,l="vertical"===this.options.orientation?"height":"width";r="vertical"===this.options.orientation?"marginTop":this.options.rtl?"marginRight":"marginLeft";var h=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var u=0;if(0===this.options.ticks_positions.length)"vertical"!==this.options.orientation&&(this.tickLabelContainer.style[r]=-h/2+"px"),u=this.tickLabelContainer.offsetHeight;else for(c=0;c<this.tickLabelContainer.childNodes.length;c++)this.tickLabelContainer.childNodes[c].offsetHeight>u&&(u=this.tickLabelContainer.childNodes[c].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=u+"px")}for(var c=0;c<this.options.ticks.length;c++){var d=this.options.ticks_positions[c]||this._toPercentage(this.options.ticks[c]);this.options.reversed&&(d=100-d),this.ticks[c].style[this.stylePos]=d+"%",this._removeClass(this.ticks[c],"in-selection"),this.options.range?d>=t[0]&&d<=t[1]&&this._addClass(this.ticks[c],"in-selection"):"after"===this.options.selection&&d>=t[0]?this._addClass(this.ticks[c],"in-selection"):"before"===this.options.selection&&d<=t[0]&&this._addClass(this.ticks[c],"in-selection"),this.tickLabels[c]&&(this.tickLabels[c].style[l]=h+"px","vertical"!==this.options.orientation&&void 0!==this.options.ticks_positions[c]?(this.tickLabels[c].style.position="absolute",this.tickLabels[c].style[this.stylePos]=d+"%",this.tickLabels[c].style[r]=-h/2+"px"):"vertical"===this.options.orientation&&(this.options.rtl?this.tickLabels[c].style.marginRight=this.sliderElem.offsetWidth+"px":this.tickLabels[c].style.marginLeft=this.sliderElem.offsetWidth+"px",this.tickLabelContainer.style[r]=this.sliderElem.offsetWidth/2*-1+"px"))}}if(this.options.range){e=this.options.formatter(this._state.value),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=(t[1]+t[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");var p=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,p);var g=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,g),this.tooltip_min.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=t[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetWidth/2+"px")}else e=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(t[0],t[1])+"%",this.trackSelection.style.top=Math.min(t[0],t[1])+"%",this.trackSelection.style.height=Math.abs(t[0]-t[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";else{"right"===this.stylePos?this.trackLow.style.right="0":this.trackLow.style.left="0",this.trackLow.style.width=Math.min(t[0],t[1])+"%","right"===this.stylePos?this.trackSelection.style.right=Math.min(t[0],t[1])+"%":this.trackSelection.style.left=Math.min(t[0],t[1])+"%",this.trackSelection.style.width=Math.abs(t[0]-t[1])+"%","right"===this.stylePos?this.trackHigh.style.left="0":this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";var f=this.tooltip_min.getBoundingClientRect(),m=this.tooltip_max.getBoundingClientRect();"bottom"===this.options.tooltip_position?f.right>m.left?(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="",this.tooltip_max.style.bottom="22px"):(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top=this.tooltip_min.style.top,this.tooltip_max.style.bottom=""):f.right>m.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}},_createHighlightRange:function(t,e){return this._isHighlightRange(t,e)?t>e?{start:e,size:t-e}:{start:t,size:e-t}:null},_isHighlightRange:function(t,e){return 0<=t&&t<=100&&0<=e&&e<=100},_resize:function(t){this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this._layout()},_removeProperty:function(t,e){t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(e)},_mousedown:function(t){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos];var e=this._getPercentage(t);if(this.options.range){var i=Math.abs(this._state.percentage[0]-e),s=Math.abs(this._state.percentage[1]-e);this._state.dragged=i<s?0:1,this._adjustPercentageForRangeSliders(e)}else this._state.dragged=0;this._state.percentage[this._state.dragged]=e,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var n=this._calculateValue();return this._trigger("slideStart",n),this._setDataVal(n),this.setValue(n,!1,!0),t.returnValue=!1,this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_touchstart:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0];this.touchX=e.pageX,this.touchY=e.pageY}else this._mousedown(t)},_triggerFocusOnHandle:function(t){0===t&&this.handle1.focus(),1===t&&this.handle2.focus()},_keydown:function(t,e){if(!this._state.enabled)return!1;var i;switch(e.keyCode){case 37:case 40:i=-1;break;case 39:case 38:i=1}if(i){if(this.options.natural_arrow_keys){var s="vertical"===this.options.orientation&&!this.options.reversed,n="horizontal"===this.options.orientation&&this.options.reversed;(s||n)&&(i=-i)}var o=this._state.value[t]+i*this.options.step,a=o/this.options.max*100;return this._state.keyCtrl=t,this.options.range&&(this._adjustPercentageForRangeSliders(a),o=[this._state.keyCtrl?this._state.value[0]:o,this._state.keyCtrl?o:this._state.value[1]]),this._trigger("slideStart",o),this._setDataVal(o),this.setValue(o,!0,!0),this._setDataVal(o),this._trigger("slideStop",o),this._layout(),this._pauseEvent(e),delete this._state.keyCtrl,!1}},_pauseEvent:function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1},_mousemove:function(t){if(!this._state.enabled)return!1;var e=this._getPercentage(t);this._adjustPercentageForRangeSliders(e),this._state.percentage[this._state.dragged]=e,this._layout();var i=this._calculateValue(!0);return this.setValue(i,!0,!0),!1},_touchmove:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0],i=e.pageX-this.touchX,s=e.pageY-this.touchY;this._state.inDrag||("vertical"===this.options.orientation&&i<=5&&i>=-5&&(s>=15||s<=-15)?this._mousedown(t):s<=5&&s>=-5&&(i>=15||i<=-15)&&this._mousedown(t))}},_adjustPercentageForRangeSliders:function(t){if(this.options.range){var e=this._getNumDigitsAfterDecimalPlace(t);e=e?e-1:0;var i=this._applyToFixedAndParseFloat(t,e);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],e)<i?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],e)>i?(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0):0===this._state.keyCtrl&&this._state.value[1]/this.options.max*100<t?(this._state.percentage[0]=this._state.percentage[1],this._state.keyCtrl=1,this.handle2.focus()):1===this._state.keyCtrl&&this._state.value[0]/this.options.max*100>t&&(this._state.percentage[1]=this._state.percentage[0],this._state.keyCtrl=0,this.handle1.focus())}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,!1===this._state.over&&this._hideTooltip();var t=this._calculateValue(!0);return this._layout(),this._setDataVal(t),this._trigger("slideStop",t),!1},_calculateValue:function(t){var e;if(this.options.range?(e=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(e[0]=this._toValue(this._state.percentage[0]),e[0]=this._applyPrecision(e[0])),100!==this._state.percentage[1]&&(e[1]=this._toValue(this._state.percentage[1]),e[1]=this._applyPrecision(e[1]))):(e=this._toValue(this._state.percentage[0]),e=parseFloat(e),e=this._applyPrecision(e)),t){for(var i=[e,1/0],s=0;s<this.options.ticks.length;s++){var n=Math.abs(this.options.ticks[s]-e);n<=i[1]&&(i=[this.options.ticks[s],n])}if(i[1]<=this.options.ticks_snap_bounds)return i[0]}return e},_applyPrecision:function(t){var e=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(t,e)},_getNumDigitsAfterDecimalPlace:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},_applyToFixedAndParseFloat:function(t,e){var i=t.toFixed(e);return parseFloat(i)},_getPercentage:function(t){!this.touchCapable||"touchstart"!==t.type&&"touchmove"!==t.type||(t=t.touches[0]);var e=t[this.mousePos]-this._state.offset[this.stylePos];"right"===this.stylePos&&(e=-e);var i=e/this._state.size*100;return i=Math.round(i/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(i=100-i),Math.max(0,Math.min(100,i))},_validateInputValue:function(t){if(isNaN(+t)){if(Array.isArray(t))return this._validateArray(t),t;throw new Error(i(t))}return+t},_validateArray:function(t){for(var e=0;e<t.length;e++){var s=t[e];if("number"!=typeof s)throw new Error(i(s))}},_setDataVal:function(t){this.element.setAttribute("data-value",t),this.element.setAttribute("value",t),this.element.value=t},_trigger:function(e,i){i=i||0===i?i:void 0;var s=this.eventToCallbackMap[e];if(s&&s.length)for(var n=0;n<s.length;n++)(0,s[n])(i);t&&this._triggerJQueryEvent(e,i)},_triggerJQueryEvent:function(t,e){var i={type:t,value:e};this.$element.trigger(i),this.$sliderElem.trigger(i)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(t,e){void 0!==t.textContent?t.textContent=e:void 0!==t.innerText&&(t.innerText=e)},_removeClass:function(t,e){for(var i=e.split(" "),s=t.className,n=0;n<i.length;n++){var o=i[n],a=new RegExp("(?:\\s|^)"+o+"(?:\\s|$)");s=s.replace(a," ")}t.className=s.trim()},_addClass:function(t,e){for(var i=e.split(" "),s=t.className,n=0;n<i.length;n++){var o=i[n];new RegExp("(?:\\s|^)"+o+"(?:\\s|$)").test(s)||(s+=" "+o)}t.className=s.trim()},_offsetLeft:function(t){return t.getBoundingClientRect().left},_offsetRight:function(t){return t.getBoundingClientRect().right},_offsetTop:function(t){for(var e=t.offsetTop;(t=t.offsetParent)&&!isNaN(t.offsetTop);)e+=t.offsetTop,"BODY"!==t.tagName&&(e-=t.scrollTop);return e},_offset:function(t){return{left:this._offsetLeft(t),right:this._offsetRight(t),top:this._offsetTop(t)}},_css:function(e,i,s){if(t)t.style(e,i,s);else{var n=i.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(t,e){return e.toUpperCase()}));e.style[n]=s}},_toValue:function(t){return this.options.scale.toValue.apply(this,[t])},_toPercentage:function(t){return this.options.scale.toPercentage.apply(this,[t])},_setTooltipPosition:function(){var t=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var e,i="left"===(e=this.options.tooltip_position?this.options.tooltip_position:this.options.rtl?"left":"right")?"right":"left";t.forEach(function(t){this._addClass(t,e),t.style[i]="100%"}.bind(this))}else"bottom"===this.options.tooltip_position?t.forEach(function(t){this._addClass(t,"bottom"),t.style.top="22px"}.bind(this)):t.forEach(function(t){this._addClass(t,"top"),t.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},t&&t.fn){var o=void 0;t.fn.slider?(r&&window.console.warn("bootstrap-slider.js - WARNING: $.fn.slider namespace is already bound. Use the $.fn.bootstrapSlider namespace instead."),o="bootstrapSlider"):(t.bridget("slider",e),o="slider"),t.bridget("bootstrapSlider",e),t((function(){t("input[data-provide=slider]")[o]()}))}}(t),e})?s.apply(e,n):s)||(t.exports=o)},4656:function(t,e,i){},4657:function(t,e,i){},4658:function(t,e,i){},4663:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return n}));const s=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function n(t,e=!1,i=Float32Array){let s;if(Number.isFinite(t[0]))s=new i(t);else{s=new i(4*t.length);let e=0;for(let i=0;i<t.length;i++){const n=t[i];s[e++]=n[0],s[e++]=n[1],s[e++]=n[2],s[e++]=Number.isFinite(n[3])?n[3]:255}}if(e)for(let t=0;t<s.length;t++)s[t]/=255;return s}},4670:function(t,e,i){"use strict";i.d(e,"a",(function(){return M}));var s=i(4867),n=i(5018),o=i(4636),a=i(4997),r=i(4992),l=i(5057),h=i(4835),u=i(4653),c=i(4874),d=i(4802),p=i(4652);const g={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},f=[32775,32774],m=[32776,32774],v=[32776,32775],_={[p.a.SUM]:32774,[p.a.MEAN]:32774,[p.a.MIN]:f,[p.a.MAX]:m},b={size:1,operation:p.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1};var y=i(4694);const x=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],C={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},w=[s.a.WEBGL2,s.a.COLOR_ATTACHMENT_RGBA32F,s.a.BLEND_EQUATION_MINMAX,s.a.FLOAT_BLEND,s.a.TEXTURE_FLOAT];class M{static getAggregationData({aggregationData:t,maxData:e,minData:i,maxMinData:s,pixelIndex:n}){const o=4*n,a={};return t&&(a.cellCount=t[o+3],a.cellWeight=t[o]),s?(a.maxCellWieght=s[0],a.minCellWeight=s[3]):(e&&(a.maxCellWieght=e[0],a.totalCount=e[3]),i&&(a.minCellWeight=i[0],a.totalCount=e[3])),a}static getCellData({countsData:t,size:e=1}){const i=t.length/4,s=new Float32Array(i*e),n=new Uint32Array(i);for(let o=0;o<i;o++){for(let i=0;i<e;i++)s[o*e+i]=t[4*o+i];n[o]=t[4*o+3]}return{cellCounts:n,cellWeights:s}}static isSupported(t){return Object(n.c)(t,w)}constructor(t,e={}){this.id=e.id||"gpu-grid-aggregator",this.gl=t,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(o.i)(t)&&Object(n.c)(this.gl,s.a.BLEND_EQUATION_MINMAX,s.a.COLOR_ATTACHMENT_RGBA32F,s.a.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:t,allAggregationModel:e,meanTransform:i}=this,{textures:s,framebuffers:n,maxMinFramebuffers:o,minFramebuffers:a,maxFramebuffers:r,meanTextures:l,resources:h}=this.state;null==t||t.delete(),null==e||e.delete(),null==i||i.delete(),function(t){(t=Array.isArray(t)?t:[t]).forEach(t=>{for(const e in t)t[e].delete()})}([n,s,o,a,r,l,h])}run(t={}){this.setState({results:{}});const e=this._normalizeAggregationParams(t);return this._hasGPUSupport||u.a.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(e)}getData(t){const e={},i=this.state.results;i[t].aggregationData||(i[t].aggregationData=i[t].aggregationBuffer.getData()),e.aggregationData=i[t].aggregationData;for(const s in C){const n=C[s];(i[t][s]||i[t][n])&&(i[t][s]=i[t][s]||i[t][n].getData(),e[s]=i[t][s])}return e}updateShaders(t={}){this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){const e={...g,...t},{weights:i}=e;return i&&(e.weights=function(t){const e={};for(const i in t)e[i]={...b,...t[i]};return e}(i)),e}setState(t){Object.assign(this.state,t)}_getAggregateData(t){const e={},{textures:i,framebuffers:s,maxMinFramebuffers:n,minFramebuffers:o,maxFramebuffers:r,resources:l}=this.state,{weights:h}=t;for(const t in h){e[t]={};const{needMin:u,needMax:c,combineMaxMin:d}=h[t];e[t].aggregationTexture=i[t],e[t].aggregationBuffer=Object(a.d)(s[t],{target:h[t].aggregationBuffer,sourceType:5126}),u&&c&&d?(e[t].maxMinBuffer=Object(a.d)(n[t],{target:h[t].maxMinBuffer,sourceType:5126}),e[t].maxMinTexture=l["".concat(t,"-maxMinTexture")]):(u&&(e[t].minBuffer=Object(a.d)(o[t],{target:h[t].minBuffer,sourceType:5126}),e[t].minTexture=l["".concat(t,"-minTexture")]),c&&(e[t].maxBuffer=Object(a.d)(r[t],{target:h[t].maxBuffer,sourceType:5126}),e[t].maxTexture=l["".concat(t,"-maxTexture")]))}return this._trackGPUResultBuffers(e,h),e}_renderAggregateData(t){const{cellSize:e,projectPoints:i,attributes:s,moduleSettings:n,numCol:o,numRow:a,weights:r,translation:l,scaling:h}=t,{maxMinFramebuffers:u,minFramebuffers:c,maxFramebuffers:d}=this.state,p=[o,a],g={blend:!0,depthTest:!1,blendFunc:[1,1]},_={cellSize:e,gridSize:p,projectPoints:i,translation:l,scaling:h};for(const t in r){const{needMin:e,needMax:i}=r[t],o=e&&i&&r[t].combineMaxMin;this._renderToWeightsTexture({id:t,parameters:g,moduleSettings:n,uniforms:_,gridSize:p,attributes:s,weights:r}),o?this._renderToMaxMinTexture({id:t,parameters:{...g,blendEquation:v},gridSize:p,minOrMaxFb:u[t],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:o}):(e&&this._renderToMaxMinTexture({id:t,parameters:{...g,blendEquation:f},gridSize:p,minOrMaxFb:c[t],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:o}),i&&this._renderToMaxMinTexture({id:t,parameters:{...g,blendEquation:m},gridSize:p,minOrMaxFb:d[t],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:o}))}}_renderToMaxMinTexture(t){const{id:e,parameters:i,gridSize:s,minOrMaxFb:n,combineMaxMin:a,clearParams:r={}}=t,{framebuffers:l}=this.state,{gl:h,allAggregationModel:u}=this;Object(o.n)(h,{...r,framebuffer:n,viewport:[0,0,s[0],s[1]]},()=>{h.clear(16384),u.draw({parameters:i,uniforms:{uSampler:l[e].texture,gridSize:s,combineMaxMin:a}})})}_renderToWeightsTexture(t){const{id:e,parameters:i,moduleSettings:s,uniforms:n,gridSize:a,weights:r}=t,{framebuffers:h,equations:u,weightAttributes:c}=this.state,{gl:d,gridAggregationModel:g}=this,{operation:f}=r[e],m=f===p.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];if(Object(o.n)(d,{framebuffer:h[e],viewport:[0,0,a[0],a[1]],clearColor:m},()=>{d.clear(16384);const t={weights:c[e]};g.draw({parameters:{...i,blendEquation:u[e]},moduleSettings:s,uniforms:n,attributes:t})}),f===p.a.MEAN){const{meanTextures:t,textures:i}=this.state,s={_sourceTextures:{aggregationValues:t[e]},_targetTexture:i[e],elementCount:i[e].width*i[e].height};this.meanTransform?this.meanTransform.update(s):this.meanTransform=function(t,e){return new l.a(t,{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n  gl_PointSize = 1.0;\n}\n",_targetTextureVarying:"meanValues",...e})}(d,s),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),h[e].attach({36064:i[e]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);const e=this._getAggregateData(t);return this.setState({results:e}),e}_setupFramebuffers(t){const{textures:e,framebuffers:i,maxMinFramebuffers:s,minFramebuffers:n,maxFramebuffers:o,meanTextures:a,equations:r}=this.state,{weights:l}=t,{numCol:h,numRow:u}=t,c={width:h,height:u};for(const t in l){const{needMin:d,needMax:g,combineMaxMin:f,operation:m}=l[t];e[t]=l[t].aggregationTexture||e[t]||Object(y.a)(this.gl,{id:"".concat(t,"-texture"),width:h,height:u}),e[t].resize(c);let v=e[t];m===p.a.MEAN&&(a[t]=a[t]||Object(y.a)(this.gl,{id:"".concat(t,"-mean-texture"),width:h,height:u}),a[t].resize(c),v=a[t]),i[t]?i[t].attach({36064:v}):i[t]=Object(y.b)(this.gl,{id:"".concat(t,"-fb"),width:h,height:u,texture:v}),i[t].resize(c),r[t]=_[m]||_.SUM,(d||g)&&(d&&g&&f?s[t]||(v=l[t].maxMinTexture||this._getMinMaxTexture("".concat(t,"-maxMinTexture")),s[t]=Object(y.b)(this.gl,{id:"".concat(t,"-maxMinFb"),texture:v})):(d&&(n[t]||(v=l[t].minTexture||this._getMinMaxTexture("".concat(t,"-minTexture")),n[t]=Object(y.b)(this.gl,{id:"".concat(t,"-minFb"),texture:v}))),g&&(o[t]||(v=l[t].maxTexture||this._getMinMaxTexture("".concat(t,"-maxTexture")),o[t]=Object(y.b)(this.gl,{id:"".concat(t,"-maxFb"),texture:v})))))}}_getMinMaxTexture(t){const{resources:e}=this.state;return e[t]||(e[t]=Object(y.a)(this.gl,{id:"resourceName"})),e[t]}_setupModels({numCol:t=0,numRow:e=0}={}){var i;const{gl:s}=this,{shaderOptions:n}=this.state;if(null===(i=this.gridAggregationModel)||void 0===i||i.delete(),this.gridAggregationModel=function(t,e){const i=Object(c.a)({vs:"#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 weights;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform bool projectPoints;\nuniform vec2 translation;\nuniform vec3 scaling;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result;\n  pos.xy = pos.xy/pos.w;\n  result = pos + vec4(translation, 0., 0.);\n  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;\n  return result.xy;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n\n  vec2 pixelXY64[2];\n  pixelXY64[0] = vec2(pos.x, 0.);\n  pixelXY64[1] = vec2(pos.y, 0.);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",fs:"#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,d.a]},e);return new r.a(t,{id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0,...i})}(s,n),!this.allAggregationModel){const i=t*e;this.allAggregationModel=function(t,e){return new r.a(t,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:[h.a],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}(s,i)}}_setupWeightAttributes(t){const{weightAttributes:e}=this.state,{weights:i}=t;for(const s in i)e[s]=t.attributes[s]}_trackGPUResultBuffers(t,e){const{resources:i}=this.state;for(const s in t)if(t[s])for(const n of x)if(t[s][n]&&e[s][n]!==t[s][n]){const e="gpu-result-".concat(s,"-").concat(n);i[e]&&i[e].delete(),i[e]=t[s][n]}}_updateModels(t){const{vertexCount:e,attributes:i,numCol:s,numRow:n}=t,{modelDirty:o}=this.state;o&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(e),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(s*n)}}},4673:function(t,e,i){"use strict";i.d(e,"c",(function(){return p})),i.d(e,"b",(function(){return g})),i.d(e,"a",(function(){return f})),i.d(e,"d",(function(){return m}));var s=i(4653);function n(t,e,i){const s=i;return s.domain=()=>t,s.range=()=>e,s}function o(t,e){return n(t,e,i=>function(t,e,i){const n=t[1]-t[0];if(n<=0)return s.a.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const o=n/e.length,a=Math.floor((i-t[0])/o),r=Math.max(Math.min(a,e.length-1),0);return e[r]}(t,e,i))}function a(t,e){return n(t,e,i=>function(t,e,i){return(i-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}(t,e,i))}function r(t,e){const i=t.sort(l);let s=0;const o=Math.max(1,e.length),a=new Array(o-1);for(;++s<o;)a[s-1]=h(i,s/o);const r=t=>function(t,e,i){return e[function(t,e){let i=0,s=t.length;for(;i<s;){const n=i+s>>>1;l(t[n],e)>0?s=n:i=n+1}return i}(t,i)]}(a,e,t);return r.thresholds=()=>a,n(t,e,r)}function l(t,e){return t-e}function h(t,e){const i=t.length;if(e<=0||i<2)return t[0];if(e>=1)return t[i-1];const s=(i-1)*e,n=Math.floor(s),o=t[n];return o+(t[n+1]-o)*(s-n)}function u(t,e){const i=new Map,s=[];for(const e of t){const t="".concat(e);i.has(t)||i.set(t,s.push(e))}return n(t,e,t=>function(t,e,i,s){const n="".concat(s);let o=e.get(n);return void 0===o&&(o=t.push(s),e.set(n,o)),i[(o-1)%i.length]}(s,i,e,t))}function c(t){return null!=t}function d(t,e){return("function"==typeof e?t.map(e):t).filter(c)}function p(t,e){return d(t,e)}function g(t,e){return function(t){const e=[];return t.forEach(t=>{!e.includes(t)&&c(t)&&e.push(t)}),e}(d(t,e))}function f(t,e,i){return Math.max(e,Math.min(i,t))}function m(t){switch(t){case"quantize":return o;case"linear":return a;case"quantile":return r;case"ordinal":return u;default:return o}}},4674:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var s=i(4723),n=i(4875),o=i(4993),a=i(4636);function r(t,e){const i={};for(const s in t)e.includes(s)||(i[s]=t[s]);return i}class l extends s.a{initializeState(t){super.initializeState(),this.setState({ignoreProps:r(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes(t.props)}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:i}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:Object(a.e)(i)})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:i,oldProps:s,changeFlags:o}=t,{compareAll:a=!1,dimension:r}=e,{ignoreProps:l}=this.state,{props:h,accessors:u=[]}=r,{updateTriggersChanged:c}=o;if(o.dataChanged)return!0;if(c){if(c.all)return!0;for(const t of u)if(c[t])return!0}if(a)return!!o.extensionsChanged||Object(n.a)({oldProps:s,newProps:i,ignoreProps:l,propTypes:this.constructor._propTypes});for(const t of h)if(i[t]!==s[t])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const i in t){e=!1;break}return e}(e)}_getAttributeManager(){return new o.a(this.context.gl,{id:this.props.id,stats:this.context.stats})}}l.layerName="AggregationLayer"},4679:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i(4692),n=i(4695);function o(t,e){const i=function(t,e){const{data:i=[],cellSize:o}=t,{attributes:a,viewport:r,projectPoints:l,numInstances:h}=e,u=a.positions.value,{size:c}=a.positions.getAccessor(),d=e.boundingBox||function(t,e){const i=t.value,{size:s}=t.getAccessor();let n,o,a=1/0,r=-1/0,l=1/0,h=-1/0;for(let t=0;t<e;t++)o=i[t*s],n=i[t*s+1],Number.isFinite(o)&&Number.isFinite(n)&&(a=n<a?n:a,r=n>r?n:r,l=o<l?o:l,h=o>h?o:h);return{xMin:l,xMax:h,yMin:a,yMax:r}}(a.positions,h),p=e.posOffset||[180,90],g=e.gridOffset||Object(n.b)(d,o);if(g.xOffset<=0||g.yOffset<=0)return{gridHash:{},gridOffset:g};const{width:f,height:m}=r,v=Math.ceil(f/g.xOffset),_=Math.ceil(m/g.yOffset),b={},{iterable:y,objectInfo:x}=Object(s.a)(i),C=new Array(3);for(const t of y){x.index++,C[0]=u[x.index*c],C[1]=u[x.index*c+1],C[2]=c>=3?u[x.index*c+2]:0;const[e,i]=l?r.project(C):C;if(Number.isFinite(e)&&Number.isFinite(i)){const s=Math.floor((i+p[1])/g.yOffset),n=Math.floor((e+p[0])/g.xOffset);if(!l||n>=0&&n<v&&s>=0&&s<_){const e="".concat(s,"-").concat(n);b[e]=b[e]||{count:0,points:[],lonIdx:n,latIdx:s},b[e].count+=1,b[e].points.push({source:t,index:x.index})}}}return{gridHash:b,gridOffset:g,offsets:[-1*p[0],-1*p[1]]}}(t,e),o=function({gridHash:t,gridOffset:e,offsets:i}){const s=new Array(Object.keys(t).length);let n=0;for(const o in t){const a=o.split("-"),r=parseInt(a[0],10),l=parseInt(a[1],10),h=n++;s[h]={index:h,position:[i[0]+e.xOffset*l,i[1]+e.yOffset*r],...t[o]}}return s}(i);return{gridHash:i.gridHash,gridOffset:i.gridOffset,data:o}}},4680:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var s=i(4673);const n=t=>t.length,o=t=>t.points,a=t=>t.index,r=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,l={getValue:n,getPoints:o,getIndex:a,filterData:null};class h{constructor(t=[],e=l){this.aggregatedBins=this.getAggregatedBins(t,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,e){const{getValue:i=n,getPoints:s=o,getIndex:r=a,filterData:l}=e,h="function"==typeof l,u=t.length,c=[];let d=0;for(let e=0;e<u;e++){const n=t[e],o=s(n),a=r(n),u=h?o.filter(l):o;n.filteredPoints=h?u:null;const p=u.length?i(u):null;null!=p&&(c[d]={i:Number.isFinite(a)?a:e,value:p,counts:u.length},d++)}return c}_percentileToIndex(t){const e=this.sortedBins.length;if(e<2)return[0,0];const[i,n]=t.map(t=>Object(s.a)(t,0,100));return[Math.ceil(i/100*(e-1)),Math.floor(n/100*(e-1))]}getBinMap(){const t={};for(const e of this.aggregatedBins)t[e.i]=e;return t}_updateMinMaxValues(){let t=0,e=0,i=3402823466e29,s=0;for(const n of this.aggregatedBins)t=t>n.counts?t:n.counts,e=e>n.value?e:n.value,i=i<n.value?i:n.value,s+=n.counts;this.maxCount=t,this.maxValue=e,this.minValue=i,this.totalCount=s}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>r(t.value,e.value))),!this.sortedBins.length)return[];let e=0,i=this.sortedBins.length-1;if(Array.isArray(t)){const s=this._percentileToIndex(t);e=s[0],i=s[1]}return[this.sortedBins[e].value,this.sortedBins[i].value]}getValueDomainByScale(t,[e=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>r(t.value,e.value))),!this.sortedBins.length)return[];const s=this._percentileToIndex([e,i]);return this._getScaleDomain(t,s)}_getScaleDomain(t,[e,i]){const n=this.sortedBins;switch(t){case"quantize":case"linear":return[n[e].value,n[i].value];case"quantile":return Object(s.c)(n.slice(e,i+1),t=>t.value);case"ordinal":return Object(s.b)(n,t=>t.value);default:return[n[e].value,n[i].value]}}}},4694:function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return l}));var s=i(4772),n=i(4636),o=i(4721);const a={10240:9728,10241:9728};function r(t,e={}){const{width:i=1,height:o=1,data:r=null,unpackFlipY:l=!0,parameters:h=a}=e;return new s.a(t,{data:r,format:Object(n.i)(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:h,dataFormat:6408,width:i,height:o,unpackFlipY:l})}function l(t,e){const{id:i,width:s=1,height:n=1,texture:a}=e;return new o.a(t,{id:i,width:s,height:n,attachments:{36064:a}})}},4695:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return l})),i.d(e,"c",(function(){return h}));var s=i(4690),n=i(4653);function o(t){return Number.isFinite(t)?t:0}function a(t,e){const i=t.positions.value;let s,n,a=1/0,r=-1/0,l=1/0,h=-1/0;for(let t=0;t<e;t++)n=i[3*t],s=i[3*t+1],a=s<a?s:a,r=s>r?s:r,l=n<l?n:l,h=n>h?n:h;return{xMin:o(l),xMax:o(h),yMin:o(a),yMax:o(r)}}function r(t,e){const i=t<0?-1:1;let s=i<0?Math.abs(t)+e:Math.abs(t);return s=Math.floor(s/e)*e,s*i}function l(t,e,i=!0){if(!i)return{xOffset:e,yOffset:e};const{yMin:s,yMax:n}=t;return function(t,e){const i=(a=t,a/6378e3*(180/Math.PI)),s=(n=e,o=t,o/6378e3*(180/Math.PI)/Math.cos(n*Math.PI/180));var n,o;var a;return{yOffset:i,xOffset:s}}(e,(s+n)/2)}function h(t,e,i,o){const a=l(t,e,o!==s.a.CARTESIAN),h=function(t,e,i,o){const{width:a,height:l}=o,h=i===s.a.CARTESIAN?[-a/2,-l/2]:[-180,-90];n.a.assert(i===s.a.CARTESIAN||i===s.a.LNGLAT||i===s.a.DEFAULT);const{xMin:u,yMin:c}=t;return[-1*(r(u-h[0],e.xOffset)+h[0]),-1*(r(c-h[1],e.yOffset)+h[1])]}(t,a,o,i),{xMin:u,yMin:c,xMax:d,yMax:p}=t,g=d-u+a.xOffset,f=p-c+a.yOffset;return{gridOffset:a,translation:h,width:g,height:f,numCol:Math.ceil(g/a.xOffset),numRow:Math.ceil(f/a.yOffset)}}},4713:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var s=i(4674),n=i(4670),o=i(4689),a=i(4653),r=i(4680),l=i(4679);class h extends s.a{initializeState({dimensions:t}){const{gl:e}=this.context;super.initializeState(t),this.setState({layerData:{},gpuGridAggregator:new n.a(e,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:l.a})}updateState(t){super.updateState(t),this.updateAggregationState(t);const{aggregationDataDirty:e,aggregationWeightsDirty:i,gpuAggregation:s}=this.state;if(this.getNumInstances()<=0)return;let n=!1;(e||s&&i)&&(this._updateAggregation(t),n=!0),s||!e&&!i||(this._updateWeightBins(),this._uploadAggregationResults(),n=!0),this.setState({aggregationDirty:n})}finalizeState(){var t;const{count:e}=this.state.weights;e&&e.aggregationBuffer&&e.aggregationBuffer.delete(),null===(t=this.state.gpuGridAggregator)||void 0===t||t.delete(),super.finalizeState()}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){a.a.assert(!1)}allocateResources(t,e){if(this.state.numRow!==t||this.state.numCol!==e){const i=e*t*4*4,s=this.context.gl,{weights:n}=this.state;for(const t in n){const e=n[t];e.aggregationBuffer&&e.aggregationBuffer.delete(),e.aggregationBuffer=new o.a(s,{byteLength:i,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:t,maxMinData:e,maxData:i,minData:s}){const{count:n}=this.state.weights;n&&(n.aggregationData=t,n.maxMinData=e,n.maxData=i,n.minData=s)}_updateAggregation(t){const{cpuGridAggregator:e,gpuGridAggregator:i,gridOffset:s,posOffset:n,translation:o=[0,0],scaling:a=[0,0,0],boundingBox:r,projectPoints:l,gpuAggregation:h,numCol:u,numRow:c}=this.state,{props:d}=t,{viewport:p}=this.context,g=this.getAttributes(),f=this.getNumInstances();if(h){const{weights:t}=this.state;i.run({weights:t,cellSize:[s.xOffset,s.yOffset],numCol:u,numRow:c,translation:o,scaling:a,vertexCount:f,projectPoints:l,attributes:g,moduleSettings:this.getModuleSettings()})}else{const t=e(d,{gridOffset:s,projectPoints:l,attributes:g,viewport:p,posOffset:n,boundingBox:r});this.setState({layerData:t})}}_updateWeightBins(){const{getValue:t}=this.state,e=new r.a(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:e})}_uploadAggregationResults(){const{numCol:t,numRow:e}=this.state,{data:i}=this.state.layerData,{aggregatedBins:s,minValue:n,maxValue:o,totalCount:a}=this.state.sortedBins,r=new Float32Array(t*e*4).fill(0);for(const e of s){const{lonIdx:s,latIdx:n}=i[e.i],{value:o,counts:a}=e,l=4*(s+n*t);r[l]=o,r[l+4-1]=a}const l=new Float32Array([o,0,0,n]),h=new Float32Array([o,0,0,a]),u=new Float32Array([n,0,0,a]);this.updateResults({aggregationData:r,maxMinData:l,maxData:h,minData:u})}}h.layerName="GridAggregationLayer"},4723:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var s=i(4717),n=i(4667),o=i(4678);class a extends s.a{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}renderLayers(){return null}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){const{_subLayerProps:i}=this.props;return e&&e.length||i&&i[t]}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if("function"==typeof t){const e={data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,s)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:i,visible:s,parameters:n,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:r,highlightColor:l,coordinateSystem:h,coordinateOrigin:u,wrapLongitude:c,positionFormat:d,modelMatrix:p,extensions:g,fetch:f,_subLayerProps:m}=this.props,v={opacity:e,pickable:i,visible:s,parameters:n,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:r,highlightColor:l,coordinateSystem:h,coordinateOrigin:u,wrapLongitude:c,positionFormat:d,modelMatrix:p,extensions:g,fetch:f},_=m&&m[t.id],b=_&&_.updateTriggers,y=t.id||"sublayer";if(_){const e=this.constructor._propTypes,i=t.type?t.type._propTypes:{};for(const t in _){const s=i[t]||e[t];s&&"accessor"===s.type&&(_[t]=this.getSubLayerAccessor(_[t]))}}Object.assign(v,t,_),v.id="".concat(this.props.id,"-").concat(y),v.updateTriggers={all:this.props.updateTriggers.all,...t.updateTriggers,...b};for(const t of g){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(v,e,{updateTriggers:Object.assign(v.updateTriggers,e.updateTriggers)})}return v}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:t}=this.internalState;const e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=Object(o.b)(t,Boolean),this.internalState.subLayers=t),Object(n.a)("compositeLayer.renderLayers",this,e,t);for(const e of t)e.parent=this}}a.layerName="CompositeLayer"},4832:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return I}));var s=i(0),n=i.n(s),o=i(2),a=i.n(o),r=i(4653),l=i(4670),h=i(4652),u=i(5018),c=i(4867),d=i(4992),p=i(4803),g=i(4717),f=i(4837),m=i(4663);const v=[0,0,0,0],_=[0,255,0,255],b=["minColor","maxColor","colorRange","colorDomain"],y={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:m.b};class x extends g.a{static isSupported(t){return Object(u.c)(t,[c.a.TEXTURE_FLOAT])}getShaders(){return{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;\n\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[f.a]}}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel(t)})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({oldProps:t,props:e,changeFlags:i}){super.updateState({oldProps:t,props:e,changeFlags:i});const s=this.getAttributeManager();e.numInstances!==t.numInstances?s.invalidateAll():t.cellSizePixels!==e.cellSizePixels&&s.invalidate("instancePositions"),this._updateUniforms(t,e,i)}draw({uniforms:t}){const{parameters:e,maxTexture:i}=this.props,s=this.props.minColor||v,n=this.props.maxColor||_,o=this.props.colorDomain||[1,0],{model:a}=this.state;a.setUniforms(t).setUniforms({minColor:s,maxColor:n,maxTexture:i,colorDomain:o}).draw({parameters:{depthTest:!1,depthMask:!1,...e}})}calculateInstancePositions(t,{numInstances:e}){const{width:i,height:s}=this.context.viewport,{cellSizePixels:n}=this.props,o=Math.ceil(i/n),{value:a,size:r}=t;for(let t=0;t<e;t++){const e=t%o,l=Math.floor(t/o);a[t*r+0]=e*n/i*2-1,a[t*r+1]=1-l*n/s*2,a[t*r+2]=0}}_getModel(t){return new d.a(t,{...this.getShaders(),id:this.props.id,geometry:new p.a({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:t,maxColor:e,colorDomain:i,colorRange:s}=this.props;return t||e?(r.a.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!i&&!s}_updateUniforms(t,e,i){const{model:s}=this.state;if(b.some(i=>t[i]!==e[i])&&s.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),t.colorRange!==e.colorRange&&s.setUniforms({colorRange:Object(m.a)(e.colorRange)}),t.cellMarginPixels!==e.cellMarginPixels||t.cellSizePixels!==e.cellSizePixels||i.viewportChanged){const{width:t,height:e}=this.context.viewport,{cellSizePixels:i,cellMarginPixels:n}=this.props,o=i>n?n:0,a=new Float32Array([(i-o)/t*2,-(i-o)/e*2,1]);s.setUniforms({cellScale:a})}}}x.layerName="ScreenGridCellLayer",x.defaultProps=y;var C=i(4713),w=i(4694);const M={...x.defaultProps,getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},E={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class S extends C.a{initializeState(){const{gl:t}=this.context;if(!x.isSupported(t))return this.setState({supported:!1}),void r.a.error("ScreenGridLayer: ".concat(this.id," is not supported on this browser"))();super.initializeState({dimensions:E,getCellSize:t=>t.cellSizePixels});const e={count:{size:1,operation:h.a.SUM,needMax:!0,maxTexture:Object(w.a)(t,{id:"".concat(this.id,"-max-texture")})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return this.state.supported&&t.somethingChanged}updateState(t){super.updateState(t)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:t,numRow:e,numCol:i,weights:s}=this.state,{updateTriggers:n}=this.props,{aggregationBuffer:o}=s.count;return new(this.getSubLayerClass("cells",x))(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:n}),{data:{attributes:{instanceCounts:o}},maxTexture:t,numInstances:e*i})}finalizeState(){super.finalizeState();const{aggregationBuffer:t,maxBuffer:e,maxTexture:i}=this.state;null==t||t.delete(),null==e||e.delete(),null==i||i.delete()}getPickingInfo({info:t,mode:e}){const{index:i}=t;if(i>=0){const{gpuGridAggregator:e,gpuAggregation:s,weights:n}=this.state,o=s?e.getData("count"):n.count;t.object=l.a.getAggregationData({pixelIndex:i,...o})}return t}updateResults({aggregationData:t,maxData:e}){const{count:i}=this.state.weights;i.aggregationData=t,i.aggregationBuffer.setData({data:t}),i.maxData=e,i.maxTexture.setImageData({data:e})}updateAggregationState(t){const e=t.props.cellSizePixels,i=t.oldProps.cellSizePixels!==e,{viewportChanged:s}=t.changeFlags;let n=t.props.gpuAggregation;this.state.gpuAggregation!==t.props.gpuAggregation&&n&&!l.a.isSupported(this.context.gl)&&(r.a.warn("GPU Grid Aggregation not supported, falling back to CPU")(),n=!1);const o=n!==this.state.gpuAggregation;this.setState({gpuAggregation:n});const a=this.isAttributeChanged("positions"),{dimensions:h}=this.state,{data:u,weights:c}=h,d=a||o||s||this.isAggregationDirty(t,{compareAll:n,dimension:u}),p=this.isAggregationDirty(t,{dimension:c});this.setState({aggregationDataDirty:d,aggregationWeightsDirty:p});const{viewport:g}=this.context;if(s||i){const{width:t,height:i}=g,s=Math.ceil(t/e),n=Math.ceil(i/e);this.allocateResources(n,s),this.setState({scaling:[t/2,-i/2,1],gridOffset:{xOffset:e,yOffset:e},width:t,height:i,numCol:s,numRow:n})}p&&this._updateAccessors(t),(d||p)&&this._resetResults()}_updateAccessors(t){const{getWeight:e,aggregation:i,data:s}=t.props,{count:n}=this.state.weights;n&&(n.getWeight=e,n.operation=h.a[i]),this.setState({getValue:Object(h.b)(i,e,{data:s})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}}S.layerName="ScreenGridLayer",S.defaultProps=M;var A=i(13),k=i(4648),P=i(4646),T=i(4643),O=i(4650),L=i(4651),N=i(4640);function D(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function R(){return(R=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t}).apply(this,arguments)}function F(t){return n.a.createElement("div",{className:"deckgl-tooltip"},n.a.createElement(L.a,{label:Object(A.e)("Longitude and Latitude")+": ",value:t.coordinate[0]+", "+t.coordinate[1]}),n.a.createElement(L.a,{label:Object(A.e)("Weight")+": ",value:""+t.object.weight}))}function I(t,e,i,s,n,o,a){const r=t,l=r.color_picker;let h=e.data.features.map(t=>R({},t,{color:[l.r,l.g,l.b,255*l.a]}));if(r.js_data_mutator){const t=Object(T.a)(r.js_data_mutator);h=t(h)}return null!=a&&a.forEach(t=>{h=h.filter(e=>t(e))}),new S(R({id:"screengrid-layer-"+r.slice_id,data:h,pickable:!0,cellSizePixels:r.grid_size,minColor:[l.r,l.g,l.b,0],maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getWeight:t=>t.weight||0},Object(O.a)(r,s,F)))}const z={formData:a.a.object.isRequired,payload:a.a.object.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired},j={onAddFilter(){}};class B extends n.a.PureComponent{constructor(t){super(t),D(this,"containerRef",n.a.createRef()),D(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state=B.getDerivedStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(t,e){if(e&&t.payload.form_data===e.formData)return null;const i=t.payload.data.features||[],s=i.map(t=>t.__timestamp),n=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:o,end:a,getStep:r,values:l,disabled:h}=Object(P.a)(s,n),{width:u,height:c,formData:d}=t;let{viewport:p}=t;var g;return d.autozoom&&(p=Object(N.a)(p,{width:u,height:c,points:(g=i,g.map(t=>t.position))})),{start:o,end:a,getStep:r,values:l,disabled:h,viewport:p,selected:[],lastClick:0,formData:t.payload.form_data}}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getLayers(t){const e=[];return t[0]===t[1]||t[1]===this.end?e.push(e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1]):e.push(e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]),[I(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip)]}render(){const{formData:t,payload:e,setControlValue:i}=this.props;return n.a.createElement("div",null,n.a.createElement(k.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:i,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange}))}}B.propTypes=z,B.defaultProps=j;e.default=B},4835:function(t,e,i){"use strict";function s(t,e=[],i=0){const s=Math.fround(t),n=t-s;return e[i]=s,e[i+1]=n,e}function n(t){return t-Math.fround(t)}function o(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let n=0;n<4;++n){const o=4*i+n;s(t[4*n+i],e,2*o)}return e}i.d(e,"a",(function(){return r}));const a={ONE:1};const r={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",fs:null,getUniforms:function(){return a},fp64ify:s,fp64LowPart:n,fp64ifyMatrix4:o}}}]);