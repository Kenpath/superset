/*! For license information please see 27baf9da0c5a5aedddae.chunk.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1685:function(t,e,i){var n;!function(s,o,a){if(s){for(var r,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},h={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)l[111+d]="f"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();_.prototype.bind=function(t,e,i){return t=t instanceof Array?t:[t],this._bindMultiple.call(this,t,e,i),this},_.prototype.unbind=function(t,e){return this.bind.call(this,t,(function(){}),e)},_.prototype.trigger=function(t,e){return this._directMap[t+":"+e]&&this._directMap[t+":"+e]({},t),this},_.prototype.reset=function(){return this._callbacks={},this._directMap={},this},_.prototype.stopCallback=function(t,e){return!((" "+e.className+" ").indexOf(" mousetrap ")>-1)&&(!function t(e,i){return null!==e&&e!==o&&(e===i||t(e.parentNode,i))}(e,this.target)&&("INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable))},_.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},_.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(l[e]=t[e]);r=null},_.init=function(){var t=_(o);for(var e in t)"_"!==e.charAt(0)&&(_[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},_.init(),s.Mousetrap=_,t.exports&&(t.exports=_),void 0===(n=function(){return _}.call(e,i,e,t))||(t.exports=n)}function g(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function p(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return l[t.which]?l[t.which]:c[t.which]?c[t.which]:String.fromCharCode(t.which).toLowerCase()}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function m(t,e,i){return i||(i=function(){if(!r)for(var t in r={},l)t>95&&t<112||l.hasOwnProperty(t)&&(r[l[t]]=t);return r}()[t]?"keydown":"keypress"),"keypress"==i&&e.length&&(i="keydown"),i}function v(t,e){var i,n,s,o=[];for(i=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),s=0;s<i.length;++s)n=i[s],u[n]&&(n=u[n]),e&&"keypress"!=e&&h[n]&&(n=h[n],o.push("shift")),f(n)&&o.push(n);return{key:n,modifiers:o,action:e=m(n,o,e)}}function _(t){var e=this;if(t=t||o,!(e instanceof _))return new _(t);e.target=t,e._callbacks={},e._directMap={};var i,n={},s=!1,a=!1,r=!1;function l(t){t=t||{};var e,i=!1;for(e in n)t[e]?i=!0:n[e]=0;i||(r=!1)}function c(t,i,s,o,a,r){var l,c,h,u,d=[],g=s.type;if(!e._callbacks[t])return[];for("keyup"==g&&f(t)&&(i=[t]),l=0;l<e._callbacks[t].length;++l)if(c=e._callbacks[t][l],(o||!c.seq||n[c.seq]==c.level)&&g==c.action&&("keypress"==g&&!s.metaKey&&!s.ctrlKey||(h=i,u=c.modifiers,h.sort().join(",")===u.sort().join(",")))){var p=!o&&c.combo==a,m=o&&c.seq==o&&c.level==r;(p||m)&&e._callbacks[t].splice(l,1),d.push(c)}return d}function h(t,i,n,s){e.stopCallback(i,i.target||i.srcElement,n,s)||!1===t(i,n)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(i),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(i))}function u(t){"number"!=typeof t.which&&(t.which=t.keyCode);var i=p(t);i&&("keyup"!=t.type||s!==i?e.handleKey(i,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):s=!1)}function d(t,e,o,a){function c(e){return function(){r=e,++n[t],clearTimeout(i),i=setTimeout(l,1e3)}}function u(e){h(o,e,t),"keyup"!==a&&(s=p(e)),setTimeout(l,10)}n[t]=0;for(var d=0;d<e.length;++d){var g=d+1===e.length?u:c(a||v(e[d+1]).action);m(e[d],g,a,t,d)}}function m(t,i,n,s,o){e._directMap[t+":"+n]=i;var a,r=(t=t.replace(/\s+/g," ")).split(" ");r.length>1?d(t,r,i,n):(a=v(t,n),e._callbacks[a.key]=e._callbacks[a.key]||[],c(a.key,a.modifiers,{type:a.action},s,t,o),e._callbacks[a.key][s?"unshift":"push"]({callback:i,modifiers:a.modifiers,action:a.action,seq:s,level:o,combo:t}))}e._handleKey=function(t,e,i){var n,s=c(t,e,i),o={},u=0,d=!1;for(n=0;n<s.length;++n)s[n].seq&&(u=Math.max(u,s[n].level));for(n=0;n<s.length;++n)if(s[n].seq){if(s[n].level!=u)continue;d=!0,o[s[n].seq]=1,h(s[n].callback,i,s[n].combo,s[n].seq)}else d||h(s[n].callback,i,s[n].combo);var g="keypress"==i.type&&a;i.type!=r||f(t)||g||l(o),a=d&&"keydown"==i.type},e._bindMultiple=function(t,e,i){for(var n=0;n<t.length;++n)m(t[n],e,i)},g(t,"keypress",u),g(t,"keydown",u),g(t,"keyup",u)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},4640:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(4644),s=i(167);const o=[-90,90],a=[-180,180];function r(t,e,i){let[n,s]=t,[o,a]=e;return void 0===i&&(i=.25),n<s?[n,s]:[Math.max(o,n-i),Math.min(a,s+i)]}function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function c(t,e){let{points:i,width:c,height:h,minExtent:u,maxZoom:d,offset:g,padding:p=20}=e;const{bearing:f,pitch:m}=t,v=function(t){const e=r(Object(s.extent)(t,t=>t[1]),o),i=r(Object(s.extent)(t,t=>t[0]),a);return[[i[0],e[0]],[i[1],e[1]]]}(i);try{return l({},Object(n.c)({bounds:v,width:c,height:h,minExtent:u,maxZoom:d,offset:g,padding:p}),{bearing:f,pitch:m})}catch(t){console.error("Could not fit viewport",t)}return t}},4645:function(t,e,i){"use strict";i.d(e,"f",(function(){return s})),i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return g})),i.d(e,"d",(function(){return u})),i.d(e,"e",(function(){return _})),i.d(e,"c",(function(){return y}));i(4637);const n={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function s(t,e,i={}){return function(t,e={}){return Math.sign(o(t,e))}(t,i)!==e&&(function(t,e){const{start:i=0,end:n=t.length,size:s=2}=e,o=(n-i)/s,a=Math.floor(o/2);for(let e=0;e<a;++e){const n=i+e*s,a=i+(o-1-e)*s;for(let e=0;e<s;++e){const i=t[n+e];t[n+e]=t[a+e],t[a+e]=i}}}(t,i),!0)}function o(t,e={}){const{start:i=0,end:n=t.length}=e,s=e.size||2;let o=0;for(let e=i,a=n-s;e<n;e+=s)o+=(t[e]-t[a])*(t[e+1]+t[a+1]),a=e;return o/2}function a(t,e){const i=e.length,n=t.length;if(n>0){let s=!0;for(let o=0;o<i;o++)if(t[n-i+o]!==e[o]){s=!1;break}if(s)return!1}for(let s=0;s<i;s++)t[n+s]=e[s];return!0}function r(t,e){const i=e.length;for(let n=0;n<i;n++)t[n]=e[n]}function l(t,e,i,n,s=[]){const o=n+e*i;for(let e=0;e<i;e++)s[e]=t[o+e];return s}function c(t,e,i,n,s=[]){let o,a;if(8&i)o=(n[3]-t[1])/(e[1]-t[1]),a=3;else if(4&i)o=(n[1]-t[1])/(e[1]-t[1]),a=1;else if(2&i)o=(n[2]-t[0])/(e[0]-t[0]),a=2;else{if(!(1&i))return null;o=(n[0]-t[0])/(e[0]-t[0]),a=0}for(let i=0;i<t.length;i++)s[i]=(1&a)===i?n[a]:o*(e[i]-t[i])+t[i];return s}function h(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function u(t,e={}){const{size:i=2,broken:n=!1,gridResolution:s=10,gridOffset:o=[0,0],startIndex:u=0,endIndex:d=t.length}=e,g=(d-u)/i;let p=[];const v=[p],_=l(t,0,i,u);let y,b;const x=f(_,s,o,[]),C=[];a(p,_);for(let e=1;e<g;e++){for(y=l(t,e,i,u,y),b=h(y,x);b;){c(_,y,b,x,C);const t=h(C,x);t&&(c(_,C,t,x,C),b=t),a(p,C),r(_,C),m(x,s,b),n&&p.length>i&&(p=[],v.push(p),a(p,_)),b=h(y,x)}a(p,y),r(_,y)}return n?v:v[0]}function d(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}function g(t,e,i={}){if(!t.length)return[];const{size:n=2,gridResolution:s=10,gridOffset:o=[0,0],edgeTypes:a=!1}=i,r=[],l=[{pos:t,types:a&&new Array(t.length/n).fill(1),holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:t,types:e,holes:i}=l.shift();v(t,n,i[0]||t.length,c),u=f(c[0],s,o,u);const g=h(c[1],u);if(g){let s=p(t,e,n,0,i[0]||t.length,u,g);const o={pos:s[0].pos,types:s[0].types,holes:[]},r={pos:s[1].pos,types:s[1].types,holes:[]};l.push(o,r);for(let l=0;l<i.length;l++)s=p(t,e,n,i[l],i[l+1]||t.length,u,g),s[0]&&(o.holes.push(o.pos.length),o.pos=d(o.pos,s[0].pos),a&&(o.types=d(o.types,s[0].types))),s[1]&&(r.holes.push(r.pos.length),r.pos=d(r.pos,s[1].pos),a&&(r.types=d(r.types,s[1].types)))}else{const n={positions:t};a&&(n.edgeTypes=e),i.length&&(n.holeIndices=i),r.push(n)}}return r}function p(t,e,i,n,s,o,h){const u=(s-n)/i,d=[],g=[],p=[],f=[],m=[];let v,_,y;const b=l(t,u-1,i,n);let x=Math.sign(8&h?b[1]-o[3]:b[0]-o[2]),C=e&&e[u-1],w=0,S=0;for(let s=0;s<u;s++)v=l(t,s,i,n,v),_=Math.sign(8&h?v[1]-o[3]:v[0]-o[2]),y=e&&e[n/i+s],_&&x&&x!==_&&(c(b,v,h,o,m),a(d,m)&&p.push(C),a(g,m)&&f.push(C)),_<=0?(a(d,v)&&p.push(y),w-=_):p.length&&(p[p.length-1]=0),_>=0?(a(g,v)&&f.push(y),S+=_):f.length&&(f[f.length-1]=0),r(b,v),x=_,C=y;return[w?{pos:d,types:e&&p}:null,S?{pos:g,types:e&&f}:null]}function f(t,e,i,n){const s=Math.floor((t[0]-i[0])/e)*e+i[0],o=Math.floor((t[1]-i[1])/e)*e+i[1];return n[0]=s,n[1]=o,n[2]=s+e,n[3]=o+e,n}function m(t,e,i){8&i?(t[1]+=e,t[3]+=e):4&i?(t[1]-=e,t[3]-=e):2&i?(t[0]+=e,t[2]+=e):1&i&&(t[0]-=e,t[2]-=e)}function v(t,e,i,n){let s=1/0,o=-1/0,a=1/0,r=-1/0;for(let n=0;n<i;n+=e){const e=t[n],i=t[n+1];s=e<s?e:s,o=e>o?e:o,a=i<a?i:a,r=i>r?i:r}return n[0][0]=s,n[0][1]=a,n[1][0]=o,n[1][1]=r,n}function _(t,e={}){const{size:i=2,startIndex:n=0,endIndex:s=t.length,normalize:o=!0}=e,a=t.slice(n,s);C(a,i,0,s-n);const r=u(a,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const t of r)w(t,i);return r}function y(t,e,i={}){const{size:n=2,normalize:s=!0,edgeTypes:o=!1}=i;e=e||[];const a=[],r=[];let l=0,c=0;for(let s=0;s<=e.length;s++){const o=e[s]||t.length,h=c,u=b(t,n,l,o);for(let e=u;e<o;e++)a[c++]=t[e];for(let e=l;e<u;e++)a[c++]=t[e];C(a,n,h,c),x(a,n,h,c,i.maxLatitude),l=o,r[s]=c}r.pop();const h=g(a,r,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(s)for(const t of h)w(t.positions,n);return h}function b(t,e,i,n){let s=-1,o=-1;for(let a=i+1;a<n;a+=e){const e=Math.abs(t[a]);e>s&&(s=e,o=a-1)}return o}function x(t,e,i,n,s=85.051129){const o=t[i],r=t[n-e];if(Math.abs(o-r)>180){const n=l(t,0,e,i);n[0]+=360*Math.round((r-o)/360),a(t,n),n[1]=Math.sign(n[1])*s,a(t,n),n[0]=o,a(t,n)}}function C(t,e,i,n){let s,o=t[0];for(let a=i;a<n;a+=e){s=t[a];const e=s-o;(e>180||e<-180)&&(s-=360*Math.round(e/360)),t[a]=o=s}}function w(t,e){let i;const n=t.length/e;for(let s=0;s<n&&(i=t[s*e],(i+180)%360==0);s++);const s=360*-Math.round(i/360);if(0!==s)for(let i=0;i<n;i++)t[i*e]+=s}},4646:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(37),s=i.n(n);const o=[1,0,1,0,0,0,0];function a(t,e){const i=parseInt(s()(e).format("x"),10);return parseInt(s()(e).add(t).format("x"),10)-i}function r(t,e){const i=s()(Number(t.reduce((t,e)=>t<e?t:e))),n=s()(Number(t.reduce((t,e)=>t>e?t:e)));let r,l,c;if(e.includes("/")){const t=e.split("/",2);t[0].endsWith("Z")?(l=s()(t[0]),r=s.a.duration(t[1])):(l=s()(t[1]),r=s.a.duration(t[0]))}else r=s.a.duration(e),l=function(t,e){const i=s()(t).subtract(e),n=t.toArray(),a=i.toArray(),r=n.map((t,e)=>a[e]!==t).indexOf(!0),l=n.map((t,e)=>{if(e===r){const i=t-a[e];return t-(t-o[e])%i}return e<r||-1===r?t:o[e]});return s()(l)}(i,r);const h=i.valueOf();for(c=l.clone();c.valueOf()<h;)c.add(r);for(;c.valueOf()>h;)c.subtract(r);let u;const d=n.valueOf();for(u=l.clone();u.valueOf()>d;)u.subtract(r);for(;u.valueOf()<d;)u.add(r);const g=null!=e?[c,c.clone().add(r)]:[c,u],p=t.every(t=>null===t);return{start:parseInt(c.format("x"),10),end:parseInt(u.format("x"),10),getStep:a.bind(this,r),values:g.map(t=>parseInt(t.format("x"),10)),disabled:p}}},4648:function(t,e,i){"use strict";i.d(e,"a",(function(){return _}));var n=i(0),s=i.n(n),o=i(2),a=i.n(o),r=i(4647),l=i(1685),c=i.n(l),h=i(13),u=i(4654),d=i.n(u);i(4656),i(4657);function g(t){return s.a.createElement("span",{className:"BootstrapSliderWrapper"},s.a.createElement(d.a,t))}i(4658);const p={start:a.a.number.isRequired,step:a.a.number.isRequired,end:a.a.number.isRequired,values:a.a.array.isRequired,onChange:a.a.func,loopDuration:a.a.number,maxFrames:a.a.number,orientation:a.a.oneOf(["horizontal","vertical"]),reversed:a.a.bool,disabled:a.a.bool,range:a.a.bool};class f extends s.a.PureComponent{constructor(t){super(t),this.state={intervalId:null};const e=t.end-t.start,i=Math.min(t.maxFrames,e/t.step),n=e/i;this.intervalMilliseconds=t.loopDuration/i,this.increment=n<t.step?t.step:n-n%t.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){c.a.bind(["space"],this.play)}componentWillUnmount(){c.a.unbind(["space"])}onChange(t){this.props.onChange(t.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const t=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:t})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:t,end:e,step:i,values:n,disabled:s}=this.props;if(s)return;const o=(Array.isArray(n)?n:[n,n+i]).map(t=>t+this.increment),a=o[1]>e?o[0]-t:0;this.props.onChange(o.map(t=>t-a))}stepBackward(){const{start:t,end:e,step:i,values:n,disabled:s}=this.props;if(s)return;const o=(Array.isArray(n)?n:[n,n+i]).map(t=>t-this.increment),a=o[0]<t?e-o[1]:0;this.props.onChange(o.map(t=>t+a))}formatter(t){if(this.props.disabled)return Object(h.e)("Data has no time steps");let e=t;return Array.isArray(t)?t[0]===t[1]&&(e=[t[0]]):e=[t],e.map(t=>new Date(t).toUTCString()).join(" : ")}render(){const{start:t,end:e,step:i,orientation:n,reversed:o,disabled:a,range:r,values:l}=this.props;return s.a.createElement("div",{className:"play-slider"},s.a.createElement("div",{className:"play-slider-controls padded"},s.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),s.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),s.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),s.a.createElement("div",{className:"play-slider-scrobbler padded"},s.a.createElement(g,{value:r?l:l[0],range:r,formatter:this.formatter,change:this.onChange,min:t,max:e,step:i,orientation:n,reversed:o,disabled:a?"disabled":"enabled"})))}}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}f.propTypes=p,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const v={getLayers:a.a.func.isRequired,start:a.a.number.isRequired,end:a.a.number.isRequired,getStep:a.a.func,values:a.a.array.isRequired,aggregation:a.a.bool,disabled:a.a.bool,viewport:a.a.object.isRequired,children:a.a.node,mapStyle:a.a.string,mapboxApiAccessToken:a.a.string.isRequired,setControlValue:a.a.func,onValuesChange:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired};class _ extends s.a.PureComponent{constructor(){super(...arguments),m(this,"containerRef",s.a.createRef()),m(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)})}render(){const{start:t,end:e,getStep:i,disabled:n,aggregation:o,children:a,getLayers:l,values:c,onValuesChange:h,viewport:u,setControlValue:d,mapStyle:g,mapboxApiAccessToken:p,height:m,width:v}=this.props,_=l(c);return s.a.createElement("div",null,s.a.createElement(r.a,{ref:this.containerRef,viewport:u,layers:_,setControlValue:d,mapStyle:g,mapboxApiAccessToken:p,bottomMargin:n?0:20,width:v,height:m}),!n&&s.a.createElement(f,{start:t,end:e,step:i(t),values:c,range:!o,onChange:h}),a)}}_.propTypes=v,_.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},4652:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return l}));const n={SUM:1,MEAN:2,MIN:3,MAX:4};function s(t,e){return t+e}function o(t,e){return e>t?e:t}function a(t,e){return e<t?e:t}function r(t,e,i){const r=n[t]||n.SUM;switch(e=function(t,e={}){if(Number.isFinite(t))return t;return i=>(e.index=i.index,t(i.source,e))}(e,i),r){case n.MIN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(a,1/0):null}(t,e);case n.SUM:return t=>function(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(s,0):null}(t,e);case n.MEAN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(s,0)/i.length:null}(t,e);case n.MAX:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(o,-1/0):null}(t,e);default:return null}}function l(t,e={}){return i=>(e.indices=i.map(t=>t.index),t(i.map(t=>t.source),e))}},4654:function(t,e,i){var n,s,o;s=[e,i(90),i(217),i(265),i(255),i(256),i(0),i(2),i(4655)],void 0===(o="function"==typeof(n=function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactBootstrapSlider=void 0;var c=v(e),h=v(i),u=v(n),d=v(s),g=v(o),p=v(a),f=v(r),m=v(l);function v(t){return t&&t.__esModule?t:{default:t}}var _=t.ReactBootstrapSlider=function(t){function e(){var t,i,n,s;(0,h.default)(this,e);for(var o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];return i=n=(0,d.default)(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(a))),n.checkAndDoDisabled=function(){var t="disabled"!==n.props.disabled,e=n.mySlider.isEnabled();t?e||n.mySlider.enable():e&&n.mySlider.disable()},n.updateSliderValues=function(){void 0===n.props.min||void 0===n.mySlider.min&&void 0===n.mySlider.options.min||n.mySlider.setAttribute("min",n.props.min),void 0===n.props.max||void 0===n.mySlider.max&&void 0===n.mySlider.options.max||n.mySlider.setAttribute("max",n.props.max),void 0===n.props.step||void 0===n.mySlider.step&&void 0===n.mySlider.options.step||n.mySlider.setAttribute("step",n.props.step),n.mySlider.setValue(n.props.value),n.checkAndDoDisabled()},s=i,(0,d.default)(n,s)}return(0,g.default)(e,t),(0,u.default)(e,[{key:"componentDidMount",value:function(){var t=this,e=(0,c.default)({},this.props,{tooltip:this.props.tooltip||"show"});if(this.mySlider=new m.default(this.node,e),this.props.change||this.props.handleChange){var i=this.props.change||this.props.handleChange;this.mySlider.on("change",(function(t){var e={target:{}};e.target.value=t.newValue,i(e)}))}this.props.slideStop&&this.mySlider.on("slideStop",(function(e){var i={target:{}};i.target.value=e,t.props.slideStop(i)})),this.checkAndDoDisabled()}},{key:"componentDidUpdate",value:function(){this.updateSliderValues()}},{key:"componentWillUnmount",value:function(){this.mySlider.destroy()}},{key:"render",value:function(){var t=this;return p.default.createElement("div",{ref:function(e){return t.node=e}})}}]),e}(p.default.Component);_.propTypes={min:f.default.number,max:f.default.number,step:f.default.number,value:f.default.oneOfType([f.default.number,f.default.arrayOf(f.default.number.isRequired).isRequired]).isRequired,disabled:f.default.string,tooltip:f.default.string,change:f.default.func,handleChange:f.default.func,slideStop:f.default.func,labelledby:f.default.oneOfType([f.default.string,f.default.arrayOf(f.default.string)])},t.default=_})?n.apply(e,s):n)||(t.exports=o)},4655:function(t,e,i){"use strict";var n,s,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r="object"===("undefined"==typeof window?"undefined":a(window));s=[i(107)],void 0===(o="function"==typeof(n=function(t){var e;return r&&!window.console&&(window.console={}),r&&!window.console.log&&(window.console.log=function(){}),r&&!window.console.warn&&(window.console.warn=function(){}),function(t){var e=Array.prototype.slice;function i(){}!function(t){if(t){var n="undefined"==typeof console?i:function(t){console.error(t)};t.bridget=function(i,s){!function(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}(s),function(i,s){t.fn[i]=function(o){if("string"==typeof o){for(var a=e.call(arguments,1),r=0,l=this.length;r<l;r++){var c=this[r],h=t.data(c,i);if(h)if(t.isFunction(h[o])&&"_"!==o.charAt(0)){var u=h[o].apply(h,a);if(void 0!==u&&u!==h)return u}else n("no such method '"+o+"' for "+i+" instance");else n("cannot call methods on "+i+" prior to initialization; attempted to call '"+o+"'")}return this}var d=this.map((function(){var e=t.data(this,i);return e?(e.option(o),e._init()):(e=new s(this,o),t.data(this,i,e)),t(this)}));return!d||d.length>1?d:d[0]}}(i,s)},t.bridget}}(t)}(t),function(t){var i=function(t){return"Invalid input value '"+t+"' passed in"},n={linear:{toValue:function(t){var e=t/100*(this.options.max-this.options.min),i=!0;if(this.options.ticks_positions.length>0){for(var n,s,o,a=0,r=1;r<this.options.ticks_positions.length;r++)if(t<=this.options.ticks_positions[r]){n=this.options.ticks[r-1],o=this.options.ticks_positions[r-1],s=this.options.ticks[r],a=this.options.ticks_positions[r];break}e=n+(t-o)/(a-o)*(s-n),i=!1}var l=(i?this.options.min:0)+Math.round(e/this.options.step)*this.options.step;return l<this.options.min?this.options.min:l>this.options.max?this.options.max:l},toPercentage:function(t){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var e,i,n,s=0,o=0;o<this.options.ticks.length;o++)if(t<=this.options.ticks[o]){e=o>0?this.options.ticks[o-1]:0,n=o>0?this.options.ticks_positions[o-1]:0,i=this.options.ticks[o],s=this.options.ticks_positions[o];break}if(o>0)return n+(t-e)/(i-e)*(s-n)}return 100*(t-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(t){var e=0===this.options.min?0:Math.log(this.options.min),i=Math.log(this.options.max),n=Math.exp(e+(i-e)*t/100);return Math.round(n)===this.options.max?this.options.max:(n=this.options.min+Math.round((n-this.options.min)/this.options.step)*this.options.step)<this.options.min?this.options.min:n>this.options.max?this.options.max:n},toPercentage:function(t){if(this.options.max===this.options.min)return 0;var e=Math.log(this.options.max),i=0===this.options.min?0:Math.log(this.options.min);return 100*((0===t?0:Math.log(t))-i)/(e-i)}}};function s(e,i){this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:!1,over:!1},this.ticksCallbackMap={},this.handleCallbackMap={},"string"==typeof e?this.element=document.querySelector(e):e instanceof HTMLElement&&(this.element=e),i=i||{};for(var s=Object.keys(this.defaultOptions),o=0;o<s.length;o++){var a=s[o],r=i[a];r=null!==(r=void 0!==r?r:l(this.element,a))?r:this.defaultOptions[a],this.options||(this.options={}),this.options[a]=r}function l(t,e){var i="data-slider-"+e.replace(/_/g,"-"),n=t.getAttribute(i);try{return JSON.parse(n)}catch(t){return n}}"auto"===this.options.rtl&&(this.options.rtl="rtl"===window.getComputedStyle(this.element).direction),"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.rtl?this.options.tooltip_position="left":this.options.tooltip_position="right";var c,h,u,d,g,p=this.element.style.width,f=!1,m=this.element.parentNode;if(this.sliderElem)f=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var v=document.createElement("div");v.className="slider-track",(h=document.createElement("div")).className="slider-track-low",(c=document.createElement("div")).className="slider-selection",(u=document.createElement("div")).className="slider-track-high",(d=document.createElement("div")).className="slider-handle min-slider-handle",d.setAttribute("role","slider"),d.setAttribute("aria-valuemin",this.options.min),d.setAttribute("aria-valuemax",this.options.max),(g=document.createElement("div")).className="slider-handle max-slider-handle",g.setAttribute("role","slider"),g.setAttribute("aria-valuemin",this.options.min),g.setAttribute("aria-valuemax",this.options.max),v.appendChild(h),v.appendChild(c),v.appendChild(u),this.rangeHighlightElements=[];var _=this.options.rangeHighlights;if(Array.isArray(_)&&_.length>0)for(var y=0;y<_.length;y++){var b=document.createElement("div"),x=_[y].class||"";b.className="slider-rangeHighlight slider-selection "+x,this.rangeHighlightElements.push(b),v.appendChild(b)}var C=Array.isArray(this.options.labelledby);if(C&&this.options.labelledby[0]&&d.setAttribute("aria-labelledby",this.options.labelledby[0]),C&&this.options.labelledby[1]&&g.setAttribute("aria-labelledby",this.options.labelledby[1]),!C&&this.options.labelledby&&(d.setAttribute("aria-labelledby",this.options.labelledby),g.setAttribute("aria-labelledby",this.options.labelledby)),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(this.ticksContainer=document.createElement("div"),this.ticksContainer.className="slider-tick-container",o=0;o<this.options.ticks.length;o++){var w=document.createElement("div");if(w.className="slider-tick",this.options.ticks_tooltip){var S=this._addTickListener(),M=S.addMouseEnter(this,w,o),E=S.addMouseLeave(this,w);this.ticksCallbackMap[o]={mouseEnter:M,mouseLeave:E}}this.ticks.push(w),this.ticksContainer.appendChild(w)}c.className+=" tick-slider-selection"}if(this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",o=0;o<this.options.ticks_labels.length;o++){var P=document.createElement("div"),A=0===this.options.ticks_positions.length,L=this.options.reversed&&A?this.options.ticks_labels.length-(o+1):o;P.className="slider-tick-label",P.innerHTML=this.options.ticks_labels[L],this.tickLabels.push(P),this.tickLabelContainer.appendChild(P)}var k=function(t){var e=document.createElement("div");e.className="tooltip-arrow";var i=document.createElement("div");i.className="tooltip-inner",t.appendChild(e),t.appendChild(i)},O=document.createElement("div");O.className="tooltip tooltip-main",O.setAttribute("role","presentation"),k(O);var D=document.createElement("div");D.className="tooltip tooltip-min",D.setAttribute("role","presentation"),k(D);var T=document.createElement("div");T.className="tooltip tooltip-max",T.setAttribute("role","presentation"),k(T),this.sliderElem.appendChild(v),this.sliderElem.appendChild(O),this.sliderElem.appendChild(D),this.sliderElem.appendChild(T),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),this.ticksContainer&&this.sliderElem.appendChild(this.ticksContainer),this.sliderElem.appendChild(d),this.sliderElem.appendChild(g),m.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(t&&(this.$element=t(this.element),this.$sliderElem=t(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.touchX=0,this.touchY=0,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),n[this.options.scale]&&(this.options.scale=n[this.options.scale]),!0===f&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.sliderElem,"slider-rtl"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","right","top","width","height"].forEach((function(t){this._removeProperty(this.trackLow,t),this._removeProperty(this.trackSelection,t),this._removeProperty(this.trackHigh,t)}),this),[this.handle1,this.handle2].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top")}),this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top"),this._removeProperty(t,"margin-left"),this._removeProperty(t,"margin-right"),this._removeProperty(t,"margin-top"),this._removeClass(t,"right"),this._removeClass(t,"left"),this._removeClass(t,"top")}),this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=p,this.options.orientation="horizontal",this.options.rtl?this.stylePos="right":this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this.options.rtl&&this._addClass(this.sliderElem,"slider-rtl"),this._setTooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this.options.range?this._state.value=[this.options.value,this.options.max]:this._state.value=this.options.value,this.trackLow=h||this.trackLow,this.trackSelection=c||this.trackSelection,this.trackHigh=u||this.trackHigh,"none"===this.options.selection?(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")):"after"!==this.options.selection&&"before"!==this.options.selection||(this._removeClass(this.trackLow,"hide"),this._removeClass(this.trackSelection,"hide"),this._removeClass(this.trackHigh,"hide")),this.handle1=d||this.handle1,this.handle2=g||this.handle2,!0===f)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),o=0;o<this.ticks.length;o++)this._removeClass(this.ticks[o],"round triangle hide");if(-1!==["round","triangle","custom"].indexOf(this.options.handle))for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),o=0;o<this.ticks.length;o++)this._addClass(this.ticks[o],this.options.handle);if(this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchstart=this._touchstart.bind(this),this.touchmove=this._touchmove.bind(this),this.touchCapable){var N=!1;try{var R=Object.defineProperty({},"passive",{get:function(){N=!0}});window.addEventListener("test",null,R)}catch(t){}var F=!!N&&{passive:!0};this.sliderElem.addEventListener("touchstart",this.touchstart,F),this.sliderElem.addEventListener("touchmove",this.touchmove,F)}if(this.sliderElem.addEventListener("mousedown",this.mousedown,!1),this.resize=this._resize.bind(this),window.addEventListener("resize",this.resize,!1),"hide"===this.options.tooltip)this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide");else if("always"===this.options.tooltip)this._showTooltip(),this._alwaysShowTooltip=!0;else{if(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.options.ticks_tooltip){var I=this._addTickListener(),z=I.addMouseEnter(this,this.handle1),j=I.addMouseLeave(this,this.handle1);this.handleCallbackMap.handle1={mouseEnter:z,mouseLeave:j},z=I.addMouseEnter(this,this.handle2),j=I.addMouseLeave(this,this.handle2),this.handleCallbackMap.handle2={mouseEnter:z,mouseLeave:j}}else this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1);this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)}this.options.enabled?this.enable():this.disable()}if((e=function(t,e){return s.call(this,t,e),this}).prototype={_init:function(){},constructor:e,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,rtl:"auto",enabled:!0,formatter:function(t){return Array.isArray(t)?t[0]+" : "+t[1]:t},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,ticks_tooltip:!1,scale:"linear",focus:!1,tooltip_position:null,labelledby:null,rangeHighlights:[]},getElement:function(){return this.sliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(t,e,i){t||(t=0);var n=this.getValue();this._state.value=this._validateInputValue(t);var s=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=s(this._state.value[0]),this._state.value[1]=s(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=s(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),"after"===this.options.selection?this._state.value[1]=this.options.max:this._state.value[1]=this.options.min),this.options.max>this.options.min?this._state.percentage=[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:this._state.percentage=[0,0,100],this._layout();var o=this.options.range?this._state.value:this._state.value[0];return this._setDataVal(o),!0===e&&this._trigger("slide",o),n!==o&&!0===i&&this._trigger("change",{oldValue:n,newValue:o}),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),t&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(t,e){return this._bindNonQueryEventHandler(t,e),this},off:function(e,i){t?(this.$element.off(e,i),this.$sliderElem.off(e,i)):this._unbindNonQueryEventHandler(e,i)},getAttribute:function(t){return t?this.options[t]:this.options},setAttribute:function(t,e){return this.options[t]=e,this},refresh:function(){return this._removeSliderEventHandlers(),s.call(this,this.element,this.options),t&&t.data(this.element,"slider",this),this},relayout:function(){return this._resize(),this._layout(),this},_removeSliderEventHandlers:function(){if(this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.options.ticks_tooltip){for(var t=this.ticksContainer.getElementsByClassName("slider-tick"),e=0;e<t.length;e++)t[e].removeEventListener("mouseenter",this.ticksCallbackMap[e].mouseEnter,!1),t[e].removeEventListener("mouseleave",this.ticksCallbackMap[e].mouseLeave,!1);this.handle1.removeEventListener("mouseenter",this.handleCallbackMap.handle1.mouseEnter,!1),this.handle2.removeEventListener("mouseenter",this.handleCallbackMap.handle2.mouseEnter,!1),this.handle1.removeEventListener("mouseleave",this.handleCallbackMap.handle1.mouseLeave,!1),this.handle2.removeEventListener("mouseleave",this.handleCallbackMap.handle2.mouseLeave,!1)}this.handleCallbackMap=null,this.ticksCallbackMap=null,this.showTooltip&&(this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle2.removeEventListener("focus",this.showTooltip,!1)),this.hideTooltip&&(this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("blur",this.hideTooltip,!1)),this.showTooltip&&this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.hideTooltip&&this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.touchstart,!1),this.sliderElem.removeEventListener("touchmove",this.touchmove,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1),window.removeEventListener("resize",this.resize,!1)},_bindNonQueryEventHandler:function(t,e){void 0===this.eventToCallbackMap[t]&&(this.eventToCallbackMap[t]=[]),this.eventToCallbackMap[t].push(e)},_unbindNonQueryEventHandler:function(t,e){var i=this.eventToCallbackMap[t];if(void 0!==i)for(var n=0;n<i.length;n++)if(i[n]===e){i.splice(n,1);break}},_cleanUpEventCallbacksMap:function(){for(var t=Object.keys(this.eventToCallbackMap),e=0;e<t.length;e++){var i=t[e];delete this.eventToCallbackMap[i]}},_showTooltip:function(){!1===this.options.tooltip_split?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hideTooltip:function(){!1===this._state.inDrag&&!0!==this.alwaysShowTooltip&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_setToolTipOnMouseOver:function(t){var e=this.options.formatter(t?t.value[0]:this._state.value[0]),i=n(t||this._state,this.options.reversed);function n(t,e){return e?[100-t.percentage[0],this.options.range?100-t.percentage[1]:t.percentage[1]]:[t.percentage[0],t.percentage[1]]}this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=i[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px")},_addTickListener:function(){return{addMouseEnter:function(t,e,i){var n=function(){var e=t._state,n=i>=0?i:this.attributes["aria-valuenow"].value,s=parseInt(n,10);e.value[0]=s,e.percentage[0]=t.options.ticks_positions[s],t._setToolTipOnMouseOver(e),t._showTooltip()};return e.addEventListener("mouseenter",n,!1),n},addMouseLeave:function(t,e){var i=function(){t._hideTooltip()};return e.addEventListener("mouseleave",i,!1),i}}},_layout:function(){var t,e;if(t=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=t[0]+"%",this.handle1.setAttribute("aria-valuenow",this._state.value[0]),isNaN(this.options.formatter(this._state.value[0]))&&this.handle1.setAttribute("aria-valuetext",this.options.formatter(this._state.value[0])),this.handle2.style[this.stylePos]=t[1]+"%",this.handle2.setAttribute("aria-valuenow",this._state.value[1]),isNaN(this.options.formatter(this._state.value[1]))&&this.handle2.setAttribute("aria-valuetext",this.options.formatter(this._state.value[1])),this.rangeHighlightElements.length>0&&Array.isArray(this.options.rangeHighlights)&&this.options.rangeHighlights.length>0)for(var i=0;i<this.options.rangeHighlights.length;i++){var n=this._toPercentage(this.options.rangeHighlights[i].start),s=this._toPercentage(this.options.rangeHighlights[i].end);if(this.options.reversed){var o=100-s;s=100-n,n=o}var a=this._createHighlightRange(n,s);a?"vertical"===this.options.orientation?(this.rangeHighlightElements[i].style.top=a.start+"%",this.rangeHighlightElements[i].style.height=a.size+"%"):(this.options.rtl?this.rangeHighlightElements[i].style.right=a.start+"%":this.rangeHighlightElements[i].style.left=a.start+"%",this.rangeHighlightElements[i].style.width=a.size+"%"):this.rangeHighlightElements[i].style.display="none"}if(Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var r,l="vertical"===this.options.orientation?"height":"width";r="vertical"===this.options.orientation?"marginTop":this.options.rtl?"marginRight":"marginLeft";var c=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var h=0;if(0===this.options.ticks_positions.length)"vertical"!==this.options.orientation&&(this.tickLabelContainer.style[r]=-c/2+"px"),h=this.tickLabelContainer.offsetHeight;else for(u=0;u<this.tickLabelContainer.childNodes.length;u++)this.tickLabelContainer.childNodes[u].offsetHeight>h&&(h=this.tickLabelContainer.childNodes[u].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=h+"px")}for(var u=0;u<this.options.ticks.length;u++){var d=this.options.ticks_positions[u]||this._toPercentage(this.options.ticks[u]);this.options.reversed&&(d=100-d),this.ticks[u].style[this.stylePos]=d+"%",this._removeClass(this.ticks[u],"in-selection"),this.options.range?d>=t[0]&&d<=t[1]&&this._addClass(this.ticks[u],"in-selection"):"after"===this.options.selection&&d>=t[0]?this._addClass(this.ticks[u],"in-selection"):"before"===this.options.selection&&d<=t[0]&&this._addClass(this.ticks[u],"in-selection"),this.tickLabels[u]&&(this.tickLabels[u].style[l]=c+"px","vertical"!==this.options.orientation&&void 0!==this.options.ticks_positions[u]?(this.tickLabels[u].style.position="absolute",this.tickLabels[u].style[this.stylePos]=d+"%",this.tickLabels[u].style[r]=-c/2+"px"):"vertical"===this.options.orientation&&(this.options.rtl?this.tickLabels[u].style.marginRight=this.sliderElem.offsetWidth+"px":this.tickLabels[u].style.marginLeft=this.sliderElem.offsetWidth+"px",this.tickLabelContainer.style[r]=this.sliderElem.offsetWidth/2*-1+"px"))}}if(this.options.range){e=this.options.formatter(this._state.value),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=(t[1]+t[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");var g=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,g);var p=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,p),this.tooltip_min.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=t[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetWidth/2+"px")}else e=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(t[0],t[1])+"%",this.trackSelection.style.top=Math.min(t[0],t[1])+"%",this.trackSelection.style.height=Math.abs(t[0]-t[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";else{"right"===this.stylePos?this.trackLow.style.right="0":this.trackLow.style.left="0",this.trackLow.style.width=Math.min(t[0],t[1])+"%","right"===this.stylePos?this.trackSelection.style.right=Math.min(t[0],t[1])+"%":this.trackSelection.style.left=Math.min(t[0],t[1])+"%",this.trackSelection.style.width=Math.abs(t[0]-t[1])+"%","right"===this.stylePos?this.trackHigh.style.left="0":this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";var f=this.tooltip_min.getBoundingClientRect(),m=this.tooltip_max.getBoundingClientRect();"bottom"===this.options.tooltip_position?f.right>m.left?(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="",this.tooltip_max.style.bottom="22px"):(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top=this.tooltip_min.style.top,this.tooltip_max.style.bottom=""):f.right>m.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}},_createHighlightRange:function(t,e){return this._isHighlightRange(t,e)?t>e?{start:e,size:t-e}:{start:t,size:e-t}:null},_isHighlightRange:function(t,e){return 0<=t&&t<=100&&0<=e&&e<=100},_resize:function(t){this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this._layout()},_removeProperty:function(t,e){t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(e)},_mousedown:function(t){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos];var e=this._getPercentage(t);if(this.options.range){var i=Math.abs(this._state.percentage[0]-e),n=Math.abs(this._state.percentage[1]-e);this._state.dragged=i<n?0:1,this._adjustPercentageForRangeSliders(e)}else this._state.dragged=0;this._state.percentage[this._state.dragged]=e,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var s=this._calculateValue();return this._trigger("slideStart",s),this._setDataVal(s),this.setValue(s,!1,!0),t.returnValue=!1,this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_touchstart:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0];this.touchX=e.pageX,this.touchY=e.pageY}else this._mousedown(t)},_triggerFocusOnHandle:function(t){0===t&&this.handle1.focus(),1===t&&this.handle2.focus()},_keydown:function(t,e){if(!this._state.enabled)return!1;var i;switch(e.keyCode){case 37:case 40:i=-1;break;case 39:case 38:i=1}if(i){if(this.options.natural_arrow_keys){var n="vertical"===this.options.orientation&&!this.options.reversed,s="horizontal"===this.options.orientation&&this.options.reversed;(n||s)&&(i=-i)}var o=this._state.value[t]+i*this.options.step,a=o/this.options.max*100;return this._state.keyCtrl=t,this.options.range&&(this._adjustPercentageForRangeSliders(a),o=[this._state.keyCtrl?this._state.value[0]:o,this._state.keyCtrl?o:this._state.value[1]]),this._trigger("slideStart",o),this._setDataVal(o),this.setValue(o,!0,!0),this._setDataVal(o),this._trigger("slideStop",o),this._layout(),this._pauseEvent(e),delete this._state.keyCtrl,!1}},_pauseEvent:function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1},_mousemove:function(t){if(!this._state.enabled)return!1;var e=this._getPercentage(t);this._adjustPercentageForRangeSliders(e),this._state.percentage[this._state.dragged]=e,this._layout();var i=this._calculateValue(!0);return this.setValue(i,!0,!0),!1},_touchmove:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0],i=e.pageX-this.touchX,n=e.pageY-this.touchY;this._state.inDrag||("vertical"===this.options.orientation&&i<=5&&i>=-5&&(n>=15||n<=-15)?this._mousedown(t):n<=5&&n>=-5&&(i>=15||i<=-15)&&this._mousedown(t))}},_adjustPercentageForRangeSliders:function(t){if(this.options.range){var e=this._getNumDigitsAfterDecimalPlace(t);e=e?e-1:0;var i=this._applyToFixedAndParseFloat(t,e);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],e)<i?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],e)>i?(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0):0===this._state.keyCtrl&&this._state.value[1]/this.options.max*100<t?(this._state.percentage[0]=this._state.percentage[1],this._state.keyCtrl=1,this.handle2.focus()):1===this._state.keyCtrl&&this._state.value[0]/this.options.max*100>t&&(this._state.percentage[1]=this._state.percentage[0],this._state.keyCtrl=0,this.handle1.focus())}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,!1===this._state.over&&this._hideTooltip();var t=this._calculateValue(!0);return this._layout(),this._setDataVal(t),this._trigger("slideStop",t),!1},_calculateValue:function(t){var e;if(this.options.range?(e=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(e[0]=this._toValue(this._state.percentage[0]),e[0]=this._applyPrecision(e[0])),100!==this._state.percentage[1]&&(e[1]=this._toValue(this._state.percentage[1]),e[1]=this._applyPrecision(e[1]))):(e=this._toValue(this._state.percentage[0]),e=parseFloat(e),e=this._applyPrecision(e)),t){for(var i=[e,1/0],n=0;n<this.options.ticks.length;n++){var s=Math.abs(this.options.ticks[n]-e);s<=i[1]&&(i=[this.options.ticks[n],s])}if(i[1]<=this.options.ticks_snap_bounds)return i[0]}return e},_applyPrecision:function(t){var e=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(t,e)},_getNumDigitsAfterDecimalPlace:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},_applyToFixedAndParseFloat:function(t,e){var i=t.toFixed(e);return parseFloat(i)},_getPercentage:function(t){!this.touchCapable||"touchstart"!==t.type&&"touchmove"!==t.type||(t=t.touches[0]);var e=t[this.mousePos]-this._state.offset[this.stylePos];"right"===this.stylePos&&(e=-e);var i=e/this._state.size*100;return i=Math.round(i/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(i=100-i),Math.max(0,Math.min(100,i))},_validateInputValue:function(t){if(isNaN(+t)){if(Array.isArray(t))return this._validateArray(t),t;throw new Error(i(t))}return+t},_validateArray:function(t){for(var e=0;e<t.length;e++){var n=t[e];if("number"!=typeof n)throw new Error(i(n))}},_setDataVal:function(t){this.element.setAttribute("data-value",t),this.element.setAttribute("value",t),this.element.value=t},_trigger:function(e,i){i=i||0===i?i:void 0;var n=this.eventToCallbackMap[e];if(n&&n.length)for(var s=0;s<n.length;s++)(0,n[s])(i);t&&this._triggerJQueryEvent(e,i)},_triggerJQueryEvent:function(t,e){var i={type:t,value:e};this.$element.trigger(i),this.$sliderElem.trigger(i)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(t,e){void 0!==t.textContent?t.textContent=e:void 0!==t.innerText&&(t.innerText=e)},_removeClass:function(t,e){for(var i=e.split(" "),n=t.className,s=0;s<i.length;s++){var o=i[s],a=new RegExp("(?:\\s|^)"+o+"(?:\\s|$)");n=n.replace(a," ")}t.className=n.trim()},_addClass:function(t,e){for(var i=e.split(" "),n=t.className,s=0;s<i.length;s++){var o=i[s];new RegExp("(?:\\s|^)"+o+"(?:\\s|$)").test(n)||(n+=" "+o)}t.className=n.trim()},_offsetLeft:function(t){return t.getBoundingClientRect().left},_offsetRight:function(t){return t.getBoundingClientRect().right},_offsetTop:function(t){for(var e=t.offsetTop;(t=t.offsetParent)&&!isNaN(t.offsetTop);)e+=t.offsetTop,"BODY"!==t.tagName&&(e-=t.scrollTop);return e},_offset:function(t){return{left:this._offsetLeft(t),right:this._offsetRight(t),top:this._offsetTop(t)}},_css:function(e,i,n){if(t)t.style(e,i,n);else{var s=i.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(t,e){return e.toUpperCase()}));e.style[s]=n}},_toValue:function(t){return this.options.scale.toValue.apply(this,[t])},_toPercentage:function(t){return this.options.scale.toPercentage.apply(this,[t])},_setTooltipPosition:function(){var t=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var e,i="left"===(e=this.options.tooltip_position?this.options.tooltip_position:this.options.rtl?"left":"right")?"right":"left";t.forEach(function(t){this._addClass(t,e),t.style[i]="100%"}.bind(this))}else"bottom"===this.options.tooltip_position?t.forEach(function(t){this._addClass(t,"bottom"),t.style.top="22px"}.bind(this)):t.forEach(function(t){this._addClass(t,"top"),t.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},t&&t.fn){var o=void 0;t.fn.slider?(r&&window.console.warn("bootstrap-slider.js - WARNING: $.fn.slider namespace is already bound. Use the $.fn.bootstrapSlider namespace instead."),o="bootstrapSlider"):(t.bridget("slider",e),o="slider"),t.bridget("bootstrapSlider",e),t((function(){t("input[data-provide=slider]")[o]()}))}}(t),e})?n.apply(e,s):n)||(t.exports=o)},4656:function(t,e,i){},4657:function(t,e,i){},4658:function(t,e,i){},4659:function(t,e,i){"use strict";i.d(e,"b",(function(){return M})),i.d(e,"a",(function(){return E}));var n=i(0),s=i.n(n),o=i(2),a=i.n(o),r=i(134),l=i(4647),c=i(917),h=i(4648),u=i(4661),d=i(4665),g=i(4646),p=i(4643),f=i(4640);function m(){return(m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const{getScale:_}=c.b;const y={formData:a.a.object.isRequired,mapboxApiKey:a.a.string.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,getLayer:a.a.func.isRequired,getPoints:a.a.func.isRequired,payload:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired};class b extends s.a.PureComponent{constructor(t){super(t),v(this,"containerRef",s.a.createRef()),v(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state=this.getStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(t){t.payload.form_data!==this.state.formData&&this.setState(m({},this.getStateFromProps(t)))}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getStateFromProps(t,e){const i=t.payload.data.features||[],n=i.map(t=>t.__timestamp),s=function(t,e){const i=t.color_picker||{r:0,g:0,b:0,a:1},n=[i.r,i.g,i.b,255*i.a],s=_(t.color_scheme),o={};return e.forEach(e=>{if(null!=e.cat_color&&!o.hasOwnProperty(e.cat_color)){let a;a=t.dimension?Object(d.hexToRGB)(s(e.cat_color),255*i.a):n,o[e.cat_color]={color:a,enabled:!0}}}),o}(t.formData,i);if(e&&t.payload.form_data===e.formData)return m({},e,{categories:s});const o=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:a,end:r,getStep:l,values:c,disabled:h}=Object(g.a)(n,o),{width:u,height:p,formData:v}=t;let{viewport:y}=t;return v.autozoom&&(y=Object(f.a)(y,{width:u,height:p,points:t.getPoints(i)})),y.zoom<0&&(y.zoom=0),{start:a,end:r,getStep:l,values:c,disabled:h,viewport:y,selected:[],lastClick:0,formData:t.payload.form_data,categories:s}}getLayers(t){const{getLayer:e,payload:i,formData:n,onAddFilter:s}=this.props;let o=i.data.features?[...i.data.features]:[];if(o=this.addColor(o,n),n.js_data_mutator){o=Object(p.a)(n.js_data_mutator)(o)}o=t[0]===t[1]||t[1]===this.end?o.filter(e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1]):o.filter(e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]);const a=this.state.categories;return n.dimension&&(o=o.filter(t=>a[t.cat_color]&&a[t.cat_color].enabled)),[e(n,m({},i,{data:m({},i.data,{features:o})}),s,this.setTooltip)]}addColor(t,e){const i=e.color_picker||{r:0,g:0,b:0,a:1},n=_(e.color_scheme);return t.map(t=>{let s;return e.dimension?(s=Object(d.hexToRGB)(n(t.cat_color),255*i.a),m({},t,{color:s})):t})}toggleCategory(t){const e=this.state.categories[t],i=m({},this.state.categories,{[t]:m({},e,{enabled:!e.enabled})});Object.values(i).every(t=>!t.enabled)&&Object.values(i).forEach(t=>{t.enabled=!0}),this.setState({categories:i})}showSingleCategory(t){const e=m({},this.state.categories);Object.values(e).forEach(t=>{t.enabled=!1}),e[t].enabled=!0,this.setState({categories:e})}render(){return s.a.createElement("div",{style:{position:"relative"}},s.a.createElement(h.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},s.a.createElement(u.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function x(){return(x=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function C(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}b.propTypes=y;const w={formData:a.a.object.isRequired,payload:a.a.object.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired},S={onAddFilter(){}};function M(t,e){class i extends s.a.PureComponent{constructor(t){super(t),C(this,"containerRef",s.a.createRef()),C(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)});const{width:i,height:n,formData:o}=t;let{viewport:a}=t;o.autozoom&&(a=Object(f.a)(a,{width:i,height:n,points:e(t.payload.data.features)})),this.state={viewport:a,layer:this.computeLayer(t)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(t){const e=x({},t.formData,{viewport:null}),i=x({},this.props.formData,{viewport:null});Object(r.isEqual)(e,i)&&t.payload===this.props.payload||this.setState({layer:this.computeLayer(t)})}onViewportChange(t){this.setState({viewport:t})}computeLayer(e){const{formData:i,payload:n,onAddFilter:s}=e;return t(i,n,s,this.setTooltip)}render(){const{formData:t,payload:e,setControlValue:i,height:n,width:o}=this.props,{layer:a,viewport:r}=this.state;return s.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:r,layers:[a],mapStyle:t.mapbox_style,setControlValue:i,width:o,height:n,onViewportChange:this.onViewportChange})}}return i.propTypes=w,i.defaultProps=S,i}function E(t,e){function i(i){const{formData:n,payload:o,setControlValue:a,viewport:r,width:l,height:c}=i;return s.a.createElement(b,{formData:n,mapboxApiKey:o.data.mapboxApiKey,setControlValue:a,viewport:r,getLayer:t,payload:o,getPoints:e,width:l,height:c})}return i.propTypes=w,i.defaultProps=S,i}},4661:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(0),s=i.n(n),o=i(2),a=i.n(o),r=i(302);i(4662);const l={categories:a.a.object,toggleCategory:a.a.func,showSingleCategory:a.a.func,format:a.a.string,position:a.a.oneOf([null,"tl","tr","bl","br"])};class c extends s.a.PureComponent{format(t){if(!this.props.format)return t;const e=parseFloat(t);return Object(r.b)(this.props.format,e)}formatCategoryLabel(t){if(!this.props.format)return t;if(t.includes(" - ")){const e=t.split(" - ");return this.format(e[0])+" - "+this.format(e[1])}return this.format(t)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const t=Object.entries(this.props.categories).map(t=>{let[e,i]=t;const n={color:"rgba("+i.color.join(", ")+")"},o=i.enabled?"":"";return s.a.createElement("li",{key:e},s.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},s.a.createElement("span",{style:n},o)," ",this.formatCategoryLabel(e)))}),e={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return s.a.createElement("div",{className:"legend",style:e},s.a.createElement("ul",{className:"categories"},t))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},4662:function(t,e,i){},4663:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return s}));const n=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function s(t,e=!1,i=Float32Array){let n;if(Number.isFinite(t[0]))n=new i(t);else{n=new i(4*t.length);let e=0;for(let i=0;i<t.length;i++){const s=t[i];n[e++]=s[0],n[e++]=s[1],n[e++]=s[2],n[e++]=Number.isFinite(s[3])?s[3]:255}}if(e)for(let t=0;t<n.length;t++)n[t]/=255;return n}},4670:function(t,e,i){"use strict";i.d(e,"a",(function(){return S}));var n=i(4867),s=i(5018),o=i(4636),a=i(4997),r=i(4992),l=i(5057),c=i(4835),h=i(4653),u=i(4874),d=i(4802),g=i(4652);const p={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},f=[32775,32774],m=[32776,32774],v=[32776,32775],_={[g.a.SUM]:32774,[g.a.MEAN]:32774,[g.a.MIN]:f,[g.a.MAX]:m},y={size:1,operation:g.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1};var b=i(4694);const x=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],C={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},w=[n.a.WEBGL2,n.a.COLOR_ATTACHMENT_RGBA32F,n.a.BLEND_EQUATION_MINMAX,n.a.FLOAT_BLEND,n.a.TEXTURE_FLOAT];class S{static getAggregationData({aggregationData:t,maxData:e,minData:i,maxMinData:n,pixelIndex:s}){const o=4*s,a={};return t&&(a.cellCount=t[o+3],a.cellWeight=t[o]),n?(a.maxCellWieght=n[0],a.minCellWeight=n[3]):(e&&(a.maxCellWieght=e[0],a.totalCount=e[3]),i&&(a.minCellWeight=i[0],a.totalCount=e[3])),a}static getCellData({countsData:t,size:e=1}){const i=t.length/4,n=new Float32Array(i*e),s=new Uint32Array(i);for(let o=0;o<i;o++){for(let i=0;i<e;i++)n[o*e+i]=t[4*o+i];s[o]=t[4*o+3]}return{cellCounts:s,cellWeights:n}}static isSupported(t){return Object(s.c)(t,w)}constructor(t,e={}){this.id=e.id||"gpu-grid-aggregator",this.gl=t,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(o.i)(t)&&Object(s.c)(this.gl,n.a.BLEND_EQUATION_MINMAX,n.a.COLOR_ATTACHMENT_RGBA32F,n.a.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:t,allAggregationModel:e,meanTransform:i}=this,{textures:n,framebuffers:s,maxMinFramebuffers:o,minFramebuffers:a,maxFramebuffers:r,meanTextures:l,resources:c}=this.state;null==t||t.delete(),null==e||e.delete(),null==i||i.delete(),function(t){(t=Array.isArray(t)?t:[t]).forEach(t=>{for(const e in t)t[e].delete()})}([s,n,o,a,r,l,c])}run(t={}){this.setState({results:{}});const e=this._normalizeAggregationParams(t);return this._hasGPUSupport||h.a.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(e)}getData(t){const e={},i=this.state.results;i[t].aggregationData||(i[t].aggregationData=i[t].aggregationBuffer.getData()),e.aggregationData=i[t].aggregationData;for(const n in C){const s=C[n];(i[t][n]||i[t][s])&&(i[t][n]=i[t][n]||i[t][s].getData(),e[n]=i[t][n])}return e}updateShaders(t={}){this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){const e={...p,...t},{weights:i}=e;return i&&(e.weights=function(t){const e={};for(const i in t)e[i]={...y,...t[i]};return e}(i)),e}setState(t){Object.assign(this.state,t)}_getAggregateData(t){const e={},{textures:i,framebuffers:n,maxMinFramebuffers:s,minFramebuffers:o,maxFramebuffers:r,resources:l}=this.state,{weights:c}=t;for(const t in c){e[t]={};const{needMin:h,needMax:u,combineMaxMin:d}=c[t];e[t].aggregationTexture=i[t],e[t].aggregationBuffer=Object(a.d)(n[t],{target:c[t].aggregationBuffer,sourceType:5126}),h&&u&&d?(e[t].maxMinBuffer=Object(a.d)(s[t],{target:c[t].maxMinBuffer,sourceType:5126}),e[t].maxMinTexture=l["".concat(t,"-maxMinTexture")]):(h&&(e[t].minBuffer=Object(a.d)(o[t],{target:c[t].minBuffer,sourceType:5126}),e[t].minTexture=l["".concat(t,"-minTexture")]),u&&(e[t].maxBuffer=Object(a.d)(r[t],{target:c[t].maxBuffer,sourceType:5126}),e[t].maxTexture=l["".concat(t,"-maxTexture")]))}return this._trackGPUResultBuffers(e,c),e}_renderAggregateData(t){const{cellSize:e,projectPoints:i,attributes:n,moduleSettings:s,numCol:o,numRow:a,weights:r,translation:l,scaling:c}=t,{maxMinFramebuffers:h,minFramebuffers:u,maxFramebuffers:d}=this.state,g=[o,a],p={blend:!0,depthTest:!1,blendFunc:[1,1]},_={cellSize:e,gridSize:g,projectPoints:i,translation:l,scaling:c};for(const t in r){const{needMin:e,needMax:i}=r[t],o=e&&i&&r[t].combineMaxMin;this._renderToWeightsTexture({id:t,parameters:p,moduleSettings:s,uniforms:_,gridSize:g,attributes:n,weights:r}),o?this._renderToMaxMinTexture({id:t,parameters:{...p,blendEquation:v},gridSize:g,minOrMaxFb:h[t],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:o}):(e&&this._renderToMaxMinTexture({id:t,parameters:{...p,blendEquation:f},gridSize:g,minOrMaxFb:u[t],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:o}),i&&this._renderToMaxMinTexture({id:t,parameters:{...p,blendEquation:m},gridSize:g,minOrMaxFb:d[t],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:o}))}}_renderToMaxMinTexture(t){const{id:e,parameters:i,gridSize:n,minOrMaxFb:s,combineMaxMin:a,clearParams:r={}}=t,{framebuffers:l}=this.state,{gl:c,allAggregationModel:h}=this;Object(o.n)(c,{...r,framebuffer:s,viewport:[0,0,n[0],n[1]]},()=>{c.clear(16384),h.draw({parameters:i,uniforms:{uSampler:l[e].texture,gridSize:n,combineMaxMin:a}})})}_renderToWeightsTexture(t){const{id:e,parameters:i,moduleSettings:n,uniforms:s,gridSize:a,weights:r}=t,{framebuffers:c,equations:h,weightAttributes:u}=this.state,{gl:d,gridAggregationModel:p}=this,{operation:f}=r[e],m=f===g.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];if(Object(o.n)(d,{framebuffer:c[e],viewport:[0,0,a[0],a[1]],clearColor:m},()=>{d.clear(16384);const t={weights:u[e]};p.draw({parameters:{...i,blendEquation:h[e]},moduleSettings:n,uniforms:s,attributes:t})}),f===g.a.MEAN){const{meanTextures:t,textures:i}=this.state,n={_sourceTextures:{aggregationValues:t[e]},_targetTexture:i[e],elementCount:i[e].width*i[e].height};this.meanTransform?this.meanTransform.update(n):this.meanTransform=function(t,e){return new l.a(t,{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n  gl_PointSize = 1.0;\n}\n",_targetTextureVarying:"meanValues",...e})}(d,n),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),c[e].attach({36064:i[e]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);const e=this._getAggregateData(t);return this.setState({results:e}),e}_setupFramebuffers(t){const{textures:e,framebuffers:i,maxMinFramebuffers:n,minFramebuffers:s,maxFramebuffers:o,meanTextures:a,equations:r}=this.state,{weights:l}=t,{numCol:c,numRow:h}=t,u={width:c,height:h};for(const t in l){const{needMin:d,needMax:p,combineMaxMin:f,operation:m}=l[t];e[t]=l[t].aggregationTexture||e[t]||Object(b.a)(this.gl,{id:"".concat(t,"-texture"),width:c,height:h}),e[t].resize(u);let v=e[t];m===g.a.MEAN&&(a[t]=a[t]||Object(b.a)(this.gl,{id:"".concat(t,"-mean-texture"),width:c,height:h}),a[t].resize(u),v=a[t]),i[t]?i[t].attach({36064:v}):i[t]=Object(b.b)(this.gl,{id:"".concat(t,"-fb"),width:c,height:h,texture:v}),i[t].resize(u),r[t]=_[m]||_.SUM,(d||p)&&(d&&p&&f?n[t]||(v=l[t].maxMinTexture||this._getMinMaxTexture("".concat(t,"-maxMinTexture")),n[t]=Object(b.b)(this.gl,{id:"".concat(t,"-maxMinFb"),texture:v})):(d&&(s[t]||(v=l[t].minTexture||this._getMinMaxTexture("".concat(t,"-minTexture")),s[t]=Object(b.b)(this.gl,{id:"".concat(t,"-minFb"),texture:v}))),p&&(o[t]||(v=l[t].maxTexture||this._getMinMaxTexture("".concat(t,"-maxTexture")),o[t]=Object(b.b)(this.gl,{id:"".concat(t,"-maxFb"),texture:v})))))}}_getMinMaxTexture(t){const{resources:e}=this.state;return e[t]||(e[t]=Object(b.a)(this.gl,{id:"resourceName"})),e[t]}_setupModels({numCol:t=0,numRow:e=0}={}){var i;const{gl:n}=this,{shaderOptions:s}=this.state;if(null===(i=this.gridAggregationModel)||void 0===i||i.delete(),this.gridAggregationModel=function(t,e){const i=Object(u.a)({vs:"#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 weights;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform bool projectPoints;\nuniform vec2 translation;\nuniform vec3 scaling;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result;\n  pos.xy = pos.xy/pos.w;\n  result = pos + vec4(translation, 0., 0.);\n  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;\n  return result.xy;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n\n  vec2 pixelXY64[2];\n  pixelXY64[0] = vec2(pos.x, 0.);\n  pixelXY64[1] = vec2(pos.y, 0.);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",fs:"#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[c.a,d.a]},e);return new r.a(t,{id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0,...i})}(n,s),!this.allAggregationModel){const i=t*e;this.allAggregationModel=function(t,e){return new r.a(t,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:[c.a],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}(n,i)}}_setupWeightAttributes(t){const{weightAttributes:e}=this.state,{weights:i}=t;for(const n in i)e[n]=t.attributes[n]}_trackGPUResultBuffers(t,e){const{resources:i}=this.state;for(const n in t)if(t[n])for(const s of x)if(t[n][s]&&e[n][s]!==t[n][s]){const e="gpu-result-".concat(n,"-").concat(s);i[e]&&i[e].delete(),i[e]=t[n][s]}}_updateModels(t){const{vertexCount:e,attributes:i,numCol:n,numRow:s}=t,{modelDirty:o}=this.state;o&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(e),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(n*s)}}},4673:function(t,e,i){"use strict";i.d(e,"c",(function(){return g})),i.d(e,"b",(function(){return p})),i.d(e,"a",(function(){return f})),i.d(e,"d",(function(){return m}));var n=i(4653);function s(t,e,i){const n=i;return n.domain=()=>t,n.range=()=>e,n}function o(t,e){return s(t,e,i=>function(t,e,i){const s=t[1]-t[0];if(s<=0)return n.a.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const o=s/e.length,a=Math.floor((i-t[0])/o),r=Math.max(Math.min(a,e.length-1),0);return e[r]}(t,e,i))}function a(t,e){return s(t,e,i=>function(t,e,i){return(i-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}(t,e,i))}function r(t,e){const i=t.sort(l);let n=0;const o=Math.max(1,e.length),a=new Array(o-1);for(;++n<o;)a[n-1]=c(i,n/o);const r=t=>function(t,e,i){return e[function(t,e){let i=0,n=t.length;for(;i<n;){const s=i+n>>>1;l(t[s],e)>0?n=s:i=s+1}return i}(t,i)]}(a,e,t);return r.thresholds=()=>a,s(t,e,r)}function l(t,e){return t-e}function c(t,e){const i=t.length;if(e<=0||i<2)return t[0];if(e>=1)return t[i-1];const n=(i-1)*e,s=Math.floor(n),o=t[s];return o+(t[s+1]-o)*(n-s)}function h(t,e){const i=new Map,n=[];for(const e of t){const t="".concat(e);i.has(t)||i.set(t,n.push(e))}return s(t,e,t=>function(t,e,i,n){const s="".concat(n);let o=e.get(s);return void 0===o&&(o=t.push(n),e.set(s,o)),i[(o-1)%i.length]}(n,i,e,t))}function u(t){return null!=t}function d(t,e){return("function"==typeof e?t.map(e):t).filter(u)}function g(t,e){return d(t,e)}function p(t,e){return function(t){const e=[];return t.forEach(t=>{!e.includes(t)&&u(t)&&e.push(t)}),e}(d(t,e))}function f(t,e,i){return Math.max(e,Math.min(i,t))}function m(t){switch(t){case"quantize":return o;case"linear":return a;case"quantile":return r;case"ordinal":return h;default:return o}}},4674:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n=i(4723),s=i(4875),o=i(4993),a=i(4636);function r(t,e){const i={};for(const n in t)e.includes(n)||(i[n]=t[n]);return i}class l extends n.a{initializeState(t){super.initializeState(),this.setState({ignoreProps:r(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes(t.props)}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:i}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:Object(a.e)(i)})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:i,oldProps:n,changeFlags:o}=t,{compareAll:a=!1,dimension:r}=e,{ignoreProps:l}=this.state,{props:c,accessors:h=[]}=r,{updateTriggersChanged:u}=o;if(o.dataChanged)return!0;if(u){if(u.all)return!0;for(const t of h)if(u[t])return!0}if(a)return!!o.extensionsChanged||Object(s.a)({oldProps:n,newProps:i,ignoreProps:l,propTypes:this.constructor._propTypes});for(const t of c)if(i[t]!==n[t])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const i in t){e=!1;break}return e}(e)}_getAttributeManager(){return new o.a(this.context.gl,{id:this.props.id,stats:this.context.stats})}}l.layerName="AggregationLayer"},4679:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(4692),s=i(4695);function o(t,e){const i=function(t,e){const{data:i=[],cellSize:o}=t,{attributes:a,viewport:r,projectPoints:l,numInstances:c}=e,h=a.positions.value,{size:u}=a.positions.getAccessor(),d=e.boundingBox||function(t,e){const i=t.value,{size:n}=t.getAccessor();let s,o,a=1/0,r=-1/0,l=1/0,c=-1/0;for(let t=0;t<e;t++)o=i[t*n],s=i[t*n+1],Number.isFinite(o)&&Number.isFinite(s)&&(a=s<a?s:a,r=s>r?s:r,l=o<l?o:l,c=o>c?o:c);return{xMin:l,xMax:c,yMin:a,yMax:r}}(a.positions,c),g=e.posOffset||[180,90],p=e.gridOffset||Object(s.b)(d,o);if(p.xOffset<=0||p.yOffset<=0)return{gridHash:{},gridOffset:p};const{width:f,height:m}=r,v=Math.ceil(f/p.xOffset),_=Math.ceil(m/p.yOffset),y={},{iterable:b,objectInfo:x}=Object(n.a)(i),C=new Array(3);for(const t of b){x.index++,C[0]=h[x.index*u],C[1]=h[x.index*u+1],C[2]=u>=3?h[x.index*u+2]:0;const[e,i]=l?r.project(C):C;if(Number.isFinite(e)&&Number.isFinite(i)){const n=Math.floor((i+g[1])/p.yOffset),s=Math.floor((e+g[0])/p.xOffset);if(!l||s>=0&&s<v&&n>=0&&n<_){const e="".concat(n,"-").concat(s);y[e]=y[e]||{count:0,points:[],lonIdx:s,latIdx:n},y[e].count+=1,y[e].points.push({source:t,index:x.index})}}}return{gridHash:y,gridOffset:p,offsets:[-1*g[0],-1*g[1]]}}(t,e),o=function({gridHash:t,gridOffset:e,offsets:i}){const n=new Array(Object.keys(t).length);let s=0;for(const o in t){const a=o.split("-"),r=parseInt(a[0],10),l=parseInt(a[1],10),c=s++;n[c]={index:c,position:[i[0]+e.xOffset*l,i[1]+e.yOffset*r],...t[o]}}return n}(i);return{gridHash:i.gridHash,gridOffset:i.gridOffset,data:o}}},4680:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(4673);const s=t=>t.length,o=t=>t.points,a=t=>t.index,r=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,l={getValue:s,getPoints:o,getIndex:a,filterData:null};class c{constructor(t=[],e=l){this.aggregatedBins=this.getAggregatedBins(t,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,e){const{getValue:i=s,getPoints:n=o,getIndex:r=a,filterData:l}=e,c="function"==typeof l,h=t.length,u=[];let d=0;for(let e=0;e<h;e++){const s=t[e],o=n(s),a=r(s),h=c?o.filter(l):o;s.filteredPoints=c?h:null;const g=h.length?i(h):null;null!=g&&(u[d]={i:Number.isFinite(a)?a:e,value:g,counts:h.length},d++)}return u}_percentileToIndex(t){const e=this.sortedBins.length;if(e<2)return[0,0];const[i,s]=t.map(t=>Object(n.a)(t,0,100));return[Math.ceil(i/100*(e-1)),Math.floor(s/100*(e-1))]}getBinMap(){const t={};for(const e of this.aggregatedBins)t[e.i]=e;return t}_updateMinMaxValues(){let t=0,e=0,i=3402823466e29,n=0;for(const s of this.aggregatedBins)t=t>s.counts?t:s.counts,e=e>s.value?e:s.value,i=i<s.value?i:s.value,n+=s.counts;this.maxCount=t,this.maxValue=e,this.minValue=i,this.totalCount=n}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>r(t.value,e.value))),!this.sortedBins.length)return[];let e=0,i=this.sortedBins.length-1;if(Array.isArray(t)){const n=this._percentileToIndex(t);e=n[0],i=n[1]}return[this.sortedBins[e].value,this.sortedBins[i].value]}getValueDomainByScale(t,[e=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>r(t.value,e.value))),!this.sortedBins.length)return[];const n=this._percentileToIndex([e,i]);return this._getScaleDomain(t,n)}_getScaleDomain(t,[e,i]){const s=this.sortedBins;switch(t){case"quantize":case"linear":return[s[e].value,s[i].value];case"quantile":return Object(n.c)(s.slice(e,i+1),t=>t.value);case"ordinal":return Object(n.b)(s,t=>t.value);default:return[s[e].value,s[i].value]}}}},4694:function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return l}));var n=i(4772),s=i(4636),o=i(4721);const a={10240:9728,10241:9728};function r(t,e={}){const{width:i=1,height:o=1,data:r=null,unpackFlipY:l=!0,parameters:c=a}=e;return new n.a(t,{data:r,format:Object(s.i)(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:c,dataFormat:6408,width:i,height:o,unpackFlipY:l})}function l(t,e){const{id:i,width:n=1,height:s=1,texture:a}=e;return new o.a(t,{id:i,width:n,height:s,attachments:{36064:a}})}},4695:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return l})),i.d(e,"c",(function(){return c}));var n=i(4690),s=i(4653);function o(t){return Number.isFinite(t)?t:0}function a(t,e){const i=t.positions.value;let n,s,a=1/0,r=-1/0,l=1/0,c=-1/0;for(let t=0;t<e;t++)s=i[3*t],n=i[3*t+1],a=n<a?n:a,r=n>r?n:r,l=s<l?s:l,c=s>c?s:c;return{xMin:o(l),xMax:o(c),yMin:o(a),yMax:o(r)}}function r(t,e){const i=t<0?-1:1;let n=i<0?Math.abs(t)+e:Math.abs(t);return n=Math.floor(n/e)*e,n*i}function l(t,e,i=!0){if(!i)return{xOffset:e,yOffset:e};const{yMin:n,yMax:s}=t;return function(t,e){const i=(a=t,a/6378e3*(180/Math.PI)),n=(s=e,o=t,o/6378e3*(180/Math.PI)/Math.cos(s*Math.PI/180));var s,o;var a;return{yOffset:i,xOffset:n}}(e,(n+s)/2)}function c(t,e,i,o){const a=l(t,e,o!==n.a.CARTESIAN),c=function(t,e,i,o){const{width:a,height:l}=o,c=i===n.a.CARTESIAN?[-a/2,-l/2]:[-180,-90];s.a.assert(i===n.a.CARTESIAN||i===n.a.LNGLAT||i===n.a.DEFAULT);const{xMin:h,yMin:u}=t;return[-1*(r(h-c[0],e.xOffset)+c[0]),-1*(r(u-c[1],e.yOffset)+c[1])]}(t,a,o,i),{xMin:h,yMin:u,xMax:d,yMax:g}=t,p=d-h+a.xOffset,f=g-u+a.yOffset;return{gridOffset:a,translation:c,width:p,height:f,numCol:Math.ceil(p/a.xOffset),numRow:Math.ceil(f/a.yOffset)}}},4713:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(4674),s=i(4670),o=i(4689),a=i(4653),r=i(4680),l=i(4679);class c extends n.a{initializeState({dimensions:t}){const{gl:e}=this.context;super.initializeState(t),this.setState({layerData:{},gpuGridAggregator:new s.a(e,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:l.a})}updateState(t){super.updateState(t),this.updateAggregationState(t);const{aggregationDataDirty:e,aggregationWeightsDirty:i,gpuAggregation:n}=this.state;if(this.getNumInstances()<=0)return;let s=!1;(e||n&&i)&&(this._updateAggregation(t),s=!0),n||!e&&!i||(this._updateWeightBins(),this._uploadAggregationResults(),s=!0),this.setState({aggregationDirty:s})}finalizeState(){var t;const{count:e}=this.state.weights;e&&e.aggregationBuffer&&e.aggregationBuffer.delete(),null===(t=this.state.gpuGridAggregator)||void 0===t||t.delete(),super.finalizeState()}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){a.a.assert(!1)}allocateResources(t,e){if(this.state.numRow!==t||this.state.numCol!==e){const i=e*t*4*4,n=this.context.gl,{weights:s}=this.state;for(const t in s){const e=s[t];e.aggregationBuffer&&e.aggregationBuffer.delete(),e.aggregationBuffer=new o.a(n,{byteLength:i,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:t,maxMinData:e,maxData:i,minData:n}){const{count:s}=this.state.weights;s&&(s.aggregationData=t,s.maxMinData=e,s.maxData=i,s.minData=n)}_updateAggregation(t){const{cpuGridAggregator:e,gpuGridAggregator:i,gridOffset:n,posOffset:s,translation:o=[0,0],scaling:a=[0,0,0],boundingBox:r,projectPoints:l,gpuAggregation:c,numCol:h,numRow:u}=this.state,{props:d}=t,{viewport:g}=this.context,p=this.getAttributes(),f=this.getNumInstances();if(c){const{weights:t}=this.state;i.run({weights:t,cellSize:[n.xOffset,n.yOffset],numCol:h,numRow:u,translation:o,scaling:a,vertexCount:f,projectPoints:l,attributes:p,moduleSettings:this.getModuleSettings()})}else{const t=e(d,{gridOffset:n,projectPoints:l,attributes:p,viewport:g,posOffset:s,boundingBox:r});this.setState({layerData:t})}}_updateWeightBins(){const{getValue:t}=this.state,e=new r.a(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:e})}_uploadAggregationResults(){const{numCol:t,numRow:e}=this.state,{data:i}=this.state.layerData,{aggregatedBins:n,minValue:s,maxValue:o,totalCount:a}=this.state.sortedBins,r=new Float32Array(t*e*4).fill(0);for(const e of n){const{lonIdx:n,latIdx:s}=i[e.i],{value:o,counts:a}=e,l=4*(n+s*t);r[l]=o,r[l+4-1]=a}const l=new Float32Array([o,0,0,s]),c=new Float32Array([o,0,0,a]),h=new Float32Array([s,0,0,a]);this.updateResults({aggregationData:r,maxMinData:l,maxData:c,minData:h})}}c.layerName="GridAggregationLayer"},4714:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i(4680),s=i(4673),o=i(4652);function a(){}const r=["getBins","getDomain","getScaleFunc"],l=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],c=t=>t.cellSize;class h{constructor(t){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||c,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||l)}static defaultDimensions(){return l}updateState(t,e){const{oldProps:i,props:n,changeFlags:s}=t;this.updateGetValueFuncs(i,n,s);const o=this.needsReProjectPoints(i,n,s);let a=!1;if(s.dataChanged||o)this.getAggregatedData(n,e),a=!0;else{(this.getDimensionChanges(i,n,s)||[]).forEach(t=>"function"==typeof t&&t()),a=!0}return this.setState({aggregationDirty:a}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,e){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...e}}})}normalizeResult(t={}){return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,e){const i=this._getAggregator(t)(t,e);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,e,i){for(const n in this.dimensionUpdaters){const{value:s,weight:a,aggregation:r}=this.dimensionUpdaters[n].getBins.triggers;let l=e[s.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[n].getBins,t,e,i)&&(l=l?Object(o.c)(l,{data:e.data}):Object(o.b)(e[r.prop],e[a.prop],{data:e.data})),l&&this.setDimensionState(n,{getValue:l})}}needsReProjectPoints(t,e,i){return this._getCellSize(t)!==this._getCellSize(e)||this._getAggregator(t)!==this._getAggregator(e)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(t=[]){t.forEach(t=>{const{key:e}=t;this.dimensionUpdaters[e]=this.getDimensionUpdaters(t),this.state.dimensions[e]={getValue:null,domain:null,sortedBins:null,scaleFunc:a}})}getDimensionUpdaters({key:t,accessor:e,pickingInfo:i,getBins:n,getDomain:s,getScaleFunc:o,nullValue:a}){return{key:t,accessor:e,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins,...n},getDomain:{updater:this.getDimensionValueDomain,...s},getScaleFunc:{updater:this.getDimensionScale,...o},attributeAccessor:this.getSubLayerDimensionAttribute(t,a)}}needUpdateDimensionStep(t,e,i,n){return Object.values(t.triggers).some(t=>t.updateTrigger?n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged[t.updateTrigger]):e[t.prop]!==i[t.prop])}getDimensionChanges(t,e,i){const n=[];for(const s in this.dimensionUpdaters){const o=r.find(n=>this.needUpdateDimensionStep(this.dimensionUpdaters[s][n],t,e,i));o&&n.push(this.dimensionUpdaters[s][o].updater.bind(this,e,this.dimensionUpdaters[s]))}return n.length?n:null}getUpdateTriggers(t){const e=t.updateTriggers||{},i={};for(const n in this.dimensionUpdaters){const{accessor:s}=this.dimensionUpdaters[n];i[s]={},r.forEach(o=>{Object.values(this.dimensionUpdaters[n][o].triggers).forEach(({prop:n,updateTrigger:o})=>{if(o){const t=e[o];"object"!=typeof t||Array.isArray(t)?void 0!==t&&(i[s][n]=t):Object.assign(i[s],t)}else i[s][n]=t[n]})})}return i}getSortedBins(t){for(const e in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[e])}getDimensionSortedBins(t,e){const{key:i}=e,{getValue:s}=this.state.dimensions[i],o=new n.a(this.state.layerData.data||[],{getValue:s,filterData:t._filterData});this.setDimensionState(i,{sortedBins:o}),this.getDimensionValueDomain(t,e)}getDimensionValueDomain(t,e){const{getDomain:i,key:n}=e,{triggers:{lowerPercentile:s,upperPercentile:o,scaleType:a}}=i,r=this.state.dimensions[n].sortedBins.getValueDomainByScale(t[a.prop],[t[s.prop],t[o.prop]]);this.setDimensionState(n,{valueDomain:r}),this.getDimensionScale(t,e)}getDimensionScale(t,e){const{key:i,getScaleFunc:n,getDomain:o}=e,{domain:a,range:r}=n.triggers,{scaleType:l}=o.triggers,{onSet:c}=n,h=t[r.prop],u=t[a.prop]||this.state.dimensions[i].valueDomain,d=Object(s.d)(l&&t[l.prop])(u,h);"object"==typeof c&&"function"==typeof t[c.props]&&t[c.props](d.domain()),this.setDimensionState(i,{scaleFunc:d})}getSubLayerDimensionAttribute(t,e){return i=>{const{sortedBins:n,scaleFunc:s}=this.state.dimensions[t],o=n.binMap[i.index];if(o&&0===o.counts)return e;const a=o&&o.value,r=s.domain();return a>=r[0]&&a<=r[r.length-1]?s(a):e}}getSubLayerAccessors(t){const e={};for(const i in this.dimensionUpdaters){const{accessor:n}=this.dimensionUpdaters[i];e[n]=this.getSubLayerDimensionAttribute(t,i)}return e}getPickingInfo({info:t}){let e=null;if(t.picked&&t.index>-1){const i=this.state.layerData.data[t.index],n={};for(const t in this.dimensionUpdaters){const{pickingInfo:e}=this.dimensionUpdaters[t],{sortedBins:s}=this.state.dimensions[t],o=s.binMap[i.index]&&s.binMap[i.index].value;n[e]=o}e=Object.assign(n,i,{points:i.filteredPoints||i.points})}return t.picked=Boolean(e),t.object=e,t}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:a}}},4723:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i(4717),s=i(4667),o=i(4678);class a extends n.a{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}renderLayers(){return null}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){const{_subLayerProps:i}=this.props;return e&&e.length||i&&i[t]}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if("function"==typeof t){const e={data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,n)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:i,visible:n,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:r,highlightColor:l,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:u,positionFormat:d,modelMatrix:g,extensions:p,fetch:f,_subLayerProps:m}=this.props,v={opacity:e,pickable:i,visible:n,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:r,highlightColor:l,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:u,positionFormat:d,modelMatrix:g,extensions:p,fetch:f},_=m&&m[t.id],y=_&&_.updateTriggers,b=t.id||"sublayer";if(_){const e=this.constructor._propTypes,i=t.type?t.type._propTypes:{};for(const t in _){const n=i[t]||e[t];n&&"accessor"===n.type&&(_[t]=this.getSubLayerAccessor(_[t]))}}Object.assign(v,t,_),v.id="".concat(this.props.id,"-").concat(b),v.updateTriggers={all:this.props.updateTriggers.all,...t.updateTriggers,...y};for(const t of p){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(v,e,{updateTriggers:Object.assign(v.updateTriggers,e.updateTriggers)})}return v}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:t}=this.internalState;const e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=Object(o.b)(t,Boolean),this.internalState.subLayers=t),Object(s.a)("compositeLayer.renderLayers",this,e,t);for(const e of t)e.parent=this}}a.layerName="CompositeLayer"},4738:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var n=i(4717),s=i(4802),o=i(4739),a=i(4837),r=i(4992),l=i(4653),c=i(4803),h=i(5015),u=i(4645);class d extends c.a{constructor(t={}){const{id:e=Object(h.c)("column-geometry")}=t,{indices:i,attributes:n}=function(t){const{radius:e,height:i=1,nradial:n=10}=t;let{vertices:s}=t;s&&(l.a.assert(s.length>=n),s=s.flatMap(t=>[t[0],t[1]]),Object(u.f)(s,u.a.COUNTER_CLOCKWISE));const o=i>0,a=n+1,r=o?3*a+1:n,c=2*Math.PI/n,h=new Uint16Array(o?3*n*2:0),d=new Float32Array(3*r),g=new Float32Array(3*r);let p=0;if(o){for(let t=0;t<a;t++){const o=t*c,a=t%n,r=Math.sin(o),l=Math.cos(o);for(let t=0;t<2;t++)d[p+0]=s?s[2*a]:l*e,d[p+1]=s?s[2*a+1]:r*e,d[p+2]=(.5-t)*i,g[p+0]=s?s[2*a]:l,g[p+1]=s?s[2*a+1]:r,p+=3}d[p+0]=d[p-3],d[p+1]=d[p-2],d[p+2]=d[p-1],p+=3}for(let t=o?0:1;t<a;t++){const o=Math.floor(t/2)*Math.sign(.5-t%2),a=o*c,r=(o+n)%n,l=Math.sin(a),h=Math.cos(a);d[p+0]=s?s[2*r]:h*e,d[p+1]=s?s[2*r+1]:l*e,d[p+2]=i/2,g[p+2]=1,p+=3}if(o){let t=0;for(let e=0;e<n;e++)h[t++]=2*e+0,h[t++]=2*e+2,h[t++]=2*e+0,h[t++]=2*e+1,h[t++]=2*e+1,h[t++]=2*e+3}return{indices:h,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:g}}}}(t);super({...t,id:e,indices:i,attributes:n})}}const g=[0,0,0,255],p={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:g},getLineColor:{type:"accessor",value:g},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class f extends n.a{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio -= sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[s.a,o.a,a.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:g},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:g},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState({props:t,oldProps:e,changeFlags:i}){super.updateState({props:t,oldProps:e,changeFlags:i});const n=i.extensionsChanged;if(n){var s;const{gl:t}=this.context;null===(s=this.state.model)||void 0===s||s.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}(n||t.diskResolution!==e.diskResolution||t.vertices!==e.vertices||(t.extruded||t.stroked)!==(e.extruded||e.stroked))&&this._updateGeometry(t)}getGeometry(t,e,i){const n=new d({radius:1,height:i?2:0,vertices:e,nradial:t});let s=0;if(e)for(let i=0;i<t;i++){const n=e[i];s+=Math.sqrt(n[0]*n[0]+n[1]*n[1])/t}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*s}),n}_getModel(t){return new r.a(t,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:t,vertices:e,extruded:i,stroked:n}){const s=this.getGeometry(t,e,i||n);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:t}){const{viewport:e}=this.context,{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:s,lineWidthMaxPixels:o,elevationScale:a,extruded:r,filled:l,stroked:c,wireframe:h,offset:u,coverage:d,radius:g,angle:p}=this.props,{model:f,fillVertexCount:m,wireframeVertexCount:v,edgeDistance:_}=this.state,y="pixels"===i?e.metersPerPixel:1;f.setUniforms(t).setUniforms({radius:g,angle:p/180*Math.PI,offset:u,extruded:r,coverage:d,elevationScale:a,edgeDistance:_,widthScale:n*y,widthMinPixels:s,widthMaxPixels:o}),r&&h&&(f.setProps({isIndexed:!0}),f.setVertexCount(v).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(f.setProps({isIndexed:!1}),f.setVertexCount(m).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!r&&c&&(f.setProps({isIndexed:!1}),f.setVertexCount(2*m/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}f.layerName="ColumnLayer",f.defaultProps=p},4739:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n";const s={lightSources:{}};function o({color:t=[0,0,0],intensity:e=1}={}){return t.map(t=>t*e/255)}const a={name:"lights",vs:n,fs:n,getUniforms:function t(e=s){if("lightSources"in e){const{ambientLight:t,pointLights:i,directionalLights:n}=e.lightSources||{};return t||i&&i.length>0||n&&n.length>0?Object.assign({},function({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};return n["lighting_uAmbientLight.color"]=t?o(t):[0,0,0],e.forEach((t,e)=>{n["lighting_uPointLight[".concat(e,"].color")]=o(t),n["lighting_uPointLight[".concat(e,"].position")]=t.position,n["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,i.forEach((t,e)=>{n["lighting_uDirectionalLight[".concat(e,"].color")]=o(t),n["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction}),n.lighting_uDirectionalLightCount=i.length,n}({ambientLight:t,pointLights:i,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const i={pointLights:[],directionalLights:[]};for(const t of e.lights||[])switch(t.type){case"ambient":i.ambientLight=t;break;case"directional":i.directionalLights.push(t);break;case"point":i.pointLights.push(t)}return t({lightSources:i})}return{}},defines:{MAX_LIGHTS:3}};var r="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";const l={};function c(t=l){if(!("material"in t))return{};const{material:e}=t;return e?function(t){const{ambient:e=.35,diffuse:i=.6,shininess:n=32,specularColor:s=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:n,lighting_uSpecularColor:s.map(t=>t/255)}}(e):{lighting_uEnabled:!1}}const h={name:"gouraud-lighting",dependencies:[a],vs:r,defines:{LIGHTING_VERTEX:1},getUniforms:c}},4830:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return $}));var n=i(4723),s=i(4670),o=i(4689),a=i(4653),r=i(4652),l=i(4663),c=i(4717),h=i(4802),u=i(4739),d=i(4837),g=i(4796),p=i(4992),f=i(4803),m=i(5015);const v=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),_=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),y=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),b=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),x={POSITION:{size:3,value:new Float32Array(_)},NORMAL:{size:3,value:new Float32Array(y)},TEXCOORD_0:{size:2,value:new Float32Array(b)}};class C extends f.a{constructor(t={}){const{id:e=Object(m.c)("cube-geometry")}=t;super({...t,id:e,indices:{size:1,value:new Uint16Array(v)},attributes:{...x,...t.attributes}})}}var w=i(4835);const S={colorDomain:null,colorRange:l.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class M extends c.a{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:[h.a,u.a,d.a,w.a]})}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const e=this._getModel(t);this._setupUniformBuffer(e),this.setState({model:e})}_getModel(t){return new p.a(t,{...this.getShaders(),id:this.props.id,geometry:new C,isInstanced:!0})}draw({uniforms:t}){const{cellSize:e,offset:i,extruded:n,elevationScale:s,coverage:o,gridSize:a,gridOrigin:r,gridOffset:c,elevationRange:h,colorMaxMinBuffer:u,elevationMaxMinBuffer:d}=this.props,p=[Object(g.b)(r[0]),Object(g.b)(r[1])],f=[Object(g.b)(c[0]),Object(g.b)(c[1])],m=this.getDomainUniforms(),v=Object(l.a)(this.props.colorRange);this.bindUniformBuffers(u,d),this.state.model.setUniforms(t).setUniforms(m).setUniforms({cellSize:e,offset:i,extruded:n,elevationScale:s,coverage:o,gridSize:a,gridOrigin:r,gridOriginLow:p,gridOffset:c,gridOffsetLow:f,colorRange:v,elevationRange:h}).draw(),this.unbindUniformBuffers(u,d)}bindUniformBuffers(t,e){t.bind({target:35345,index:0}),e.bind({target:35345,index:1})}unbindUniformBuffers(t,e){t.unbind({target:35345,index:0}),e.unbind({target:35345,index:1})}getDomainUniforms(){const{colorDomain:t,elevationDomain:e}=this.props,i={};return null!==t?(i.colorDomainValid=!0,i.colorDomain=t):i.colorDomainValid=!1,null!==e?(i.elevationDomainValid=!0,i.elevationDomain=e):i.elevationDomainValid=!1,i}_setupUniformBuffer(t){const e=this.context.gl,i=t.program.handle,n=e.getUniformBlockIndex(i,"ColorData"),s=e.getUniformBlockIndex(i,"ElevationData");e.uniformBlockBinding(i,n,0),e.uniformBlockBinding(i,s,1)}}M.layerName="GPUGridCellLayer",M.defaultProps=S;var E=i(4679),P=i(4713),A=i(4695);const L={colorDomain:null,colorRange:l.b,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0},k={data:{props:["cellSize","colorAggregation","elevationAggregation"]}};class O extends P.a{initializeState(){const{gl:t}=this.context,e=s.a.isSupported(t);e||a.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeState({dimensions:k}),this.setState({gpuAggregation:!0,projectPoints:!1,isSupported:e,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new o.a(t,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new o.a(t,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(t){if(!1===this.state.isSupported)return;super.updateState(t);const{aggregationDirty:e}=this.state;e&&this.setState({gridHash:null})}getHashKeyForIndex(t){const{numRow:e,numCol:i,boundingBox:n,gridOffset:s}=this.state,o=[i,e],a=[n.xMin,n.yMin],r=[s.xOffset,s.yOffset],l=Math.floor(t/o[0]),c=t-l*o[0],h=Math.floor((l*r[1]+a[1]+90+r[1]/2)/r[1]),u=Math.floor((c*r[0]+a[0]+180+r[0]/2)/r[0]);return"".concat(h,"-").concat(u)}getPositionForIndex(t){const{numRow:e,numCol:i,boundingBox:n,gridOffset:s}=this.state,o=[i,e],a=[n.xMin,n.yMin],r=[s.xOffset,s.yOffset],l=Math.floor(t/o[0]);return[(t-l*o[0])*r[0]+a[0],l*r[1]+a[1]]}getPickingInfo({info:t,mode:e}){const{index:i}=t;let n=null;if(i>=0){const{gpuGridAggregator:t}=this.state,o=this.getPositionForIndex(i),a=s.a.getAggregationData({pixelIndex:i,...t.getData("color")}),r=s.a.getAggregationData({pixelIndex:i,...t.getData("elevation")});if(n={colorValue:a.cellWeight,elevationValue:r.cellWeight,count:a.cellCount||r.cellCount,position:o,totalCount:a.totalCount||r.totalCount},"hover"!==e){const{props:t}=this;let{gridHash:e}=this.state;if(!e){const{gridOffset:i,translation:n,boundingBox:s}=this.state,{viewport:o}=this.context,a=this.getAttributes();e=Object(E.a)(t,{gridOffset:i,attributes:a,viewport:o,translation:n,boundingBox:s}).gridHash,this.setState({gridHash:e})}const s=e[this.getHashKeyForIndex(i)];Object.assign(n,s)}}return t.picked=Boolean(n),t.object=n,t}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:t,extruded:e,cellSize:i,coverage:n,material:s,elevationRange:o,colorDomain:a,elevationDomain:r}=this.props,{weights:c,numRow:h,numCol:u,gridOrigin:d,gridOffset:g}=this.state,{color:p,elevation:f}=c,m=Object(l.a)(this.props.colorRange);return new(this.getSubLayerClass("gpu-grid-cell",M))({gridSize:[u,h],gridOrigin:d,gridOffset:[g.xOffset,g.yOffset],colorRange:m,elevationRange:o,colorDomain:a,elevationDomain:r,cellSize:i,coverage:n,material:s,elevationScale:t,extruded:e},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:p.aggregationBuffer,elevations:f.aggregationBuffer}},colorMaxMinBuffer:p.maxMinBuffer,elevationMaxMinBuffer:f.maxMinBuffer,numInstances:u*h})}finalizeState(){const{color:t,elevation:e}=this.state.weights;[t,e].forEach(t=>{const{aggregationBuffer:e,maxMinBuffer:i}=t;i.delete(),null==e||e.delete()}),super.finalizeState()}updateAggregationState(t){const{props:e,oldProps:i}=t,{cellSize:n,coordinateSystem:s}=e,{viewport:o}=this.context,a=i.cellSize!==n,{dimensions:r}=this.state,l=this.isAttributeChanged("positions"),c=l||this.isAttributeChanged();let{boundingBox:h}=this.state;if(l&&(h=Object(A.a)(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:h})),l||a){const{gridOffset:t,translation:e,width:i,height:a,numCol:r,numRow:l}=Object(A.c)(h,n,o,s);this.allocateResources(l,r),this.setState({gridOffset:t,translation:e,gridOrigin:[-1*e[0],-1*e[1]],width:i,height:a,numCol:r,numRow:l})}const u=c||this.isAggregationDirty(t,{dimension:r.data,compareAll:!0});u&&this._updateAccessors(t),this.setState({aggregationDataDirty:u})}_updateAccessors(t){const{colorAggregation:e,elevationAggregation:i}=t.props,{color:n,elevation:s}=this.state.weights;n.operation=r.a[e],s.operation=r.a[i]}}O.layerName="GPUGridLayer",O.defaultProps=L;var D=i(4738);class T extends D.a{getGeometry(t){return new C}draw({uniforms:t}){const{elevationScale:e,extruded:i,offset:n,coverage:s,cellSize:o,angle:a}=this.props;this.state.model.setUniforms(t).setUniforms({radius:o/2,angle:a,offset:n,extruded:i,coverage:s,elevationScale:e,edgeDistance:1,isWireframe:!1}).draw()}}T.layerName="GridCellLayer",T.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var N=i(4714),R=i(4674);function F(){}const I={colorDomain:null,colorRange:l.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:F,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:F,gridAggregator:E.a,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class z extends R.a{initializeState(){const t=new N.a({getAggregator:t=>t.gridAggregator,getCellSize:t=>t.cellSize});this.state={cpuAggregator:t,aggregatorState:t.state},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(t){super.updateState(t),this.setState({aggregatorState:this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances(t.props)})})}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,cellSize:i,coverage:n,material:s,transitions:o}=this.props,{cpuAggregator:a}=this.state,r=this.getSubLayerClass("grid-cell",T),l=this._getSublayerUpdateTriggers();return new r({cellSize:i,coverage:n,material:s,elevationScale:t,extruded:e,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:l}),{data:a.state.layerData.data})}}z.layerName="CPUGridLayer",z.defaultProps=I;const j={...O.defaultProps,...z.defaultProps,gpuAggregation:!1};class V extends n.a{initializeState(){this.state={useGPUAggregation:!0}}updateState({oldProps:t,props:e,changeFlags:i}){const n={};n.useGPUAggregation=this.canUseGPUAggregation(e),this.setState(n)}renderLayers(){const{data:t,updateTriggers:e}=this.props,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",O):this.getSubLayerClass("CPU",z))(this.props,this.getSubLayerProps({id:i,updateTriggers:e}),{data:t})}canUseGPUAggregation(t){const{gpuAggregation:e,lowerPercentile:i,upperPercentile:n,getColorValue:o,getElevationValue:a,colorScaleType:r}=t;return!!e&&(!!s.a.isSupported(this.context.gl)&&(0===i&&100===n&&(null===o&&null===a&&("quantile"!==r&&"ordinal"!==r))))}}V.layerName="GridLayer",V.defaultProps=j;var U=i(0),B=i.n(U),H=i(13),G=i(4650),q=i(4643),W=i(4659),X=i(4651);function K(){return(K=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function Y(t){return B.a.createElement("div",{className:"deckgl-tooltip"},B.a.createElement(X.a,{label:Object(H.e)("Longitude and Latitude")+": ",value:t.coordinate[0]+", "+t.coordinate[1]}),B.a.createElement(X.a,{label:Object(H.e)("Height")+": ",value:""+t.object.elevationValue}))}function $(t,e,i,n){const s=t,o=s.color_picker;let a=e.data.features.map(t=>K({},t,{color:[o.r,o.g,o.b,255*o.a]}));if(s.js_data_mutator){a=Object(q.a)(s.js_data_mutator)(a)}const r=Object(G.b)(s.js_agg_function,t=>t.weight);return new V(K({id:"grid-layer-"+s.slice_id,data:a,pickable:!0,cellSize:s.grid_size,minColor:[0,0,0,0],extruded:s.extruded,maxColor:[o.r,o.g,o.b,255*o.a],outline:!1,getElevationValue:r,getColorValue:r},Object(G.a)(s,n,Y)))}e.default=Object(W.b)($,(function(t){return t.map(t=>t.position)}))},4835:function(t,e,i){"use strict";function n(t,e=[],i=0){const n=Math.fround(t),s=t-n;return e[i]=n,e[i+1]=s,e}function s(t){return t-Math.fround(t)}function o(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let s=0;s<4;++s){const o=4*i+s;n(t[4*s+i],e,2*o)}return e}i.d(e,"a",(function(){return r}));const a={ONE:1};const r={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",fs:null,getUniforms:function(){return a},fp64ify:n,fp64LowPart:s,fp64ifyMatrix4:o}}}]);