/*! For license information please see beb2adefe0ede8852d4b.chunk.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[45,46,48,50,51,52,53,54,56],{1685:function(t,e,i){var n;!function(o,s,r){if(o){for(var a,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},h={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)l[111+d]="f"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();y.prototype.bind=function(t,e,i){return t=t instanceof Array?t:[t],this._bindMultiple.call(this,t,e,i),this},y.prototype.unbind=function(t,e){return this.bind.call(this,t,(function(){}),e)},y.prototype.trigger=function(t,e){return this._directMap[t+":"+e]&&this._directMap[t+":"+e]({},t),this},y.prototype.reset=function(){return this._callbacks={},this._directMap={},this},y.prototype.stopCallback=function(t,e){return!((" "+e.className+" ").indexOf(" mousetrap ")>-1)&&(!function t(e,i){return null!==e&&e!==s&&(e===i||t(e.parentNode,i))}(e,this.target)&&("INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable))},y.prototype.handleKey=function(){var t=this;return t._handleKey.apply(t,arguments)},y.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(l[e]=t[e]);a=null},y.init=function(){var t=y(s);for(var e in t)"_"!==e.charAt(0)&&(y[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},y.init(),o.Mousetrap=y,t.exports&&(t.exports=y),void 0===(n=function(){return y}.call(e,i,e,t))||(t.exports=n)}function p(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent("on"+e,i)}function g(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return l[t.which]?l[t.which]:c[t.which]?c[t.which]:String.fromCharCode(t.which).toLowerCase()}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function m(t,e,i){return i||(i=function(){if(!a)for(var t in a={},l)t>95&&t<112||l.hasOwnProperty(t)&&(a[l[t]]=t);return a}()[t]?"keydown":"keypress"),"keypress"==i&&e.length&&(i="keydown"),i}function v(t,e){var i,n,o,s=[];for(i=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),o=0;o<i.length;++o)n=i[o],h[n]&&(n=h[n]),e&&"keypress"!=e&&u[n]&&(n=u[n],s.push("shift")),f(n)&&s.push(n);return{key:n,modifiers:s,action:e=m(n,s,e)}}function y(t){var e=this;if(t=t||s,!(e instanceof y))return new y(t);e.target=t,e._callbacks={},e._directMap={};var i,n={},o=!1,r=!1,a=!1;function l(t){t=t||{};var e,i=!1;for(e in n)t[e]?i=!0:n[e]=0;i||(a=!1)}function c(t,i,o,s,r,a){var l,c,u,h,d=[],p=o.type;if(!e._callbacks[t])return[];for("keyup"==p&&f(t)&&(i=[t]),l=0;l<e._callbacks[t].length;++l)if(c=e._callbacks[t][l],(s||!c.seq||n[c.seq]==c.level)&&p==c.action&&("keypress"==p&&!o.metaKey&&!o.ctrlKey||(u=i,h=c.modifiers,u.sort().join(",")===h.sort().join(",")))){var g=!s&&c.combo==r,m=s&&c.seq==s&&c.level==a;(g||m)&&e._callbacks[t].splice(l,1),d.push(c)}return d}function u(t,i,n,o){e.stopCallback(i,i.target||i.srcElement,n,o)||!1===t(i,n)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(i),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(i))}function h(t){"number"!=typeof t.which&&(t.which=t.keyCode);var i=g(t);i&&("keyup"!=t.type||o!==i?e.handleKey(i,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):o=!1)}function d(t,e,s,r){function c(e){return function(){a=e,++n[t],clearTimeout(i),i=setTimeout(l,1e3)}}function h(e){u(s,e,t),"keyup"!==r&&(o=g(e)),setTimeout(l,10)}n[t]=0;for(var d=0;d<e.length;++d){var p=d+1===e.length?h:c(r||v(e[d+1]).action);m(e[d],p,r,t,d)}}function m(t,i,n,o,s){e._directMap[t+":"+n]=i;var r,a=(t=t.replace(/\s+/g," ")).split(" ");a.length>1?d(t,a,i,n):(r=v(t,n),e._callbacks[r.key]=e._callbacks[r.key]||[],c(r.key,r.modifiers,{type:r.action},o,t,s),e._callbacks[r.key][o?"unshift":"push"]({callback:i,modifiers:r.modifiers,action:r.action,seq:o,level:s,combo:t}))}e._handleKey=function(t,e,i){var n,o=c(t,e,i),s={},h=0,d=!1;for(n=0;n<o.length;++n)o[n].seq&&(h=Math.max(h,o[n].level));for(n=0;n<o.length;++n)if(o[n].seq){if(o[n].level!=h)continue;d=!0,s[o[n].seq]=1,u(o[n].callback,i,o[n].combo,o[n].seq)}else d||u(o[n].callback,i,o[n].combo);var p="keypress"==i.type&&r;i.type!=a||f(t)||p||l(s),r=d&&"keydown"==i.type},e._bindMultiple=function(t,e,i){for(var n=0;n<t.length;++n)m(t[n],e,i)},p(t,"keypress",h),p(t,"keydown",h),p(t,"keyup",h)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},303:function(t,e,i){var n,o,s;!function(r,a){"use strict";t.exports?t.exports=a(i(722),i(723),i(724)):(o=[i(722),i(723),i(724)],void 0===(s="function"==typeof(n=a)?n.apply(e,o):n)||(t.exports=s))}(0,(function(t,e,i,n){"use strict";var o=n&&n.URI;function s(t,e){var i=arguments.length>=1,n=arguments.length>=2;if(!(this instanceof s))return i?n?new s(t,e):new s(t):new s;if(void 0===t){if(i)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}if(null===t&&i)throw new TypeError("null is not a valid argument for URI");return this.href(t),void 0!==e?this.absoluteTo(e):this}s.version="1.19.6";var r=s.prototype,a=Object.prototype.hasOwnProperty;function l(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function u(t){return"Array"===c(t)}function h(t,e){var i,n,o={};if("RegExp"===c(e))o=null;else if(u(e))for(i=0,n=e.length;i<n;i++)o[e[i]]=!0;else o[e]=!0;for(i=0,n=t.length;i<n;i++){(o&&void 0!==o[t[i]]||!o&&e.test(t[i]))&&(t.splice(i,1),n--,i--)}return t}function d(t,e){var i,n;if(u(e)){for(i=0,n=e.length;i<n;i++)if(!d(t,e[i]))return!1;return!0}var o=c(e);for(i=0,n=t.length;i<n;i++)if("RegExp"===o){if("string"==typeof t[i]&&t[i].match(e))return!0}else if(t[i]===e)return!0;return!1}function p(t,e){if(!u(t)||!u(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function g(t){return t.replace(/^\/+|\/+$/g,"")}function f(t){return escape(t)}function m(t){return encodeURIComponent(t).replace(/[!'()*]/g,f).replace(/\*/g,"%2A")}s._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:s.preventInvalidHostname,duplicateQueryParameters:s.duplicateQueryParameters,escapeQuerySpace:s.escapeQuerySpace}},s.preventInvalidHostname=!1,s.duplicateQueryParameters=!1,s.escapeQuerySpace=!0,s.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,s.idn_expression=/[^a-z0-9\._-]/i,s.punycode_expression=/(xn--)/i,s.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,s.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,s.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,s.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},s.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},s.hostProtocols=["http","https"],s.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,s.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},s.getDomAttribute=function(t){if(t&&t.nodeName){var e=t.nodeName.toLowerCase();if("input"!==e||"image"===t.type)return s.domAttributes[e]}},s.encode=m,s.decode=decodeURIComponent,s.iso8859=function(){s.encode=escape,s.decode=unescape},s.unicode=function(){s.encode=m,s.decode=decodeURIComponent},s.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},s.encodeQuery=function(t,e){var i=s.encode(t+"");return void 0===e&&(e=s.escapeQuerySpace),e?i.replace(/%20/g,"+"):i},s.decodeQuery=function(t,e){t+="",void 0===e&&(e=s.escapeQuerySpace);try{return s.decode(e?t.replace(/\+/g,"%20"):t)}catch(e){return t}};var v,y={encode:"encode",decode:"decode"},x=function(t,e){return function(i){try{return s[e](i+"").replace(s.characters[t][e].expression,(function(i){return s.characters[t][e].map[i]}))}catch(t){return i}}};for(v in y)s[v+"PathSegment"]=x("pathname",y[v]),s[v+"UrnPathSegment"]=x("urnpath",y[v]);var _=function(t,e,i){return function(n){var o;o=i?function(t){return s[e](s[i](t))}:s[e];for(var r=(n+"").split(t),a=0,l=r.length;a<l;a++)r[a]=o(r[a]);return r.join(t)}};function b(t){return function(e,i){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!i),this)}}function P(t,e){return function(i,n){return void 0===i?this._parts[t]||"":(null!==i&&(i+="").charAt(0)===e&&(i=i.substring(1)),this._parts[t]=i,this.build(!n),this)}}s.decodePath=_("/","decodePathSegment"),s.decodeUrnPath=_(":","decodeUrnPathSegment"),s.recodePath=_("/","encodePathSegment","decode"),s.recodeUrnPath=_(":","encodeUrnPathSegment","decode"),s.encodeReserved=x("reserved","encode"),s.parse=function(t,e){var i;return e||(e={preventInvalidHostname:s.preventInvalidHostname}),(i=t.indexOf("#"))>-1&&(e.fragment=t.substring(i+1)||null,t=t.substring(0,i)),(i=t.indexOf("?"))>-1&&(e.query=t.substring(i+1)||null,t=t.substring(0,i)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=s.parseAuthority(t,e)):(i=t.indexOf(":"))>-1&&(e.protocol=t.substring(0,i)||null,e.protocol&&!e.protocol.match(s.protocol_expression)?e.protocol=void 0:"//"===t.substring(i+1,i+3).replace(/\\/g,"/")?(t=t.substring(i+3),t=s.parseAuthority(t,e)):(t=t.substring(i+1),e.urn=!0)),e.path=t,e},s.parseHost=function(t,e){t||(t="");var i,n,o=(t=t.replace(/\\/g,"/")).indexOf("/");if(-1===o&&(o=t.length),"["===t.charAt(0))i=t.indexOf("]"),e.hostname=t.substring(1,i)||null,e.port=t.substring(i+2,o)||null,"/"===e.port&&(e.port=null);else{var r=t.indexOf(":"),a=t.indexOf("/"),l=t.indexOf(":",r+1);-1!==l&&(-1===a||l<a)?(e.hostname=t.substring(0,o)||null,e.port=null):(n=t.substring(0,o).split(":"),e.hostname=n[0]||null,e.port=n[1]||null)}return e.hostname&&"/"!==t.substring(o).charAt(0)&&(o++,t="/"+t),e.preventInvalidHostname&&s.ensureValidHostname(e.hostname,e.protocol),e.port&&s.ensureValidPort(e.port),t.substring(o)||"/"},s.parseAuthority=function(t,e){return t=s.parseUserinfo(t,e),s.parseHost(t,e)},s.parseUserinfo=function(t,e){var i=t;-1!==t.indexOf("\\")&&(t=t.replace(/\\/g,"/"));var n,o=t.indexOf("/"),r=t.lastIndexOf("@",o>-1?o:t.length-1);return r>-1&&(-1===o||r<o)?(n=t.substring(0,r).split(":"),e.username=n[0]?s.decode(n[0]):null,n.shift(),e.password=n[0]?s.decode(n.join(":")):null,t=i.substring(r+1)):(e.username=null,e.password=null),t},s.parseQuery=function(t,e){if(!t)return{};if(!(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var i,n,o,r={},l=t.split("&"),c=l.length,u=0;u<c;u++)i=l[u].split("="),n=s.decodeQuery(i.shift(),e),o=i.length?s.decodeQuery(i.join("="),e):null,a.call(r,n)?("string"!=typeof r[n]&&null!==r[n]||(r[n]=[r[n]]),r[n].push(o)):r[n]=o;return r},s.build=function(t){var e="",i=!1;return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//",i=!0),e+=s.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&i&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},s.buildHost=function(t){var e="";return t.hostname?(s.ip6_expression.test(t.hostname)?e+="["+t.hostname+"]":e+=t.hostname,t.port&&(e+=":"+t.port),e):""},s.buildAuthority=function(t){return s.buildUserinfo(t)+s.buildHost(t)},s.buildUserinfo=function(t){var e="";return t.username&&(e+=s.encode(t.username)),t.password&&(e+=":"+s.encode(t.password)),e&&(e+="@"),e},s.buildQuery=function(t,e,i){var n,o,r,l,c="";for(o in t)if(a.call(t,o))if(u(t[o]))for(n={},r=0,l=t[o].length;r<l;r++)void 0!==t[o][r]&&void 0===n[t[o][r]+""]&&(c+="&"+s.buildQueryParameter(o,t[o][r],i),!0!==e&&(n[t[o][r]+""]=!0));else void 0!==t[o]&&(c+="&"+s.buildQueryParameter(o,t[o],i));return c.substring(1)},s.buildQueryParameter=function(t,e,i){return s.encodeQuery(t,i)+(null!==e?"="+s.encodeQuery(e,i):"")},s.addQuery=function(t,e,i){if("object"==typeof e)for(var n in e)a.call(e,n)&&s.addQuery(t,n,e[n]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return void(t[e]=i);"string"==typeof t[e]&&(t[e]=[t[e]]),u(i)||(i=[i]),t[e]=(t[e]||[]).concat(i)}},s.setQuery=function(t,e,i){if("object"==typeof e)for(var n in e)a.call(e,n)&&s.setQuery(t,n,e[n]);else{if("string"!=typeof e)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");t[e]=void 0===i?null:i}},s.removeQuery=function(t,e,i){var n,o,r;if(u(e))for(n=0,o=e.length;n<o;n++)t[e[n]]=void 0;else if("RegExp"===c(e))for(r in t)e.test(r)&&(t[r]=void 0);else if("object"==typeof e)for(r in e)a.call(e,r)&&s.removeQuery(t,r,e[r]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==i?"RegExp"===c(i)?!u(t[e])&&i.test(t[e])?t[e]=void 0:t[e]=h(t[e],i):t[e]!==String(i)||u(i)&&1!==i.length?u(t[e])&&(t[e]=h(t[e],i)):t[e]=void 0:t[e]=void 0}},s.hasQuery=function(t,e,i,n){switch(c(e)){case"String":break;case"RegExp":for(var o in t)if(a.call(t,o)&&e.test(o)&&(void 0===i||s.hasQuery(t,o,i)))return!0;return!1;case"Object":for(var r in e)if(a.call(e,r)&&!s.hasQuery(t,r,e[r]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(i)){case"Undefined":return e in t;case"Boolean":return i===Boolean(u(t[e])?t[e].length:t[e]);case"Function":return!!i(t[e],e,t);case"Array":return!!u(t[e])&&(n?d:p)(t[e],i);case"RegExp":return u(t[e])?!!n&&d(t[e],i):Boolean(t[e]&&t[e].match(i));case"Number":i=String(i);case"String":return u(t[e])?!!n&&d(t[e],i):t[e]===i;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},s.joinPaths=function(){for(var t=[],e=[],i=0,n=0;n<arguments.length;n++){var o=new s(arguments[n]);t.push(o);for(var r=o.segment(),a=0;a<r.length;a++)"string"==typeof r[a]&&e.push(r[a]),r[a]&&i++}if(!e.length||!i)return new s("");var l=new s("").segment(e);return""!==t[0].path()&&"/"!==t[0].path().slice(0,1)||l.path("/"+l.path()),l.normalize()},s.commonPath=function(t,e){var i,n=Math.min(t.length,e.length);for(i=0;i<n;i++)if(t.charAt(i)!==e.charAt(i)){i--;break}return i<1?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":("/"===t.charAt(i)&&"/"===e.charAt(i)||(i=t.substring(0,i).lastIndexOf("/")),t.substring(0,i+1))},s.withinString=function(t,e,i){i||(i={});var n=i.start||s.findUri.start,o=i.end||s.findUri.end,r=i.trim||s.findUri.trim,a=i.parens||s.findUri.parens,l=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var c=n.exec(t);if(!c)break;var u=c.index;if(i.ignoreHtml){var h=t.slice(Math.max(u-3,0),u);if(h&&l.test(h))continue}for(var d=u+t.slice(u).search(o),p=t.slice(u,d),g=-1;;){var f=a.exec(p);if(!f)break;var m=f.index+f[0].length;g=Math.max(g,m)}if(!((p=g>-1?p.slice(0,g)+p.slice(g).replace(r,""):p.replace(r,"")).length<=c[0].length||i.ignore&&i.ignore.test(p))){var v=e(p,u,d=u+p.length,t);void 0!==v?(v=String(v),t=t.slice(0,u)+v+t.slice(d),n.lastIndex=u+v.length):n.lastIndex=d}}return n.lastIndex=0,t},s.ensureValidHostname=function(e,i){var n=!!e,o=!1;if(!!i&&(o=d(s.hostProtocols,i)),o&&!n)throw new TypeError("Hostname cannot be empty, if protocol is "+i);if(e&&e.match(s.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(e).match(s.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-:_]')}},s.ensureValidPort=function(t){if(t){var e=Number(t);if(!(/^[0-9]+$/.test(e)&&e>0&&e<65536))throw new TypeError('Port "'+t+'" is not a valid port')}},s.noConflict=function(t){if(t){var e={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(e.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(e.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=n.SecondLevelDomains.noConflict()),e}return n.URI===this&&(n.URI=o),this},r.build=function(t){return!0===t?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=s.build(this._parts),this._deferred_build=!1),this},r.clone=function(){return new s(this)},r.valueOf=r.toString=function(){return this.build(!1)._string},r.protocol=b("protocol"),r.username=b("username"),r.password=b("password"),r.hostname=b("hostname"),r.port=b("port"),r.query=P("query","?"),r.fragment=P("fragment","#"),r.search=function(t,e){var i=this.query(t,e);return"string"==typeof i&&i.length?"?"+i:i},r.hash=function(t,e){var i=this.fragment(t,e);return"string"==typeof i&&i.length?"#"+i:i},r.pathname=function(t,e){if(void 0===t||!0===t){var i=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?s.decodeUrnPath:s.decodePath)(i):i}return this._parts.urn?this._parts.path=t?s.recodeUrnPath(t):"":this._parts.path=t?s.recodePath(t):"/",this.build(!e),this},r.path=r.pathname,r.href=function(t,e){var i;if(void 0===t)return this.toString();this._string="",this._parts=s._parts();var n=t instanceof s,o="object"==typeof t&&(t.hostname||t.path||t.pathname);t.nodeName&&(t=t[s.getDomAttribute(t)]||"",o=!1);if(!n&&o&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=s.parse(String(t),this._parts);else{if(!n&&!o)throw new TypeError("invalid input");var r=n?t._parts:t;for(i in r)"query"!==i&&a.call(this._parts,i)&&(this._parts[i]=r[i]);r.query&&this.query(r.query,!1)}return this.build(!e),this},r.is=function(t){var e=!1,n=!1,o=!1,r=!1,a=!1,l=!1,c=!1,u=!this._parts.urn;switch(this._parts.hostname&&(u=!1,n=s.ip4_expression.test(this._parts.hostname),o=s.ip6_expression.test(this._parts.hostname),a=(r=!(e=n||o))&&i&&i.has(this._parts.hostname),l=r&&s.idn_expression.test(this._parts.hostname),c=r&&s.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return u;case"absolute":return!u;case"domain":case"name":return r;case"sld":return a;case"ip":return e;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return o;case"idn":return l;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var C=r.protocol,S=r.port,w=r.hostname;r.protocol=function(t,e){if(t&&!(t=t.replace(/:(\/\/)?$/,"")).match(s.protocol_expression))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return C.call(this,t,e)},r.scheme=r.protocol,r.port=function(t,e){return this._parts.urn?void 0===t?"":this:(void 0!==t&&(0===t&&(t=null),t&&(":"===(t+="").charAt(0)&&(t=t.substring(1)),s.ensureValidPort(t))),S.call(this,t,e))},r.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var i={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==s.parseHost(t,i))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=i.hostname,this._parts.preventInvalidHostname&&s.ensureValidHostname(t,this._parts.protocol)}return w.call(this,t,e)},r.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var i=this.protocol();return this.authority()?(i?i+"://":"")+this.authority():""}var n=s(t);return this.protocol(n.protocol()).authority(n.authority()).build(!e),this},r.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?s.buildHost(this._parts):"";if("/"!==s.parseHost(t,this._parts))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},r.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?s.buildAuthority(this._parts):"";if("/"!==s.parseAuthority(t,this._parts))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},r.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var i=s.buildUserinfo(this._parts);return i?i.substring(0,i.length-1):i}return"@"!==t[t.length-1]&&(t+="@"),s.parseUserinfo(t,this._parts),this.build(!e),this},r.resource=function(t,e){var i;return void 0===t?this.path()+this.search()+this.hash():(i=s.parse(t),this._parts.path=i.path,this._parts.query=i.query,this._parts.fragment=i.fragment,this.build(!e),this)},r.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,i)||""}var n=this._parts.hostname.length-this.domain().length,o=this._parts.hostname.substring(0,n),r=new RegExp("^"+l(o));if(t&&"."!==t.charAt(t.length-1)&&(t+="."),-1!==t.indexOf(":"))throw new TypeError("Domains cannot contain colons");return t&&s.ensureValidHostname(t,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(r,t),this.build(!e),this},r.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.match(/\./g);if(i&&i.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(e).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!t)throw new TypeError("cannot set domain empty");if(-1!==t.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(s.ensureValidHostname(t,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var o=new RegExp(l(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(o,t)}return this.build(!e),this},r.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(n+1);return!0!==e&&i&&i.list[o.toLowerCase()]&&i.get(this._parts.hostname)||o}var s;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!i||!i.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');s=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");s=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(s,t)}return this.build(!e),this},r.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var i=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,i)||(this._parts.hostname?"/":"");return t?s.decodePath(n):n}var o=this._parts.path.length-this.filename().length,r=this._parts.path.substring(0,o),a=new RegExp("^"+l(r));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=s.recodePath(t),this._parts.path=this._parts.path.replace(a,t),this.build(!e),this},r.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("string"!=typeof t){if(!this._parts.path||"/"===this._parts.path)return"";var i=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(i+1);return t?s.decodePathSegment(n):n}var o=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(o=!0);var r=new RegExp(l(this.filename())+"$");return t=s.recodePath(t),this._parts.path=this._parts.path.replace(r,t),o?this.normalizePath(e):this.build(!e),this},r.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||!0===t){if(!this._parts.path||"/"===this._parts.path)return"";var i,n,o=this.filename(),r=o.lastIndexOf(".");return-1===r?"":(i=o.substring(r+1),n=/^[a-z0-9%]+$/i.test(i)?i:"",t?s.decodePathSegment(n):n)}"."===t.charAt(0)&&(t=t.substring(1));var a,c=this.suffix();if(c)a=t?new RegExp(l(c)+"$"):new RegExp(l("."+c)+"$");else{if(!t)return this;this._parts.path+="."+s.recodePath(t)}return a&&(t=s.recodePath(t),this._parts.path=this._parts.path.replace(a,t)),this.build(!e),this},r.segment=function(t,e,i){var n=this._parts.urn?":":"/",o=this.path(),s="/"===o.substring(0,1),r=o.split(n);if(void 0!==t&&"number"!=typeof t&&(i=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(s&&r.shift(),t<0&&(t=Math.max(r.length+t,0)),void 0===e)return void 0===t?r:r[t];if(null===t||void 0===r[t])if(u(e)){r=[];for(var a=0,l=e.length;a<l;a++)(e[a].length||r.length&&r[r.length-1].length)&&(r.length&&!r[r.length-1].length&&r.pop(),r.push(g(e[a])))}else(e||"string"==typeof e)&&(e=g(e),""===r[r.length-1]?r[r.length-1]=e:r.push(e));else e?r[t]=g(e):r.splice(t,1);return s&&r.unshift(""),this.path(r.join(n),i)},r.segmentCoded=function(t,e,i){var n,o,r;if("number"!=typeof t&&(i=e,e=t,t=void 0),void 0===e){if(u(n=this.segment(t,e,i)))for(o=0,r=n.length;o<r;o++)n[o]=s.decode(n[o]);else n=void 0!==n?s.decode(n):void 0;return n}if(u(e))for(o=0,r=e.length;o<r;o++)e[o]=s.encode(e[o]);else e="string"==typeof e||e instanceof String?s.encode(e):e;return this.segment(t,e,i)};var A=r.query;return r.query=function(t,e){if(!0===t)return s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var i=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=t.call(this,i);return this._parts.query=s.buildQuery(n||i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=s.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):A.call(this,t,e)},r.setQuery=function(t,e,i){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)n[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var o in t)a.call(t,o)&&(n[o]=t[o])}return this._parts.query=s.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},r.addQuery=function(t,e,i){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.addQuery(n,t,void 0===e?null:e),this._parts.query=s.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},r.removeQuery=function(t,e,i){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.removeQuery(n,t,e),this._parts.query=s.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(i=e),this.build(!i),this},r.hasQuery=function(t,e,i){var n=s.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return s.hasQuery(n,t,e,i)},r.setSearch=r.setQuery,r.addSearch=r.addQuery,r.removeSearch=r.removeQuery,r.hasSearch=r.hasQuery,r.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},r.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},r.normalizeHostname=function(i){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!i)),this},r.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===s.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},r.normalizePath=function(t){var e,i=this._parts.path;if(!i)return this;if(this._parts.urn)return this._parts.path=s.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;var n,o,r="";for("/"!==(i=s.recodePath(i)).charAt(0)&&(e=!0,i="/"+i),"/.."!==i.slice(-3)&&"/."!==i.slice(-2)||(i+="/"),i=i.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),e&&(r=i.substring(1).match(/^(\.\.\/)+/)||"")&&(r=r[0]);-1!==(n=i.search(/\/\.\.(\/|$)/));)0!==n?(-1===(o=i.substring(0,n).lastIndexOf("/"))&&(o=n),i=i.substring(0,o)+i.substring(n+3)):i=i.substring(3);return e&&this.is("relative")&&(i=r+i.substring(1)),this._parts.path=i,this.build(!t),this},r.normalizePathname=r.normalizePath,r.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(s.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},r.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},r.normalizeSearch=r.normalizeQuery,r.normalizeHash=r.normalizeFragment,r.iso8859=function(){var t=s.encode,e=s.decode;s.encode=escape,s.decode=decodeURIComponent;try{this.normalize()}finally{s.encode=t,s.decode=e}return this},r.unicode=function(){var t=s.encode,e=s.decode;s.encode=m,s.decode=unescape;try{this.normalize()}finally{s.encode=t,s.decode=e}return this},r.readable=function(){var e=this.clone();e.username("").password("").normalize();var i="";if(e._parts.protocol&&(i+=e._parts.protocol+"://"),e._parts.hostname&&(e.is("punycode")&&t?(i+=t.toUnicode(e._parts.hostname),e._parts.port&&(i+=":"+e._parts.port)):i+=e.host()),e._parts.hostname&&e._parts.path&&"/"!==e._parts.path.charAt(0)&&(i+="/"),i+=e.path(!0),e._parts.query){for(var n="",o=0,r=e._parts.query.split("&"),a=r.length;o<a;o++){var l=(r[o]||"").split("=");n+="&"+s.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==l[1]&&(n+="="+s.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}i+="?"+n.substring(1)}return i+=s.decodeQuery(e.hash(),!0)},r.absoluteTo=function(t){var e,i,n,o=this.clone(),r=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof s||(t=new s(t)),o._parts.protocol)return o;if(o._parts.protocol=t._parts.protocol,this._parts.hostname)return o;for(i=0;n=r[i];i++)o._parts[n]=t._parts[n];return o._parts.path?(".."===o._parts.path.substring(-2)&&(o._parts.path+="/"),"/"!==o.path().charAt(0)&&(e=(e=t.directory())||(0===t.path().indexOf("/")?"/":""),o._parts.path=(e?e+"/":"")+o._parts.path,o.normalizePath())):(o._parts.path=t._parts.path,o._parts.query||(o._parts.query=t._parts.query)),o.build(),o},r.relativeTo=function(t){var e,i,n,o,r,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t=new s(t).normalize(),e=a._parts,i=t._parts,o=a.path(),r=t.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==r.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(e.protocol===i.protocol&&(e.protocol=null),e.username!==i.username||e.password!==i.password)return a.build();if(null!==e.protocol||null!==e.username||null!==e.password)return a.build();if(e.hostname!==i.hostname||e.port!==i.port)return a.build();if(e.hostname=null,e.port=null,o===r)return e.path="",a.build();if(!(n=s.commonPath(o,r)))return a.build();var l=i.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return e.path=l+e.path.substring(n.length)||"./",a.build()},r.equals=function(t){var e,i,n,o,r,l=this.clone(),c=new s(t),h={};if(l.normalize(),c.normalize(),l.toString()===c.toString())return!0;if(n=l.query(),o=c.query(),l.query(""),c.query(""),l.toString()!==c.toString())return!1;if(n.length!==o.length)return!1;for(r in e=s.parseQuery(n,this._parts.escapeQuerySpace),i=s.parseQuery(o,this._parts.escapeQuerySpace),e)if(a.call(e,r)){if(u(e[r])){if(!p(e[r],i[r]))return!1}else if(e[r]!==i[r])return!1;h[r]=!0}for(r in i)if(a.call(i,r)&&!h[r])return!1;return!0},r.preventInvalidHostname=function(t){return this._parts.preventInvalidHostname=!!t,this},r.duplicateQueryParameters=function(t){return this._parts.duplicateQueryParameters=!!t,this},r.escapeQuerySpace=function(t){return this._parts.escapeQuerySpace=!!t,this},s}))},4640:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(4644),o=i(167);const s=[-90,90],r=[-180,180];function a(t,e,i){let[n,o]=t,[s,r]=e;return void 0===i&&(i=.25),n<o?[n,o]:[Math.max(s,n-i),Math.min(r,o+i)]}function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function c(t,e){let{points:i,width:c,height:u,minExtent:h,maxZoom:d,offset:p,padding:g=20}=e;const{bearing:f,pitch:m}=t,v=function(t){const e=a(Object(o.extent)(t,t=>t[1]),s),i=a(Object(o.extent)(t,t=>t[0]),r);return[[i[0],e[0]],[i[1],e[1]]]}(i);try{return l({},Object(n.c)({bounds:v,width:c,height:u,minExtent:h,maxZoom:d,offset:p,padding:g}),{bearing:f,pitch:m})}catch(t){console.error("Could not fit viewport",t)}return t}},4645:function(t,e,i){"use strict";i.d(e,"f",(function(){return o})),i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return p})),i.d(e,"d",(function(){return h})),i.d(e,"e",(function(){return y})),i.d(e,"c",(function(){return x}));i(4637);const n={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function o(t,e,i={}){return function(t,e={}){return Math.sign(s(t,e))}(t,i)!==e&&(function(t,e){const{start:i=0,end:n=t.length,size:o=2}=e,s=(n-i)/o,r=Math.floor(s/2);for(let e=0;e<r;++e){const n=i+e*o,r=i+(s-1-e)*o;for(let e=0;e<o;++e){const i=t[n+e];t[n+e]=t[r+e],t[r+e]=i}}}(t,i),!0)}function s(t,e={}){const{start:i=0,end:n=t.length}=e,o=e.size||2;let s=0;for(let e=i,r=n-o;e<n;e+=o)s+=(t[e]-t[r])*(t[e+1]+t[r+1]),r=e;return s/2}function r(t,e){const i=e.length,n=t.length;if(n>0){let o=!0;for(let s=0;s<i;s++)if(t[n-i+s]!==e[s]){o=!1;break}if(o)return!1}for(let o=0;o<i;o++)t[n+o]=e[o];return!0}function a(t,e){const i=e.length;for(let n=0;n<i;n++)t[n]=e[n]}function l(t,e,i,n,o=[]){const s=n+e*i;for(let e=0;e<i;e++)o[e]=t[s+e];return o}function c(t,e,i,n,o=[]){let s,r;if(8&i)s=(n[3]-t[1])/(e[1]-t[1]),r=3;else if(4&i)s=(n[1]-t[1])/(e[1]-t[1]),r=1;else if(2&i)s=(n[2]-t[0])/(e[0]-t[0]),r=2;else{if(!(1&i))return null;s=(n[0]-t[0])/(e[0]-t[0]),r=0}for(let i=0;i<t.length;i++)o[i]=(1&r)===i?n[r]:s*(e[i]-t[i])+t[i];return o}function u(t,e){let i=0;return t[0]<e[0]?i|=1:t[0]>e[2]&&(i|=2),t[1]<e[1]?i|=4:t[1]>e[3]&&(i|=8),i}function h(t,e={}){const{size:i=2,broken:n=!1,gridResolution:o=10,gridOffset:s=[0,0],startIndex:h=0,endIndex:d=t.length}=e,p=(d-h)/i;let g=[];const v=[g],y=l(t,0,i,h);let x,_;const b=f(y,o,s,[]),P=[];r(g,y);for(let e=1;e<p;e++){for(x=l(t,e,i,h,x),_=u(x,b);_;){c(y,x,_,b,P);const t=u(P,b);t&&(c(y,P,t,b,P),_=t),r(g,P),a(y,P),m(b,o,_),n&&g.length>i&&(g=[],v.push(g),r(g,y)),_=u(x,b)}r(g,x),a(y,x)}return n?v:v[0]}function d(t,e){for(let i=0;i<e.length;i++)t.push(e[i]);return t}function p(t,e,i={}){if(!t.length)return[];const{size:n=2,gridResolution:o=10,gridOffset:s=[0,0],edgeTypes:r=!1}=i,a=[],l=[{pos:t,types:r&&new Array(t.length/n).fill(1),holes:e||[]}],c=[[],[]];let h=[];for(;l.length;){const{pos:t,types:e,holes:i}=l.shift();v(t,n,i[0]||t.length,c),h=f(c[0],o,s,h);const p=u(c[1],h);if(p){let o=g(t,e,n,0,i[0]||t.length,h,p);const s={pos:o[0].pos,types:o[0].types,holes:[]},a={pos:o[1].pos,types:o[1].types,holes:[]};l.push(s,a);for(let l=0;l<i.length;l++)o=g(t,e,n,i[l],i[l+1]||t.length,h,p),o[0]&&(s.holes.push(s.pos.length),s.pos=d(s.pos,o[0].pos),r&&(s.types=d(s.types,o[0].types))),o[1]&&(a.holes.push(a.pos.length),a.pos=d(a.pos,o[1].pos),r&&(a.types=d(a.types,o[1].types)))}else{const n={positions:t};r&&(n.edgeTypes=e),i.length&&(n.holeIndices=i),a.push(n)}}return a}function g(t,e,i,n,o,s,u){const h=(o-n)/i,d=[],p=[],g=[],f=[],m=[];let v,y,x;const _=l(t,h-1,i,n);let b=Math.sign(8&u?_[1]-s[3]:_[0]-s[2]),P=e&&e[h-1],C=0,S=0;for(let o=0;o<h;o++)v=l(t,o,i,n,v),y=Math.sign(8&u?v[1]-s[3]:v[0]-s[2]),x=e&&e[n/i+o],y&&b&&b!==y&&(c(_,v,u,s,m),r(d,m)&&g.push(P),r(p,m)&&f.push(P)),y<=0?(r(d,v)&&g.push(x),C-=y):g.length&&(g[g.length-1]=0),y>=0?(r(p,v)&&f.push(x),S+=y):f.length&&(f[f.length-1]=0),a(_,v),b=y,P=x;return[C?{pos:d,types:e&&g}:null,S?{pos:p,types:e&&f}:null]}function f(t,e,i,n){const o=Math.floor((t[0]-i[0])/e)*e+i[0],s=Math.floor((t[1]-i[1])/e)*e+i[1];return n[0]=o,n[1]=s,n[2]=o+e,n[3]=s+e,n}function m(t,e,i){8&i?(t[1]+=e,t[3]+=e):4&i?(t[1]-=e,t[3]-=e):2&i?(t[0]+=e,t[2]+=e):1&i&&(t[0]-=e,t[2]-=e)}function v(t,e,i,n){let o=1/0,s=-1/0,r=1/0,a=-1/0;for(let n=0;n<i;n+=e){const e=t[n],i=t[n+1];o=e<o?e:o,s=e>s?e:s,r=i<r?i:r,a=i>a?i:a}return n[0][0]=o,n[0][1]=r,n[1][0]=s,n[1][1]=a,n}function y(t,e={}){const{size:i=2,startIndex:n=0,endIndex:o=t.length,normalize:s=!0}=e,r=t.slice(n,o);P(r,i,0,o-n);const a=h(r,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const t of a)C(t,i);return a}function x(t,e,i={}){const{size:n=2,normalize:o=!0,edgeTypes:s=!1}=i;e=e||[];const r=[],a=[];let l=0,c=0;for(let o=0;o<=e.length;o++){const s=e[o]||t.length,u=c,h=_(t,n,l,s);for(let e=h;e<s;e++)r[c++]=t[e];for(let e=l;e<h;e++)r[c++]=t[e];P(r,n,u,c),b(r,n,u,c,i.maxLatitude),l=s,a[o]=c}a.pop();const u=p(r,a,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(o)for(const t of u)C(t.positions,n);return u}function _(t,e,i,n){let o=-1,s=-1;for(let r=i+1;r<n;r+=e){const e=Math.abs(t[r]);e>o&&(o=e,s=r-1)}return s}function b(t,e,i,n,o=85.051129){const s=t[i],a=t[n-e];if(Math.abs(s-a)>180){const n=l(t,0,e,i);n[0]+=360*Math.round((a-s)/360),r(t,n),n[1]=Math.sign(n[1])*o,r(t,n),n[0]=s,r(t,n)}}function P(t,e,i,n){let o,s=t[0];for(let r=i;r<n;r+=e){o=t[r];const e=o-s;(e>180||e<-180)&&(o-=360*Math.round(e/360)),t[r]=s=o}}function C(t,e){let i;const n=t.length/e;for(let o=0;o<n&&(i=t[o*e],(i+180)%360==0);o++);const o=360*-Math.round(i/360);if(0!==o)for(let i=0;i<n;i++)t[i*e]+=o}},4646:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i(37),o=i.n(n);const s=[1,0,1,0,0,0,0];function r(t,e){const i=parseInt(o()(e).format("x"),10);return parseInt(o()(e).add(t).format("x"),10)-i}function a(t,e){const i=o()(Number(t.reduce((t,e)=>t<e?t:e))),n=o()(Number(t.reduce((t,e)=>t>e?t:e)));let a,l,c;if(e.includes("/")){const t=e.split("/",2);t[0].endsWith("Z")?(l=o()(t[0]),a=o.a.duration(t[1])):(l=o()(t[1]),a=o.a.duration(t[0]))}else a=o.a.duration(e),l=function(t,e){const i=o()(t).subtract(e),n=t.toArray(),r=i.toArray(),a=n.map((t,e)=>r[e]!==t).indexOf(!0),l=n.map((t,e)=>{if(e===a){const i=t-r[e];return t-(t-s[e])%i}return e<a||-1===a?t:s[e]});return o()(l)}(i,a);const u=i.valueOf();for(c=l.clone();c.valueOf()<u;)c.add(a);for(;c.valueOf()>u;)c.subtract(a);let h;const d=n.valueOf();for(h=l.clone();h.valueOf()>d;)h.subtract(a);for(;h.valueOf()<d;)h.add(a);const p=null!=e?[c,c.clone().add(a)]:[c,h],g=t.every(t=>null===t);return{start:parseInt(c.format("x"),10),end:parseInt(h.format("x"),10),getStep:r.bind(this,a),values:p.map(t=>parseInt(t.format("x"),10)),disabled:g}}},4648:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(4647),l=i(1685),c=i.n(l),u=i(13),h=i(4654),d=i.n(h);i(4656),i(4657);function p(t){return o.a.createElement("span",{className:"BootstrapSliderWrapper"},o.a.createElement(d.a,t))}i(4658);const g={start:r.a.number.isRequired,step:r.a.number.isRequired,end:r.a.number.isRequired,values:r.a.array.isRequired,onChange:r.a.func,loopDuration:r.a.number,maxFrames:r.a.number,orientation:r.a.oneOf(["horizontal","vertical"]),reversed:r.a.bool,disabled:r.a.bool,range:r.a.bool};class f extends o.a.PureComponent{constructor(t){super(t),this.state={intervalId:null};const e=t.end-t.start,i=Math.min(t.maxFrames,e/t.step),n=e/i;this.intervalMilliseconds=t.loopDuration/i,this.increment=n<t.step?t.step:n-n%t.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){c.a.bind(["space"],this.play)}componentWillUnmount(){c.a.unbind(["space"])}onChange(t){this.props.onChange(t.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const t=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:t})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:t,end:e,step:i,values:n,disabled:o}=this.props;if(o)return;const s=(Array.isArray(n)?n:[n,n+i]).map(t=>t+this.increment),r=s[1]>e?s[0]-t:0;this.props.onChange(s.map(t=>t-r))}stepBackward(){const{start:t,end:e,step:i,values:n,disabled:o}=this.props;if(o)return;const s=(Array.isArray(n)?n:[n,n+i]).map(t=>t-this.increment),r=s[0]<t?e-s[1]:0;this.props.onChange(s.map(t=>t+r))}formatter(t){if(this.props.disabled)return Object(u.e)("Data has no time steps");let e=t;return Array.isArray(t)?t[0]===t[1]&&(e=[t[0]]):e=[t],e.map(t=>new Date(t).toUTCString()).join(" : ")}render(){const{start:t,end:e,step:i,orientation:n,reversed:s,disabled:r,range:a,values:l}=this.props;return o.a.createElement("div",{className:"play-slider"},o.a.createElement("div",{className:"play-slider-controls padded"},o.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),o.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),o.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),o.a.createElement("div",{className:"play-slider-scrobbler padded"},o.a.createElement(p,{value:a?l:l[0],range:a,formatter:this.formatter,change:this.onChange,min:t,max:e,step:i,orientation:n,reversed:s,disabled:r?"disabled":"enabled"})))}}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}f.propTypes=g,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const v={getLayers:r.a.func.isRequired,start:r.a.number.isRequired,end:r.a.number.isRequired,getStep:r.a.func,values:r.a.array.isRequired,aggregation:r.a.bool,disabled:r.a.bool,viewport:r.a.object.isRequired,children:r.a.node,mapStyle:r.a.string,mapboxApiAccessToken:r.a.string.isRequired,setControlValue:r.a.func,onValuesChange:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class y extends o.a.PureComponent{constructor(){super(...arguments),m(this,"containerRef",o.a.createRef()),m(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)})}render(){const{start:t,end:e,getStep:i,disabled:n,aggregation:s,children:r,getLayers:l,values:c,onValuesChange:u,viewport:h,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,height:m,width:v}=this.props,y=l(c);return o.a.createElement("div",null,o.a.createElement(a.a,{ref:this.containerRef,viewport:h,layers:y,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,bottomMargin:n?0:20,width:v,height:m}),!n&&o.a.createElement(f,{start:t,end:e,step:i(t),values:c,range:!s,onChange:u}),r)}}y.propTypes=v,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},4652:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return l}));const n={SUM:1,MEAN:2,MIN:3,MAX:4};function o(t,e){return t+e}function s(t,e){return e>t?e:t}function r(t,e){return e<t?e:t}function a(t,e,i){const a=n[t]||n.SUM;switch(e=function(t,e={}){if(Number.isFinite(t))return t;return i=>(e.index=i.index,t(i.source,e))}(e,i),a){case n.MIN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(r,1/0):null}(t,e);case n.SUM:return t=>function(t,e){if(Number.isFinite(e))return t.length?t.length*e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(o,0):null}(t,e);case n.MEAN:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(o,0)/i.length:null}(t,e);case n.MAX:return t=>function(t,e){if(Number.isFinite(e))return t.length?e:null;const i=t.map(e).filter(Number.isFinite);return i.length?i.reduce(s,-1/0):null}(t,e);default:return null}}function l(t,e={}){return i=>(e.indices=i.map(t=>t.index),t(i.map(t=>t.source),e))}},4654:function(t,e,i){var n,o,s;o=[e,i(90),i(217),i(265),i(255),i(256),i(0),i(2),i(4655)],void 0===(s="function"==typeof(n=function(t,e,i,n,o,s,r,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactBootstrapSlider=void 0;var c=v(e),u=v(i),h=v(n),d=v(o),p=v(s),g=v(r),f=v(a),m=v(l);function v(t){return t&&t.__esModule?t:{default:t}}var y=t.ReactBootstrapSlider=function(t){function e(){var t,i,n,o;(0,u.default)(this,e);for(var s=arguments.length,r=Array(s),a=0;a<s;a++)r[a]=arguments[a];return i=n=(0,d.default)(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(r))),n.checkAndDoDisabled=function(){var t="disabled"!==n.props.disabled,e=n.mySlider.isEnabled();t?e||n.mySlider.enable():e&&n.mySlider.disable()},n.updateSliderValues=function(){void 0===n.props.min||void 0===n.mySlider.min&&void 0===n.mySlider.options.min||n.mySlider.setAttribute("min",n.props.min),void 0===n.props.max||void 0===n.mySlider.max&&void 0===n.mySlider.options.max||n.mySlider.setAttribute("max",n.props.max),void 0===n.props.step||void 0===n.mySlider.step&&void 0===n.mySlider.options.step||n.mySlider.setAttribute("step",n.props.step),n.mySlider.setValue(n.props.value),n.checkAndDoDisabled()},o=i,(0,d.default)(n,o)}return(0,p.default)(e,t),(0,h.default)(e,[{key:"componentDidMount",value:function(){var t=this,e=(0,c.default)({},this.props,{tooltip:this.props.tooltip||"show"});if(this.mySlider=new m.default(this.node,e),this.props.change||this.props.handleChange){var i=this.props.change||this.props.handleChange;this.mySlider.on("change",(function(t){var e={target:{}};e.target.value=t.newValue,i(e)}))}this.props.slideStop&&this.mySlider.on("slideStop",(function(e){var i={target:{}};i.target.value=e,t.props.slideStop(i)})),this.checkAndDoDisabled()}},{key:"componentDidUpdate",value:function(){this.updateSliderValues()}},{key:"componentWillUnmount",value:function(){this.mySlider.destroy()}},{key:"render",value:function(){var t=this;return g.default.createElement("div",{ref:function(e){return t.node=e}})}}]),e}(g.default.Component);y.propTypes={min:f.default.number,max:f.default.number,step:f.default.number,value:f.default.oneOfType([f.default.number,f.default.arrayOf(f.default.number.isRequired).isRequired]).isRequired,disabled:f.default.string,tooltip:f.default.string,change:f.default.func,handleChange:f.default.func,slideStop:f.default.func,labelledby:f.default.oneOfType([f.default.string,f.default.arrayOf(f.default.string)])},t.default=y})?n.apply(e,o):n)||(t.exports=s)},4655:function(t,e,i){"use strict";var n,o,s,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a="object"===("undefined"==typeof window?"undefined":r(window));o=[i(107)],void 0===(s="function"==typeof(n=function(t){var e;return a&&!window.console&&(window.console={}),a&&!window.console.log&&(window.console.log=function(){}),a&&!window.console.warn&&(window.console.warn=function(){}),function(t){var e=Array.prototype.slice;function i(){}!function(t){if(t){var n="undefined"==typeof console?i:function(t){console.error(t)};t.bridget=function(i,o){!function(e){e.prototype.option||(e.prototype.option=function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))})}(o),function(i,o){t.fn[i]=function(s){if("string"==typeof s){for(var r=e.call(arguments,1),a=0,l=this.length;a<l;a++){var c=this[a],u=t.data(c,i);if(u)if(t.isFunction(u[s])&&"_"!==s.charAt(0)){var h=u[s].apply(u,r);if(void 0!==h&&h!==u)return h}else n("no such method '"+s+"' for "+i+" instance");else n("cannot call methods on "+i+" prior to initialization; attempted to call '"+s+"'")}return this}var d=this.map((function(){var e=t.data(this,i);return e?(e.option(s),e._init()):(e=new o(this,s),t.data(this,i,e)),t(this)}));return!d||d.length>1?d:d[0]}}(i,o)},t.bridget}}(t)}(t),function(t){var i=function(t){return"Invalid input value '"+t+"' passed in"},n={linear:{toValue:function(t){var e=t/100*(this.options.max-this.options.min),i=!0;if(this.options.ticks_positions.length>0){for(var n,o,s,r=0,a=1;a<this.options.ticks_positions.length;a++)if(t<=this.options.ticks_positions[a]){n=this.options.ticks[a-1],s=this.options.ticks_positions[a-1],o=this.options.ticks[a],r=this.options.ticks_positions[a];break}e=n+(t-s)/(r-s)*(o-n),i=!1}var l=(i?this.options.min:0)+Math.round(e/this.options.step)*this.options.step;return l<this.options.min?this.options.min:l>this.options.max?this.options.max:l},toPercentage:function(t){if(this.options.max===this.options.min)return 0;if(this.options.ticks_positions.length>0){for(var e,i,n,o=0,s=0;s<this.options.ticks.length;s++)if(t<=this.options.ticks[s]){e=s>0?this.options.ticks[s-1]:0,n=s>0?this.options.ticks_positions[s-1]:0,i=this.options.ticks[s],o=this.options.ticks_positions[s];break}if(s>0)return n+(t-e)/(i-e)*(o-n)}return 100*(t-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(t){var e=0===this.options.min?0:Math.log(this.options.min),i=Math.log(this.options.max),n=Math.exp(e+(i-e)*t/100);return Math.round(n)===this.options.max?this.options.max:(n=this.options.min+Math.round((n-this.options.min)/this.options.step)*this.options.step)<this.options.min?this.options.min:n>this.options.max?this.options.max:n},toPercentage:function(t){if(this.options.max===this.options.min)return 0;var e=Math.log(this.options.max),i=0===this.options.min?0:Math.log(this.options.min);return 100*((0===t?0:Math.log(t))-i)/(e-i)}}};function o(e,i){this._state={value:null,enabled:null,offset:null,size:null,percentage:null,inDrag:!1,over:!1},this.ticksCallbackMap={},this.handleCallbackMap={},"string"==typeof e?this.element=document.querySelector(e):e instanceof HTMLElement&&(this.element=e),i=i||{};for(var o=Object.keys(this.defaultOptions),s=0;s<o.length;s++){var r=o[s],a=i[r];a=null!==(a=void 0!==a?a:l(this.element,r))?a:this.defaultOptions[r],this.options||(this.options={}),this.options[r]=a}function l(t,e){var i="data-slider-"+e.replace(/_/g,"-"),n=t.getAttribute(i);try{return JSON.parse(n)}catch(t){return n}}"auto"===this.options.rtl&&(this.options.rtl="rtl"===window.getComputedStyle(this.element).direction),"vertical"!==this.options.orientation||"top"!==this.options.tooltip_position&&"bottom"!==this.options.tooltip_position?"horizontal"!==this.options.orientation||"left"!==this.options.tooltip_position&&"right"!==this.options.tooltip_position||(this.options.tooltip_position="top"):this.options.rtl?this.options.tooltip_position="left":this.options.tooltip_position="right";var c,u,h,d,p,g=this.element.style.width,f=!1,m=this.element.parentNode;if(this.sliderElem)f=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var v=document.createElement("div");v.className="slider-track",(u=document.createElement("div")).className="slider-track-low",(c=document.createElement("div")).className="slider-selection",(h=document.createElement("div")).className="slider-track-high",(d=document.createElement("div")).className="slider-handle min-slider-handle",d.setAttribute("role","slider"),d.setAttribute("aria-valuemin",this.options.min),d.setAttribute("aria-valuemax",this.options.max),(p=document.createElement("div")).className="slider-handle max-slider-handle",p.setAttribute("role","slider"),p.setAttribute("aria-valuemin",this.options.min),p.setAttribute("aria-valuemax",this.options.max),v.appendChild(u),v.appendChild(c),v.appendChild(h),this.rangeHighlightElements=[];var y=this.options.rangeHighlights;if(Array.isArray(y)&&y.length>0)for(var x=0;x<y.length;x++){var _=document.createElement("div"),b=y[x].class||"";_.className="slider-rangeHighlight slider-selection "+b,this.rangeHighlightElements.push(_),v.appendChild(_)}var P=Array.isArray(this.options.labelledby);if(P&&this.options.labelledby[0]&&d.setAttribute("aria-labelledby",this.options.labelledby[0]),P&&this.options.labelledby[1]&&p.setAttribute("aria-labelledby",this.options.labelledby[1]),!P&&this.options.labelledby&&(d.setAttribute("aria-labelledby",this.options.labelledby),p.setAttribute("aria-labelledby",this.options.labelledby)),this.ticks=[],Array.isArray(this.options.ticks)&&this.options.ticks.length>0){for(this.ticksContainer=document.createElement("div"),this.ticksContainer.className="slider-tick-container",s=0;s<this.options.ticks.length;s++){var C=document.createElement("div");if(C.className="slider-tick",this.options.ticks_tooltip){var S=this._addTickListener(),w=S.addMouseEnter(this,C,s),A=S.addMouseLeave(this,C);this.ticksCallbackMap[s]={mouseEnter:w,mouseLeave:A}}this.ticks.push(C),this.ticksContainer.appendChild(C)}c.className+=" tick-slider-selection"}if(this.tickLabels=[],Array.isArray(this.options.ticks_labels)&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",s=0;s<this.options.ticks_labels.length;s++){var L=document.createElement("div"),E=0===this.options.ticks_positions.length,M=this.options.reversed&&E?this.options.ticks_labels.length-(s+1):s;L.className="slider-tick-label",L.innerHTML=this.options.ticks_labels[M],this.tickLabels.push(L),this.tickLabelContainer.appendChild(L)}var O=function(t){var e=document.createElement("div");e.className="tooltip-arrow";var i=document.createElement("div");i.className="tooltip-inner",t.appendChild(e),t.appendChild(i)},k=document.createElement("div");k.className="tooltip tooltip-main",k.setAttribute("role","presentation"),O(k);var z=document.createElement("div");z.className="tooltip tooltip-min",z.setAttribute("role","presentation"),O(z);var T=document.createElement("div");T.className="tooltip tooltip-max",T.setAttribute("role","presentation"),O(T),this.sliderElem.appendChild(v),this.sliderElem.appendChild(k),this.sliderElem.appendChild(z),this.sliderElem.appendChild(T),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),this.ticksContainer&&this.sliderElem.appendChild(this.ticksContainer),this.sliderElem.appendChild(d),this.sliderElem.appendChild(p),m.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(t&&(this.$element=t(this.element),this.$sliderElem=t(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.touchX=0,this.touchY=0,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),n[this.options.scale]&&(this.options.scale=n[this.options.scale]),!0===f&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.sliderElem,"slider-rtl"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","right","top","width","height"].forEach((function(t){this._removeProperty(this.trackLow,t),this._removeProperty(this.trackSelection,t),this._removeProperty(this.trackHigh,t)}),this),[this.handle1,this.handle2].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top")}),this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach((function(t){this._removeProperty(t,"left"),this._removeProperty(t,"right"),this._removeProperty(t,"top"),this._removeProperty(t,"margin-left"),this._removeProperty(t,"margin-right"),this._removeProperty(t,"margin-top"),this._removeClass(t,"right"),this._removeClass(t,"left"),this._removeClass(t,"top")}),this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=g,this.options.orientation="horizontal",this.options.rtl?this.stylePos="right":this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"),this.options.rtl&&this._addClass(this.sliderElem,"slider-rtl"),this._setTooltipPosition(),Array.isArray(this.options.ticks)&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),Array.isArray(this.options.value)?(this.options.range=!0,this._state.value=this.options.value):this.options.range?this._state.value=[this.options.value,this.options.max]:this._state.value=this.options.value,this.trackLow=u||this.trackLow,this.trackSelection=c||this.trackSelection,this.trackHigh=h||this.trackHigh,"none"===this.options.selection?(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")):"after"!==this.options.selection&&"before"!==this.options.selection||(this._removeClass(this.trackLow,"hide"),this._removeClass(this.trackSelection,"hide"),this._removeClass(this.trackHigh,"hide")),this.handle1=d||this.handle1,this.handle2=p||this.handle2,!0===f)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),s=0;s<this.ticks.length;s++)this._removeClass(this.ticks[s],"round triangle hide");if(-1!==["round","triangle","custom"].indexOf(this.options.handle))for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),s=0;s<this.ticks.length;s++)this._addClass(this.ticks[s],this.options.handle);if(this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this.setValue(this._state.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.mousedown=this._mousedown.bind(this),this.touchstart=this._touchstart.bind(this),this.touchmove=this._touchmove.bind(this),this.touchCapable){var I=!1;try{var R=Object.defineProperty({},"passive",{get:function(){I=!0}});window.addEventListener("test",null,R)}catch(t){}var D=!!I&&{passive:!0};this.sliderElem.addEventListener("touchstart",this.touchstart,D),this.sliderElem.addEventListener("touchmove",this.touchmove,D)}if(this.sliderElem.addEventListener("mousedown",this.mousedown,!1),this.resize=this._resize.bind(this),window.addEventListener("resize",this.resize,!1),"hide"===this.options.tooltip)this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide");else if("always"===this.options.tooltip)this._showTooltip(),this._alwaysShowTooltip=!0;else{if(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.options.ticks_tooltip){var F=this._addTickListener(),j=F.addMouseEnter(this,this.handle1),N=F.addMouseLeave(this,this.handle1);this.handleCallbackMap.handle1={mouseEnter:j,mouseLeave:N},j=F.addMouseEnter(this,this.handle2),N=F.addMouseLeave(this,this.handle2),this.handleCallbackMap.handle2={mouseEnter:j,mouseLeave:N}}else this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1);this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)}this.options.enabled?this.enable():this.disable()}if((e=function(t,e){return o.call(this,t,e),this}).prototype={_init:function(){},constructor:e,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,rtl:"auto",enabled:!0,formatter:function(t){return Array.isArray(t)?t[0]+" : "+t[1]:t},natural_arrow_keys:!1,ticks:[],ticks_positions:[],ticks_labels:[],ticks_snap_bounds:0,ticks_tooltip:!1,scale:"linear",focus:!1,tooltip_position:null,labelledby:null,rangeHighlights:[]},getElement:function(){return this.sliderElem},getValue:function(){return this.options.range?this._state.value:this._state.value[0]},setValue:function(t,e,i){t||(t=0);var n=this.getValue();this._state.value=this._validateInputValue(t);var o=this._applyPrecision.bind(this);this.options.range?(this._state.value[0]=o(this._state.value[0]),this._state.value[1]=o(this._state.value[1]),this._state.value[0]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[0])),this._state.value[1]=Math.max(this.options.min,Math.min(this.options.max,this._state.value[1]))):(this._state.value=o(this._state.value),this._state.value=[Math.max(this.options.min,Math.min(this.options.max,this._state.value))],this._addClass(this.handle2,"hide"),"after"===this.options.selection?this._state.value[1]=this.options.max:this._state.value[1]=this.options.min),this.options.max>this.options.min?this._state.percentage=[this._toPercentage(this._state.value[0]),this._toPercentage(this._state.value[1]),100*this.options.step/(this.options.max-this.options.min)]:this._state.percentage=[0,0,100],this._layout();var s=this.options.range?this._state.value:this._state.value[0];return this._setDataVal(s),!0===e&&this._trigger("slide",s),n!==s&&!0===i&&this._trigger("change",{oldValue:n,newValue:s}),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),t&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this._state.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this._state.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this._state.enabled?this.disable():this.enable(),this},isEnabled:function(){return this._state.enabled},on:function(t,e){return this._bindNonQueryEventHandler(t,e),this},off:function(e,i){t?(this.$element.off(e,i),this.$sliderElem.off(e,i)):this._unbindNonQueryEventHandler(e,i)},getAttribute:function(t){return t?this.options[t]:this.options},setAttribute:function(t,e){return this.options[t]=e,this},refresh:function(){return this._removeSliderEventHandlers(),o.call(this,this.element,this.options),t&&t.data(this.element,"slider",this),this},relayout:function(){return this._resize(),this._layout(),this},_removeSliderEventHandlers:function(){if(this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.options.ticks_tooltip){for(var t=this.ticksContainer.getElementsByClassName("slider-tick"),e=0;e<t.length;e++)t[e].removeEventListener("mouseenter",this.ticksCallbackMap[e].mouseEnter,!1),t[e].removeEventListener("mouseleave",this.ticksCallbackMap[e].mouseLeave,!1);this.handle1.removeEventListener("mouseenter",this.handleCallbackMap.handle1.mouseEnter,!1),this.handle2.removeEventListener("mouseenter",this.handleCallbackMap.handle2.mouseEnter,!1),this.handle1.removeEventListener("mouseleave",this.handleCallbackMap.handle1.mouseLeave,!1),this.handle2.removeEventListener("mouseleave",this.handleCallbackMap.handle2.mouseLeave,!1)}this.handleCallbackMap=null,this.ticksCallbackMap=null,this.showTooltip&&(this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle2.removeEventListener("focus",this.showTooltip,!1)),this.hideTooltip&&(this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("blur",this.hideTooltip,!1)),this.showTooltip&&this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.hideTooltip&&this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.touchstart,!1),this.sliderElem.removeEventListener("touchmove",this.touchmove,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1),window.removeEventListener("resize",this.resize,!1)},_bindNonQueryEventHandler:function(t,e){void 0===this.eventToCallbackMap[t]&&(this.eventToCallbackMap[t]=[]),this.eventToCallbackMap[t].push(e)},_unbindNonQueryEventHandler:function(t,e){var i=this.eventToCallbackMap[t];if(void 0!==i)for(var n=0;n<i.length;n++)if(i[n]===e){i.splice(n,1);break}},_cleanUpEventCallbacksMap:function(){for(var t=Object.keys(this.eventToCallbackMap),e=0;e<t.length;e++){var i=t[e];delete this.eventToCallbackMap[i]}},_showTooltip:function(){!1===this.options.tooltip_split?(this._addClass(this.tooltip,"in"),this.tooltip_min.style.display="none",this.tooltip_max.style.display="none"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in"),this.tooltip.style.display="none"),this._state.over=!0},_hideTooltip:function(){!1===this._state.inDrag&&!0!==this.alwaysShowTooltip&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this._state.over=!1},_setToolTipOnMouseOver:function(t){var e=this.options.formatter(t?t.value[0]:this._state.value[0]),i=n(t||this._state,this.options.reversed);function n(t,e){return e?[100-t.percentage[0],this.options.range?100-t.percentage[1]:t.percentage[1]]:[t.percentage[0],t.percentage[1]]}this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=i[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px")},_addTickListener:function(){return{addMouseEnter:function(t,e,i){var n=function(){var e=t._state,n=i>=0?i:this.attributes["aria-valuenow"].value,o=parseInt(n,10);e.value[0]=o,e.percentage[0]=t.options.ticks_positions[o],t._setToolTipOnMouseOver(e),t._showTooltip()};return e.addEventListener("mouseenter",n,!1),n},addMouseLeave:function(t,e){var i=function(){t._hideTooltip()};return e.addEventListener("mouseleave",i,!1),i}}},_layout:function(){var t,e;if(t=this.options.reversed?[100-this._state.percentage[0],this.options.range?100-this._state.percentage[1]:this._state.percentage[1]]:[this._state.percentage[0],this._state.percentage[1]],this.handle1.style[this.stylePos]=t[0]+"%",this.handle1.setAttribute("aria-valuenow",this._state.value[0]),isNaN(this.options.formatter(this._state.value[0]))&&this.handle1.setAttribute("aria-valuetext",this.options.formatter(this._state.value[0])),this.handle2.style[this.stylePos]=t[1]+"%",this.handle2.setAttribute("aria-valuenow",this._state.value[1]),isNaN(this.options.formatter(this._state.value[1]))&&this.handle2.setAttribute("aria-valuetext",this.options.formatter(this._state.value[1])),this.rangeHighlightElements.length>0&&Array.isArray(this.options.rangeHighlights)&&this.options.rangeHighlights.length>0)for(var i=0;i<this.options.rangeHighlights.length;i++){var n=this._toPercentage(this.options.rangeHighlights[i].start),o=this._toPercentage(this.options.rangeHighlights[i].end);if(this.options.reversed){var s=100-o;o=100-n,n=s}var r=this._createHighlightRange(n,o);r?"vertical"===this.options.orientation?(this.rangeHighlightElements[i].style.top=r.start+"%",this.rangeHighlightElements[i].style.height=r.size+"%"):(this.options.rtl?this.rangeHighlightElements[i].style.right=r.start+"%":this.rangeHighlightElements[i].style.left=r.start+"%",this.rangeHighlightElements[i].style.width=r.size+"%"):this.rangeHighlightElements[i].style.display="none"}if(Array.isArray(this.options.ticks)&&this.options.ticks.length>0){var a,l="vertical"===this.options.orientation?"height":"width";a="vertical"===this.options.orientation?"marginTop":this.options.rtl?"marginRight":"marginLeft";var c=this._state.size/(this.options.ticks.length-1);if(this.tickLabelContainer){var u=0;if(0===this.options.ticks_positions.length)"vertical"!==this.options.orientation&&(this.tickLabelContainer.style[a]=-c/2+"px"),u=this.tickLabelContainer.offsetHeight;else for(h=0;h<this.tickLabelContainer.childNodes.length;h++)this.tickLabelContainer.childNodes[h].offsetHeight>u&&(u=this.tickLabelContainer.childNodes[h].offsetHeight);"horizontal"===this.options.orientation&&(this.sliderElem.style.marginBottom=u+"px")}for(var h=0;h<this.options.ticks.length;h++){var d=this.options.ticks_positions[h]||this._toPercentage(this.options.ticks[h]);this.options.reversed&&(d=100-d),this.ticks[h].style[this.stylePos]=d+"%",this._removeClass(this.ticks[h],"in-selection"),this.options.range?d>=t[0]&&d<=t[1]&&this._addClass(this.ticks[h],"in-selection"):"after"===this.options.selection&&d>=t[0]?this._addClass(this.ticks[h],"in-selection"):"before"===this.options.selection&&d<=t[0]&&this._addClass(this.ticks[h],"in-selection"),this.tickLabels[h]&&(this.tickLabels[h].style[l]=c+"px","vertical"!==this.options.orientation&&void 0!==this.options.ticks_positions[h]?(this.tickLabels[h].style.position="absolute",this.tickLabels[h].style[this.stylePos]=d+"%",this.tickLabels[h].style[a]=-c/2+"px"):"vertical"===this.options.orientation&&(this.options.rtl?this.tickLabels[h].style.marginRight=this.sliderElem.offsetWidth+"px":this.tickLabels[h].style.marginLeft=this.sliderElem.offsetWidth+"px",this.tickLabelContainer.style[a]=this.sliderElem.offsetWidth/2*-1+"px"))}}if(this.options.range){e=this.options.formatter(this._state.value),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=(t[1]+t[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");var p=this.options.formatter(this._state.value[0]);this._setText(this.tooltipInner_min,p);var g=this.options.formatter(this._state.value[1]);this._setText(this.tooltipInner_max,g),this.tooltip_min.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-"+this.stylePos,-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=t[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-"+this.stylePos,-this.tooltip_max.offsetWidth/2+"px")}else e=this.options.formatter(this._state.value[0]),this._setText(this.tooltipInner,e),this.tooltip.style[this.stylePos]=t[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-"+this.stylePos,-this.tooltip.offsetWidth/2+"px");if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(t[0],t[1])+"%",this.trackSelection.style.top=Math.min(t[0],t[1])+"%",this.trackSelection.style.height=Math.abs(t[0]-t[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";else{"right"===this.stylePos?this.trackLow.style.right="0":this.trackLow.style.left="0",this.trackLow.style.width=Math.min(t[0],t[1])+"%","right"===this.stylePos?this.trackSelection.style.right=Math.min(t[0],t[1])+"%":this.trackSelection.style.left=Math.min(t[0],t[1])+"%",this.trackSelection.style.width=Math.abs(t[0]-t[1])+"%","right"===this.stylePos?this.trackHigh.style.left="0":this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(t[0],t[1])-Math.abs(t[0]-t[1])+"%";var f=this.tooltip_min.getBoundingClientRect(),m=this.tooltip_max.getBoundingClientRect();"bottom"===this.options.tooltip_position?f.right>m.left?(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="",this.tooltip_max.style.bottom="22px"):(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top=this.tooltip_min.style.top,this.tooltip_max.style.bottom=""):f.right>m.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}},_createHighlightRange:function(t,e){return this._isHighlightRange(t,e)?t>e?{start:e,size:t-e}:{start:t,size:e-t}:null},_isHighlightRange:function(t,e){return 0<=t&&t<=100&&0<=e&&e<=100},_resize:function(t){this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos],this._layout()},_removeProperty:function(t,e){t.style.removeProperty?t.style.removeProperty(e):t.style.removeAttribute(e)},_mousedown:function(t){if(!this._state.enabled)return!1;this._state.offset=this._offset(this.sliderElem),this._state.size=this.sliderElem[this.sizePos];var e=this._getPercentage(t);if(this.options.range){var i=Math.abs(this._state.percentage[0]-e),n=Math.abs(this._state.percentage[1]-e);this._state.dragged=i<n?0:1,this._adjustPercentageForRangeSliders(e)}else this._state.dragged=0;this._state.percentage[this._state.dragged]=e,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!0;var o=this._calculateValue();return this._trigger("slideStart",o),this._setDataVal(o),this.setValue(o,!1,!0),t.returnValue=!1,this.options.focus&&this._triggerFocusOnHandle(this._state.dragged),!0},_touchstart:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0];this.touchX=e.pageX,this.touchY=e.pageY}else this._mousedown(t)},_triggerFocusOnHandle:function(t){0===t&&this.handle1.focus(),1===t&&this.handle2.focus()},_keydown:function(t,e){if(!this._state.enabled)return!1;var i;switch(e.keyCode){case 37:case 40:i=-1;break;case 39:case 38:i=1}if(i){if(this.options.natural_arrow_keys){var n="vertical"===this.options.orientation&&!this.options.reversed,o="horizontal"===this.options.orientation&&this.options.reversed;(n||o)&&(i=-i)}var s=this._state.value[t]+i*this.options.step,r=s/this.options.max*100;return this._state.keyCtrl=t,this.options.range&&(this._adjustPercentageForRangeSliders(r),s=[this._state.keyCtrl?this._state.value[0]:s,this._state.keyCtrl?s:this._state.value[1]]),this._trigger("slideStart",s),this._setDataVal(s),this.setValue(s,!0,!0),this._setDataVal(s),this._trigger("slideStop",s),this._layout(),this._pauseEvent(e),delete this._state.keyCtrl,!1}},_pauseEvent:function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1},_mousemove:function(t){if(!this._state.enabled)return!1;var e=this._getPercentage(t);this._adjustPercentageForRangeSliders(e),this._state.percentage[this._state.dragged]=e,this._layout();var i=this._calculateValue(!0);return this.setValue(i,!0,!0),!1},_touchmove:function(t){if(void 0!==t.changedTouches){var e=t.changedTouches[0],i=e.pageX-this.touchX,n=e.pageY-this.touchY;this._state.inDrag||("vertical"===this.options.orientation&&i<=5&&i>=-5&&(n>=15||n<=-15)?this._mousedown(t):n<=5&&n>=-5&&(i>=15||i<=-15)&&this._mousedown(t))}},_adjustPercentageForRangeSliders:function(t){if(this.options.range){var e=this._getNumDigitsAfterDecimalPlace(t);e=e?e-1:0;var i=this._applyToFixedAndParseFloat(t,e);0===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[1],e)<i?(this._state.percentage[0]=this._state.percentage[1],this._state.dragged=1):1===this._state.dragged&&this._applyToFixedAndParseFloat(this._state.percentage[0],e)>i?(this._state.percentage[1]=this._state.percentage[0],this._state.dragged=0):0===this._state.keyCtrl&&this._state.value[1]/this.options.max*100<t?(this._state.percentage[0]=this._state.percentage[1],this._state.keyCtrl=1,this.handle2.focus()):1===this._state.keyCtrl&&this._state.value[0]/this.options.max*100>t&&(this._state.percentage[1]=this._state.percentage[0],this._state.keyCtrl=0,this.handle1.focus())}},_mouseup:function(){if(!this._state.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this._state.inDrag=!1,!1===this._state.over&&this._hideTooltip();var t=this._calculateValue(!0);return this._layout(),this._setDataVal(t),this._trigger("slideStop",t),!1},_calculateValue:function(t){var e;if(this.options.range?(e=[this.options.min,this.options.max],0!==this._state.percentage[0]&&(e[0]=this._toValue(this._state.percentage[0]),e[0]=this._applyPrecision(e[0])),100!==this._state.percentage[1]&&(e[1]=this._toValue(this._state.percentage[1]),e[1]=this._applyPrecision(e[1]))):(e=this._toValue(this._state.percentage[0]),e=parseFloat(e),e=this._applyPrecision(e)),t){for(var i=[e,1/0],n=0;n<this.options.ticks.length;n++){var o=Math.abs(this.options.ticks[n]-e);o<=i[1]&&(i=[this.options.ticks[n],o])}if(i[1]<=this.options.ticks_snap_bounds)return i[0]}return e},_applyPrecision:function(t){var e=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(t,e)},_getNumDigitsAfterDecimalPlace:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},_applyToFixedAndParseFloat:function(t,e){var i=t.toFixed(e);return parseFloat(i)},_getPercentage:function(t){!this.touchCapable||"touchstart"!==t.type&&"touchmove"!==t.type||(t=t.touches[0]);var e=t[this.mousePos]-this._state.offset[this.stylePos];"right"===this.stylePos&&(e=-e);var i=e/this._state.size*100;return i=Math.round(i/this._state.percentage[2])*this._state.percentage[2],this.options.reversed&&(i=100-i),Math.max(0,Math.min(100,i))},_validateInputValue:function(t){if(isNaN(+t)){if(Array.isArray(t))return this._validateArray(t),t;throw new Error(i(t))}return+t},_validateArray:function(t){for(var e=0;e<t.length;e++){var n=t[e];if("number"!=typeof n)throw new Error(i(n))}},_setDataVal:function(t){this.element.setAttribute("data-value",t),this.element.setAttribute("value",t),this.element.value=t},_trigger:function(e,i){i=i||0===i?i:void 0;var n=this.eventToCallbackMap[e];if(n&&n.length)for(var o=0;o<n.length;o++)(0,n[o])(i);t&&this._triggerJQueryEvent(e,i)},_triggerJQueryEvent:function(t,e){var i={type:t,value:e};this.$element.trigger(i),this.$sliderElem.trigger(i)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(t,e){void 0!==t.textContent?t.textContent=e:void 0!==t.innerText&&(t.innerText=e)},_removeClass:function(t,e){for(var i=e.split(" "),n=t.className,o=0;o<i.length;o++){var s=i[o],r=new RegExp("(?:\\s|^)"+s+"(?:\\s|$)");n=n.replace(r," ")}t.className=n.trim()},_addClass:function(t,e){for(var i=e.split(" "),n=t.className,o=0;o<i.length;o++){var s=i[o];new RegExp("(?:\\s|^)"+s+"(?:\\s|$)").test(n)||(n+=" "+s)}t.className=n.trim()},_offsetLeft:function(t){return t.getBoundingClientRect().left},_offsetRight:function(t){return t.getBoundingClientRect().right},_offsetTop:function(t){for(var e=t.offsetTop;(t=t.offsetParent)&&!isNaN(t.offsetTop);)e+=t.offsetTop,"BODY"!==t.tagName&&(e-=t.scrollTop);return e},_offset:function(t){return{left:this._offsetLeft(t),right:this._offsetRight(t),top:this._offsetTop(t)}},_css:function(e,i,n){if(t)t.style(e,i,n);else{var o=i.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(t,e){return e.toUpperCase()}));e.style[o]=n}},_toValue:function(t){return this.options.scale.toValue.apply(this,[t])},_toPercentage:function(t){return this.options.scale.toPercentage.apply(this,[t])},_setTooltipPosition:function(){var t=[this.tooltip,this.tooltip_min,this.tooltip_max];if("vertical"===this.options.orientation){var e,i="left"===(e=this.options.tooltip_position?this.options.tooltip_position:this.options.rtl?"left":"right")?"right":"left";t.forEach(function(t){this._addClass(t,e),t.style[i]="100%"}.bind(this))}else"bottom"===this.options.tooltip_position?t.forEach(function(t){this._addClass(t,"bottom"),t.style.top="22px"}.bind(this)):t.forEach(function(t){this._addClass(t,"top"),t.style.top=-this.tooltip.outerHeight-14+"px"}.bind(this))}},t&&t.fn){var s=void 0;t.fn.slider?(a&&window.console.warn("bootstrap-slider.js - WARNING: $.fn.slider namespace is already bound. Use the $.fn.bootstrapSlider namespace instead."),s="bootstrapSlider"):(t.bridget("slider",e),s="slider"),t.bridget("bootstrapSlider",e),t((function(){t("input[data-provide=slider]")[s]()}))}}(t),e})?n.apply(e,o):n)||(t.exports=s)},4656:function(t,e,i){},4657:function(t,e,i){},4658:function(t,e,i){},4659:function(t,e,i){"use strict";i.d(e,"b",(function(){return w})),i.d(e,"a",(function(){return A}));var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(134),l=i(4647),c=i(917),u=i(4648),h=i(4661),d=i(4665),p=i(4646),g=i(4643),f=i(4640);function m(){return(m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const{getScale:y}=c.b;const x={formData:r.a.object.isRequired,mapboxApiKey:r.a.string.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,getLayer:r.a.func.isRequired,getPoints:r.a.func.isRequired,payload:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class _ extends o.a.PureComponent{constructor(t){super(t),v(this,"containerRef",o.a.createRef()),v(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state=this.getStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(t){t.payload.form_data!==this.state.formData&&this.setState(m({},this.getStateFromProps(t)))}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getStateFromProps(t,e){const i=t.payload.data.features||[],n=i.map(t=>t.__timestamp),o=function(t,e){const i=t.color_picker||{r:0,g:0,b:0,a:1},n=[i.r,i.g,i.b,255*i.a],o=y(t.color_scheme),s={};return e.forEach(e=>{if(null!=e.cat_color&&!s.hasOwnProperty(e.cat_color)){let r;r=t.dimension?Object(d.hexToRGB)(o(e.cat_color),255*i.a):n,s[e.cat_color]={color:r,enabled:!0}}}),s}(t.formData,i);if(e&&t.payload.form_data===e.formData)return m({},e,{categories:o});const s=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:r,end:a,getStep:l,values:c,disabled:u}=Object(p.a)(n,s),{width:h,height:g,formData:v}=t;let{viewport:x}=t;return v.autozoom&&(x=Object(f.a)(x,{width:h,height:g,points:t.getPoints(i)})),x.zoom<0&&(x.zoom=0),{start:r,end:a,getStep:l,values:c,disabled:u,viewport:x,selected:[],lastClick:0,formData:t.payload.form_data,categories:o}}getLayers(t){const{getLayer:e,payload:i,formData:n,onAddFilter:o}=this.props;let s=i.data.features?[...i.data.features]:[];if(s=this.addColor(s,n),n.js_data_mutator){s=Object(g.a)(n.js_data_mutator)(s)}s=t[0]===t[1]||t[1]===this.end?s.filter(e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1]):s.filter(e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]);const r=this.state.categories;return n.dimension&&(s=s.filter(t=>r[t.cat_color]&&r[t.cat_color].enabled)),[e(n,m({},i,{data:m({},i.data,{features:s})}),o,this.setTooltip)]}addColor(t,e){const i=e.color_picker||{r:0,g:0,b:0,a:1},n=y(e.color_scheme);return t.map(t=>{let o;return e.dimension?(o=Object(d.hexToRGB)(n(t.cat_color),255*i.a),m({},t,{color:o})):t})}toggleCategory(t){const e=this.state.categories[t],i=m({},this.state.categories,{[t]:m({},e,{enabled:!e.enabled})});Object.values(i).every(t=>!t.enabled)&&Object.values(i).forEach(t=>{t.enabled=!0}),this.setState({categories:i})}showSingleCategory(t){const e=m({},this.state.categories);Object.values(e).forEach(t=>{t.enabled=!1}),e[t].enabled=!0,this.setState({categories:e})}render(){return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(u.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},o.a.createElement(h.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function b(){return(b=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}_.propTypes=x;const C={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},S={onAddFilter(){}};function w(t,e){class i extends o.a.PureComponent{constructor(t){super(t),P(this,"containerRef",o.a.createRef()),P(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)});const{width:i,height:n,formData:s}=t;let{viewport:r}=t;s.autozoom&&(r=Object(f.a)(r,{width:i,height:n,points:e(t.payload.data.features)})),this.state={viewport:r,layer:this.computeLayer(t)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(t){const e=b({},t.formData,{viewport:null}),i=b({},this.props.formData,{viewport:null});Object(a.isEqual)(e,i)&&t.payload===this.props.payload||this.setState({layer:this.computeLayer(t)})}onViewportChange(t){this.setState({viewport:t})}computeLayer(e){const{formData:i,payload:n,onAddFilter:o}=e;return t(i,n,o,this.setTooltip)}render(){const{formData:t,payload:e,setControlValue:i,height:n,width:s}=this.props,{layer:r,viewport:a}=this.state;return o.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:a,layers:[r],mapStyle:t.mapbox_style,setControlValue:i,width:s,height:n,onViewportChange:this.onViewportChange})}}return i.propTypes=C,i.defaultProps=S,i}function A(t,e){function i(i){const{formData:n,payload:s,setControlValue:r,viewport:a,width:l,height:c}=i;return o.a.createElement(_,{formData:n,mapboxApiKey:s.data.mapboxApiKey,setControlValue:r,viewport:a,getLayer:t,payload:s,getPoints:e,width:l,height:c})}return i.propTypes=C,i.defaultProps=S,i}},4661:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(302);i(4662);const l={categories:r.a.object,toggleCategory:r.a.func,showSingleCategory:r.a.func,format:r.a.string,position:r.a.oneOf([null,"tl","tr","bl","br"])};class c extends o.a.PureComponent{format(t){if(!this.props.format)return t;const e=parseFloat(t);return Object(a.b)(this.props.format,e)}formatCategoryLabel(t){if(!this.props.format)return t;if(t.includes(" - ")){const e=t.split(" - ");return this.format(e[0])+" - "+this.format(e[1])}return this.format(t)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const t=Object.entries(this.props.categories).map(t=>{let[e,i]=t;const n={color:"rgba("+i.color.join(", ")+")"},s=i.enabled?"◼":"◻";return o.a.createElement("li",{key:e},o.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},o.a.createElement("span",{style:n},s)," ",this.formatCategoryLabel(e)))}),e={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return o.a.createElement("div",{className:"legend",style:e},o.a.createElement("ul",{className:"categories"},t))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},4662:function(t,e,i){},4663:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return o}));const n=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function o(t,e=!1,i=Float32Array){let n;if(Number.isFinite(t[0]))n=new i(t);else{n=new i(4*t.length);let e=0;for(let i=0;i<t.length;i++){const o=t[i];n[e++]=o[0],n[e++]=o[1],n[e++]=o[2],n[e++]=Number.isFinite(o[3])?o[3]:255}}if(e)for(let t=0;t<n.length;t++)n[t]/=255;return n}},4670:function(t,e,i){"use strict";i.d(e,"a",(function(){return S}));var n=i(4867),o=i(5018),s=i(4636),r=i(4997),a=i(4992),l=i(5057),c=i(4835),u=i(4653),h=i(4874),d=i(4802),p=i(4652);const g={projectPoints:!1,viewport:null,createBufferObjects:!0,moduleSettings:{}},f=[32775,32774],m=[32776,32774],v=[32776,32775],y={[p.a.SUM]:32774,[p.a.MEAN]:32774,[p.a.MIN]:f,[p.a.MAX]:m},x={size:1,operation:p.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1};var _=i(4694);const b=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],P={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},C=[n.a.WEBGL2,n.a.COLOR_ATTACHMENT_RGBA32F,n.a.BLEND_EQUATION_MINMAX,n.a.FLOAT_BLEND,n.a.TEXTURE_FLOAT];class S{static getAggregationData({aggregationData:t,maxData:e,minData:i,maxMinData:n,pixelIndex:o}){const s=4*o,r={};return t&&(r.cellCount=t[s+3],r.cellWeight=t[s]),n?(r.maxCellWieght=n[0],r.minCellWeight=n[3]):(e&&(r.maxCellWieght=e[0],r.totalCount=e[3]),i&&(r.minCellWeight=i[0],r.totalCount=e[3])),r}static getCellData({countsData:t,size:e=1}){const i=t.length/4,n=new Float32Array(i*e),o=new Uint32Array(i);for(let s=0;s<i;s++){for(let i=0;i<e;i++)n[s*e+i]=t[4*s+i];o[s]=t[4*s+3]}return{cellCounts:o,cellWeights:n}}static isSupported(t){return Object(o.c)(t,C)}constructor(t,e={}){this.id=e.id||"gpu-grid-aggregator",this.gl=t,this.state={weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(s.i)(t)&&Object(o.c)(this.gl,n.a.BLEND_EQUATION_MINMAX,n.a.COLOR_ATTACHMENT_RGBA32F,n.a.TEXTURE_FLOAT),this._hasGPUSupport&&this._setupModels()}delete(){const{gridAggregationModel:t,allAggregationModel:e,meanTransform:i}=this,{textures:n,framebuffers:o,maxMinFramebuffers:s,minFramebuffers:r,maxFramebuffers:a,meanTextures:l,resources:c}=this.state;null==t||t.delete(),null==e||e.delete(),null==i||i.delete(),function(t){(t=Array.isArray(t)?t:[t]).forEach(t=>{for(const e in t)t[e].delete()})}([o,n,s,r,a,l,c])}run(t={}){this.setState({results:{}});const e=this._normalizeAggregationParams(t);return this._hasGPUSupport||u.a.log(1,"GPUGridAggregator: not supported")(),this._runAggregation(e)}getData(t){const e={},i=this.state.results;i[t].aggregationData||(i[t].aggregationData=i[t].aggregationBuffer.getData()),e.aggregationData=i[t].aggregationData;for(const n in P){const o=P[n];(i[t][n]||i[t][o])&&(i[t][n]=i[t][n]||i[t][o].getData(),e[n]=i[t][n])}return e}updateShaders(t={}){this.setState({shaderOptions:t,modelDirty:!0})}_normalizeAggregationParams(t){const e={...g,...t},{weights:i}=e;return i&&(e.weights=function(t){const e={};for(const i in t)e[i]={...x,...t[i]};return e}(i)),e}setState(t){Object.assign(this.state,t)}_getAggregateData(t){const e={},{textures:i,framebuffers:n,maxMinFramebuffers:o,minFramebuffers:s,maxFramebuffers:a,resources:l}=this.state,{weights:c}=t;for(const t in c){e[t]={};const{needMin:u,needMax:h,combineMaxMin:d}=c[t];e[t].aggregationTexture=i[t],e[t].aggregationBuffer=Object(r.d)(n[t],{target:c[t].aggregationBuffer,sourceType:5126}),u&&h&&d?(e[t].maxMinBuffer=Object(r.d)(o[t],{target:c[t].maxMinBuffer,sourceType:5126}),e[t].maxMinTexture=l["".concat(t,"-maxMinTexture")]):(u&&(e[t].minBuffer=Object(r.d)(s[t],{target:c[t].minBuffer,sourceType:5126}),e[t].minTexture=l["".concat(t,"-minTexture")]),h&&(e[t].maxBuffer=Object(r.d)(a[t],{target:c[t].maxBuffer,sourceType:5126}),e[t].maxTexture=l["".concat(t,"-maxTexture")]))}return this._trackGPUResultBuffers(e,c),e}_renderAggregateData(t){const{cellSize:e,projectPoints:i,attributes:n,moduleSettings:o,numCol:s,numRow:r,weights:a,translation:l,scaling:c}=t,{maxMinFramebuffers:u,minFramebuffers:h,maxFramebuffers:d}=this.state,p=[s,r],g={blend:!0,depthTest:!1,blendFunc:[1,1]},y={cellSize:e,gridSize:p,projectPoints:i,translation:l,scaling:c};for(const t in a){const{needMin:e,needMax:i}=a[t],s=e&&i&&a[t].combineMaxMin;this._renderToWeightsTexture({id:t,parameters:g,moduleSettings:o,uniforms:y,gridSize:p,attributes:n,weights:a}),s?this._renderToMaxMinTexture({id:t,parameters:{...g,blendEquation:v},gridSize:p,minOrMaxFb:u[t],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:s}):(e&&this._renderToMaxMinTexture({id:t,parameters:{...g,blendEquation:f},gridSize:p,minOrMaxFb:h[t],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:s}),i&&this._renderToMaxMinTexture({id:t,parameters:{...g,blendEquation:m},gridSize:p,minOrMaxFb:d[t],clearParams:{clearColor:[0,0,0,0]},combineMaxMin:s}))}}_renderToMaxMinTexture(t){const{id:e,parameters:i,gridSize:n,minOrMaxFb:o,combineMaxMin:r,clearParams:a={}}=t,{framebuffers:l}=this.state,{gl:c,allAggregationModel:u}=this;Object(s.n)(c,{...a,framebuffer:o,viewport:[0,0,n[0],n[1]]},()=>{c.clear(16384),u.draw({parameters:i,uniforms:{uSampler:l[e].texture,gridSize:n,combineMaxMin:r}})})}_renderToWeightsTexture(t){const{id:e,parameters:i,moduleSettings:n,uniforms:o,gridSize:r,weights:a}=t,{framebuffers:c,equations:u,weightAttributes:h}=this.state,{gl:d,gridAggregationModel:g}=this,{operation:f}=a[e],m=f===p.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];if(Object(s.n)(d,{framebuffer:c[e],viewport:[0,0,r[0],r[1]],clearColor:m},()=>{d.clear(16384);const t={weights:h[e]};g.draw({parameters:{...i,blendEquation:u[e]},moduleSettings:n,uniforms:o,attributes:t})}),f===p.a.MEAN){const{meanTextures:t,textures:i}=this.state,n={_sourceTextures:{aggregationValues:t[e]},_targetTexture:i[e],elementCount:i[e].width*i[e].height};this.meanTransform?this.meanTransform.update(n):this.meanTransform=function(t,e){return new l.a(t,{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n  gl_PointSize = 1.0;\n}\n",_targetTextureVarying:"meanValues",...e})}(d,n),this.meanTransform.run({parameters:{blend:!1,depthTest:!1}}),c[e].attach({36064:i[e]})}}_runAggregation(t){this._updateModels(t),this._setupFramebuffers(t),this._renderAggregateData(t);const e=this._getAggregateData(t);return this.setState({results:e}),e}_setupFramebuffers(t){const{textures:e,framebuffers:i,maxMinFramebuffers:n,minFramebuffers:o,maxFramebuffers:s,meanTextures:r,equations:a}=this.state,{weights:l}=t,{numCol:c,numRow:u}=t,h={width:c,height:u};for(const t in l){const{needMin:d,needMax:g,combineMaxMin:f,operation:m}=l[t];e[t]=l[t].aggregationTexture||e[t]||Object(_.a)(this.gl,{id:"".concat(t,"-texture"),width:c,height:u}),e[t].resize(h);let v=e[t];m===p.a.MEAN&&(r[t]=r[t]||Object(_.a)(this.gl,{id:"".concat(t,"-mean-texture"),width:c,height:u}),r[t].resize(h),v=r[t]),i[t]?i[t].attach({36064:v}):i[t]=Object(_.b)(this.gl,{id:"".concat(t,"-fb"),width:c,height:u,texture:v}),i[t].resize(h),a[t]=y[m]||y.SUM,(d||g)&&(d&&g&&f?n[t]||(v=l[t].maxMinTexture||this._getMinMaxTexture("".concat(t,"-maxMinTexture")),n[t]=Object(_.b)(this.gl,{id:"".concat(t,"-maxMinFb"),texture:v})):(d&&(o[t]||(v=l[t].minTexture||this._getMinMaxTexture("".concat(t,"-minTexture")),o[t]=Object(_.b)(this.gl,{id:"".concat(t,"-minFb"),texture:v}))),g&&(s[t]||(v=l[t].maxTexture||this._getMinMaxTexture("".concat(t,"-maxTexture")),s[t]=Object(_.b)(this.gl,{id:"".concat(t,"-maxFb"),texture:v})))))}}_getMinMaxTexture(t){const{resources:e}=this.state;return e[t]||(e[t]=Object(_.a)(this.gl,{id:"resourceName"})),e[t]}_setupModels({numCol:t=0,numRow:e=0}={}){var i;const{gl:n}=this,{shaderOptions:o}=this.state;if(null===(i=this.gridAggregationModel)||void 0===i||i.delete(),this.gridAggregationModel=function(t,e){const i=Object(h.a)({vs:"#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute vec3 weights;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform bool projectPoints;\nuniform vec2 translation;\nuniform vec3 scaling;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result;\n  pos.xy = pos.xy/pos.w;\n  result = pos + vec4(translation, 0., 0.);\n  result.xy = scaling.z > 0. ? result.xy * scaling.xy : result.xy;\n  return result.xy;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(positions, positions64Low, vec3(0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n\n  vec2 pixelXY64[2];\n  pixelXY64[0] = vec2(pos.x, 0.);\n  pixelXY64[1] = vec2(pos.y, 0.);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n",fs:"#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[c.a,d.a]},e);return new a.a(t,{id:"Gird-Aggregation-Model",vertexCount:1,drawMode:0,...i})}(n,o),!this.allAggregationModel){const i=t*e;this.allAggregationModel=function(t,e){return new a.a(t,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:[c.a],vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:e,attributes:{position:[0,0]}})}(n,i)}}_setupWeightAttributes(t){const{weightAttributes:e}=this.state,{weights:i}=t;for(const n in i)e[n]=t.attributes[n]}_trackGPUResultBuffers(t,e){const{resources:i}=this.state;for(const n in t)if(t[n])for(const o of b)if(t[n][o]&&e[n][o]!==t[n][o]){const e="gpu-result-".concat(n,"-").concat(o);i[e]&&i[e].delete(),i[e]=t[n][o]}}_updateModels(t){const{vertexCount:e,attributes:i,numCol:n,numRow:o}=t,{modelDirty:s}=this.state;s&&(this._setupModels(t),this.setState({modelDirty:!1})),this._setupWeightAttributes(t),this.gridAggregationModel.setVertexCount(e),this.gridAggregationModel.setAttributes(i),this.allAggregationModel.setInstanceCount(n*o)}}},4673:function(t,e,i){"use strict";i.d(e,"c",(function(){return p})),i.d(e,"b",(function(){return g})),i.d(e,"a",(function(){return f})),i.d(e,"d",(function(){return m}));var n=i(4653);function o(t,e,i){const n=i;return n.domain=()=>t,n.range=()=>e,n}function s(t,e){return o(t,e,i=>function(t,e,i){const o=t[1]-t[0];if(o<=0)return n.a.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];const s=o/e.length,r=Math.floor((i-t[0])/s),a=Math.max(Math.min(r,e.length-1),0);return e[a]}(t,e,i))}function r(t,e){return o(t,e,i=>function(t,e,i){return(i-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]}(t,e,i))}function a(t,e){const i=t.sort(l);let n=0;const s=Math.max(1,e.length),r=new Array(s-1);for(;++n<s;)r[n-1]=c(i,n/s);const a=t=>function(t,e,i){return e[function(t,e){let i=0,n=t.length;for(;i<n;){const o=i+n>>>1;l(t[o],e)>0?n=o:i=o+1}return i}(t,i)]}(r,e,t);return a.thresholds=()=>r,o(t,e,a)}function l(t,e){return t-e}function c(t,e){const i=t.length;if(e<=0||i<2)return t[0];if(e>=1)return t[i-1];const n=(i-1)*e,o=Math.floor(n),s=t[o];return s+(t[o+1]-s)*(n-o)}function u(t,e){const i=new Map,n=[];for(const e of t){const t="".concat(e);i.has(t)||i.set(t,n.push(e))}return o(t,e,t=>function(t,e,i,n){const o="".concat(n);let s=e.get(o);return void 0===s&&(s=t.push(n),e.set(o,s)),i[(s-1)%i.length]}(n,i,e,t))}function h(t){return null!=t}function d(t,e){return("function"==typeof e?t.map(e):t).filter(h)}function p(t,e){return d(t,e)}function g(t,e){return function(t){const e=[];return t.forEach(t=>{!e.includes(t)&&h(t)&&e.push(t)}),e}(d(t,e))}function f(t,e,i){return Math.max(e,Math.min(i,t))}function m(t){switch(t){case"quantize":return s;case"linear":return r;case"quantile":return a;case"ordinal":return u;default:return s}}},4674:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n=i(4723),o=i(4875),s=i(4993),r=i(4636);function a(t,e){const i={};for(const n in t)e.includes(n)||(i[n]=t[n]);return i}class l extends n.a{initializeState(t){super.initializeState(),this.setState({ignoreProps:a(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:e}=t;if(e.extensionsChanged){const t=this.getShaders({});t&&t.defines&&(t.defines.NON_INSTANCED_MODEL=1),this.updateShaders(t)}this._updateAttributes(t.props)}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getShaderAttributes()}getModuleSettings(){const{viewport:t,mousePosition:e,gl:i}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:e,pickingActive:0,devicePixelRatio:Object(r.e)(i)})}updateShaders(t){}isAggregationDirty(t,e={}){const{props:i,oldProps:n,changeFlags:s}=t,{compareAll:r=!1,dimension:a}=e,{ignoreProps:l}=this.state,{props:c,accessors:u=[]}=a,{updateTriggersChanged:h}=s;if(s.dataChanged)return!0;if(h){if(h.all)return!0;for(const t of u)if(h[t])return!0}if(r)return!!s.extensionsChanged||Object(o.a)({oldProps:n,newProps:i,ignoreProps:l,propTypes:this.constructor._propTypes});for(const t of c)if(i[t]!==n[t])return!0;return!1}isAttributeChanged(t){const{changedAttributes:e}=this.state;return t?e&&void 0!==e[t]:!function(t){let e=!0;for(const i in t){e=!1;break}return e}(e)}_getAttributeManager(){return new s.a(this.context.gl,{id:this.props.id,stats:this.context.stats})}}l.layerName="AggregationLayer"},4679:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i(4692),o=i(4695);function s(t,e){const i=function(t,e){const{data:i=[],cellSize:s}=t,{attributes:r,viewport:a,projectPoints:l,numInstances:c}=e,u=r.positions.value,{size:h}=r.positions.getAccessor(),d=e.boundingBox||function(t,e){const i=t.value,{size:n}=t.getAccessor();let o,s,r=1/0,a=-1/0,l=1/0,c=-1/0;for(let t=0;t<e;t++)s=i[t*n],o=i[t*n+1],Number.isFinite(s)&&Number.isFinite(o)&&(r=o<r?o:r,a=o>a?o:a,l=s<l?s:l,c=s>c?s:c);return{xMin:l,xMax:c,yMin:r,yMax:a}}(r.positions,c),p=e.posOffset||[180,90],g=e.gridOffset||Object(o.b)(d,s);if(g.xOffset<=0||g.yOffset<=0)return{gridHash:{},gridOffset:g};const{width:f,height:m}=a,v=Math.ceil(f/g.xOffset),y=Math.ceil(m/g.yOffset),x={},{iterable:_,objectInfo:b}=Object(n.a)(i),P=new Array(3);for(const t of _){b.index++,P[0]=u[b.index*h],P[1]=u[b.index*h+1],P[2]=h>=3?u[b.index*h+2]:0;const[e,i]=l?a.project(P):P;if(Number.isFinite(e)&&Number.isFinite(i)){const n=Math.floor((i+p[1])/g.yOffset),o=Math.floor((e+p[0])/g.xOffset);if(!l||o>=0&&o<v&&n>=0&&n<y){const e="".concat(n,"-").concat(o);x[e]=x[e]||{count:0,points:[],lonIdx:o,latIdx:n},x[e].count+=1,x[e].points.push({source:t,index:b.index})}}}return{gridHash:x,gridOffset:g,offsets:[-1*p[0],-1*p[1]]}}(t,e),s=function({gridHash:t,gridOffset:e,offsets:i}){const n=new Array(Object.keys(t).length);let o=0;for(const s in t){const r=s.split("-"),a=parseInt(r[0],10),l=parseInt(r[1],10),c=o++;n[c]={index:c,position:[i[0]+e.xOffset*l,i[1]+e.yOffset*a],...t[s]}}return n}(i);return{gridHash:i.gridHash,gridOffset:i.gridOffset,data:s}}},4680:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(4673);const o=t=>t.length,s=t=>t.points,r=t=>t.index,a=(t,e)=>t<e?-1:t>e?1:t>=e?0:NaN,l={getValue:o,getPoints:s,getIndex:r,filterData:null};class c{constructor(t=[],e=l){this.aggregatedBins=this.getAggregatedBins(t,e),this._updateMinMaxValues(),this.binMap=this.getBinMap()}getAggregatedBins(t,e){const{getValue:i=o,getPoints:n=s,getIndex:a=r,filterData:l}=e,c="function"==typeof l,u=t.length,h=[];let d=0;for(let e=0;e<u;e++){const o=t[e],s=n(o),r=a(o),u=c?s.filter(l):s;o.filteredPoints=c?u:null;const p=u.length?i(u):null;null!=p&&(h[d]={i:Number.isFinite(r)?r:e,value:p,counts:u.length},d++)}return h}_percentileToIndex(t){const e=this.sortedBins.length;if(e<2)return[0,0];const[i,o]=t.map(t=>Object(n.a)(t,0,100));return[Math.ceil(i/100*(e-1)),Math.floor(o/100*(e-1))]}getBinMap(){const t={};for(const e of this.aggregatedBins)t[e.i]=e;return t}_updateMinMaxValues(){let t=0,e=0,i=3402823466e29,n=0;for(const o of this.aggregatedBins)t=t>o.counts?t:o.counts,e=e>o.value?e:o.value,i=i<o.value?i:o.value,n+=o.counts;this.maxCount=t,this.maxValue=e,this.minValue=i,this.totalCount=n}getValueRange(t){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>a(t.value,e.value))),!this.sortedBins.length)return[];let e=0,i=this.sortedBins.length-1;if(Array.isArray(t)){const n=this._percentileToIndex(t);e=n[0],i=n[1]}return[this.sortedBins[e].value,this.sortedBins[i].value]}getValueDomainByScale(t,[e=0,i=100]=[]){if(this.sortedBins||(this.sortedBins=this.aggregatedBins.sort((t,e)=>a(t.value,e.value))),!this.sortedBins.length)return[];const n=this._percentileToIndex([e,i]);return this._getScaleDomain(t,n)}_getScaleDomain(t,[e,i]){const o=this.sortedBins;switch(t){case"quantize":case"linear":return[o[e].value,o[i].value];case"quantile":return Object(n.c)(o.slice(e,i+1),t=>t.value);case"ordinal":return Object(n.b)(o,t=>t.value);default:return[o[e].value,o[i].value]}}}},4693:function(t,e,i){"use strict";i.d(e,"b",(function(){return h})),i.d(e,"a",(function(){return d}));var n=i(4724),o=i.n(n),s=i(4645);const r=s.a.CLOCKWISE,a=s.a.COUNTER_CLOCKWISE,l={isClosed:!0};function c(t,e,i,n,o){let r=e;const a=i.length;for(let e=0;e<a;e++)for(let o=0;o<n;o++)t[r++]=i[e][o]||0;if(!function(t){const e=t[0],i=t[t.length-1];return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}(i))for(let e=0;e<n;e++)t[r++]=i[0][e]||0;return l.start=e,l.end=r,l.size=n,Object(s.f)(t,o,l),r}function u(t,e,i,n,o=0,r,a){const c=(r=r||i.length)-o;if(c<=0)return e;let u=e;for(let e=0;e<c;e++)t[u++]=i[o+e];if(!function(t,e,i,n){for(let o=0;o<e;o++)if(t[i+o]!==t[n-e+o])return!1;return!0}(i,n,o,r))for(let e=0;e<n;e++)t[u++]=i[o+e];return l.start=e,l.end=u,l.size=n,Object(s.f)(t,a,l),u}function h(t,e){!function(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}(t);const i=[],n=[];if(t.positions){const{positions:o,holeIndices:s}=t;if(s){let t=0;for(let l=0;l<=s.length;l++)t=u(i,t,o,e,s[l-1],s[l],0===l?r:a),n.push(t);return n.pop(),{positions:i,holeIndices:n}}t=o}if(Number.isFinite(t[0]))return u(i,0,t,e,0,i.length,r),i;if(!function(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}(t)){let o=0;for(const[s,l]of t.entries())o=c(i,o,l,e,0===s?r:a),n.push(o);return n.pop(),{positions:i,holeIndices:n}}return c(i,0,t,e,r),i}function d(t,e,i){let n=null;t.holeIndices&&(n=t.holeIndices.map(t=>t/e));let s=t.positions||t;if(i){const t=s.length;s=s.slice();const n=[];for(let o=0;o<t;o+=e){n[0]=s[o],n[1]=s[o+1];const t=i(n);s[o]=t[0],s[o+1]=t[1]}}return o()(s,n,e)}},4694:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return l}));var n=i(4772),o=i(4636),s=i(4721);const r={10240:9728,10241:9728};function a(t,e={}){const{width:i=1,height:s=1,data:a=null,unpackFlipY:l=!0,parameters:c=r}=e;return new n.a(t,{data:a,format:Object(o.i)(t)?34836:6408,type:5126,border:0,mipmaps:!1,parameters:c,dataFormat:6408,width:i,height:s,unpackFlipY:l})}function l(t,e){const{id:i,width:n=1,height:o=1,texture:r}=e;return new s.a(t,{id:i,width:n,height:o,attachments:{36064:r}})}},4695:function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return l})),i.d(e,"c",(function(){return c}));var n=i(4690),o=i(4653);function s(t){return Number.isFinite(t)?t:0}function r(t,e){const i=t.positions.value;let n,o,r=1/0,a=-1/0,l=1/0,c=-1/0;for(let t=0;t<e;t++)o=i[3*t],n=i[3*t+1],r=n<r?n:r,a=n>a?n:a,l=o<l?o:l,c=o>c?o:c;return{xMin:s(l),xMax:s(c),yMin:s(r),yMax:s(a)}}function a(t,e){const i=t<0?-1:1;let n=i<0?Math.abs(t)+e:Math.abs(t);return n=Math.floor(n/e)*e,n*i}function l(t,e,i=!0){if(!i)return{xOffset:e,yOffset:e};const{yMin:n,yMax:o}=t;return function(t,e){const i=(r=t,r/6378e3*(180/Math.PI)),n=(o=e,s=t,s/6378e3*(180/Math.PI)/Math.cos(o*Math.PI/180));var o,s;var r;return{yOffset:i,xOffset:n}}(e,(n+o)/2)}function c(t,e,i,s){const r=l(t,e,s!==n.a.CARTESIAN),c=function(t,e,i,s){const{width:r,height:l}=s,c=i===n.a.CARTESIAN?[-r/2,-l/2]:[-180,-90];o.a.assert(i===n.a.CARTESIAN||i===n.a.LNGLAT||i===n.a.DEFAULT);const{xMin:u,yMin:h}=t;return[-1*(a(u-c[0],e.xOffset)+c[0]),-1*(a(h-c[1],e.yOffset)+c[1])]}(t,r,s,i),{xMin:u,yMin:h,xMax:d,yMax:p}=t,g=d-u+r.xOffset,f=p-h+r.yOffset;return{gridOffset:r,translation:c,width:g,height:f,numCol:Math.ceil(g/r.xOffset),numRow:Math.ceil(f/r.yOffset)}}},4698:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var n=i(4717),o=i(4802),s=i(4837),r=i(4653),a=i(4992),l=i(4803),c=i(4757),u=i(4645);class h extends c.a{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):()=>null}normalizeGeometry(t){return this.normalize?function(t,e,i,n){let o=t;if(Array.isArray(t[0])){const i=t.length*e;o=new Array(i);for(let i=0;i<t.length;i++)for(let n=0;n<e;n++)o[i*e+n]=t[i][n]||0}return i?Object(u.d)(o,{size:e,gridResolution:i}):n?Object(u.e)(o,{size:e}):o}(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}get(t){return this.attributes[t]}getGeometrySize(t){if(Array.isArray(t[0])){let e=0;for(const i of t)e+=this.getGeometrySize(i);return e}const e=this.getPathLength(t);return e<2?0:this.isClosed(t)?e<3?0:e+2:e}updateGeometryAttributes(t,e){if(0!==e.geometrySize)if(t&&Array.isArray(t[0]))for(const i of t){const t=this.getGeometrySize(i);e.geometrySize=t,this.updateGeometryAttributes(i,e),e.vertexStart+=t}else this._updateSegmentTypes(t,e),this._updatePositions(t,e)}_updateSegmentTypes(t,e){const{segmentTypes:i}=this.attributes,n=this.isClosed(t),{vertexStart:o,geometrySize:s}=e;i.fill(0,o,o+s),n?(i[o]=4,i[o+s-2]=4):(i[o]+=1,i[o+s-2]+=2),i[o+s-1]=4}_updatePositions(t,e){const{positions:i}=this.attributes;if(!i)return;const{vertexStart:n,geometrySize:o}=e,s=new Array(3);for(let e=n,r=0;r<o;e++,r++)this.getPointOnPath(t,r,s),i[3*e]=s[0],i[3*e+1]=s[1],i[3*e+2]=s[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,e,i=[]){const{positionSize:n}=this;e*n>=t.length&&(e+=1-t.length/n);const o=e*n;return i[0]=t[o],i[1]=t[o+1],i[2]=3===n&&t[o+2]||0,i}isClosed(t){if(!this.normalize)return this.opts.loop;const{positionSize:e}=this,i=t.length-e;return t[0]===t[i]&&t[1]===t[i+1]&&(2===e||t[2]===t[i+2])}}const d=[0,0,0,255],p={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:d},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},g={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class f extends n.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute float instanceTypes;\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec3 instanceLeftPositions64Low;\nattribute vec3 instanceStartPositions64Low;\nattribute vec3 instanceEndPositions64Low;\nattribute vec3 instanceRightPositions64Low;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  vec2 width\n) {\n  bool isEnd = positions.x > 0.0;\n  float sideOfPath = positions.y;\n  float isJoint = float(sideOfPath == 0.0);\n\n  vec3 deltaA3 = (currPoint - prevPoint);\n  vec3 deltaB3 = (nextPoint - currPoint);\n\n  mat3 rotationMatrix;\n  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\n  if (needsRotation) {\n    deltaA3 = deltaA3 * rotationMatrix;\n    deltaB3 = deltaB3 * rotationMatrix;\n  }\n  vec2 deltaA = deltaA3.xy / width;\n  vec2 deltaB = deltaB3.xy / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = dirA + dirB;\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 dir = isEnd ? dirA : dirB;\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\n  float cornerPosition = sideOfPath * turnDirection;\n\n  float miterSize = 1.0 / max(sinHalfA, EPSILON);\n  miterSize = mix(\n    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\n    miterSize,\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n    * (sideOfPath + isJoint * turnDirection);\n  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\n  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\n  bool isCap = isStartCap || isEndCap;\n  if (isCap) {\n    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\n    vJointType = capType;\n  } else {\n    vJointType = jointType;\n  }\n  vPathLength = L;\n  vCornerOffset = offsetVec;\n  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);\n  vMiterLength = isCap ? isJoint : vMiterLength;\n\n  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\n  vPathPosition = vec2(\n    dot(offsetFromStartOfPath, perp),\n    dot(offsetFromStartOfPath, dir)\n  );\n  geometry.uv = vPathPosition;\n\n  float isValid = step(instanceTypes, 3.5);\n  vec3 offset = vec3(offsetVec * width * isValid, 0.0);\n\n  if (needsRotation) {\n    offset = rotationMatrix * offset;\n  }\n  return currPoint + offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  geometry.worldPosition = instanceStartPositions;\n  geometry.worldPositionAlt = instanceEndPositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n  vec3 width;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    width = vec3(widthPixels, 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w,\n      project_pixel_size_to_clipspace(width.xy)\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64Low);\n    currPosition = project_position(currPosition, currPosition64Low);\n    nextPosition = project_position(nextPosition, nextPosition64Low);\n\n    width = vec3(project_pixel_size(widthPixels), 0.0);\n    DECKGL_FILTER_SIZE(width, geometry);\n\n    vec4 pos = vec4(\n      lineJoin(prevPosition, currPosition, nextPosition, width.xy),\n      1.0);\n    geometry.position = pos;\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float miterLimit;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nvarying float vJointType;\n\nvoid main(void) {\n  geometry.uv = vPathPosition;\n\n  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\n    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\n      discard;\n    }\n    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\n      discard;\n    }\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[o.a,s.a]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:g,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:g,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:g,defaultValue:d},instancePickingColors:{size:3,type:5121,accessor:(t,{index:e,target:i})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,i)}}),this.setState({pathTesselator:new h({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&r.a.removed("getDashArray","PathStyleExtension")()}updateState({oldProps:t,props:e,changeFlags:i}){super.updateState({props:e,oldProps:t,changeFlags:i});const n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:t}=this.state,o=e.data.attributes||{};t.updateGeometry({data:e.data,geometryBuffer:o.getPath,buffers:o,normalize:!e._pathType,loop:"loop"===e._pathType,getGeometry:e.getPath,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),i.dataChanged||n.invalidateAll()}if(i.extensionsChanged){var o;const{gl:t}=this.context;null===(o=this.state.model)||void 0===o||o.delete(),this.state.model=this._getModel(t),n.invalidateAll()}}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i}=e,{data:n}=this.props;return n[0]&&n[0].__source&&(e.object=n.find(t=>t.__source.index===i)),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let i=0;i<e.length;i++)e[i].__source.index===t&&this._disablePickingIndex(i);else this._disablePickingIndex(t)}draw({uniforms:t}){const{viewport:e}=this.context,{jointRounded:i,capRounded:n,billboard:o,miterLimit:s,widthUnits:r,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u="pixels"===r?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({jointType:Number(i),capType:Number(n),billboard:o,widthScale:a*u,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(t){return new a.a(t,{...this.getShaders(),id:this.props.id,geometry:new l.a({drawMode:4,attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateSegmentTypes(t){const{pathTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("segmentTypes")}}f.layerName="PathLayer",f.defaultProps=p},4712:function(t,e,i){"use strict";function n({data:t,getIndex:e,dataRange:i,replace:n}){const{startRow:o=0,endRow:s=1/0}=i,r=t.length;let a=r,l=r;for(let i=0;i<r;i++){const n=e(t[i]);if(a>i&&n>=o&&(a=i),n>=s){l=i;break}}let c=a;const u=l-a!==n.length,h=u&&t.slice(l);for(let e=0;e<n.length;e++)t[c++]=n[e];if(u){for(let e=0;e<h.length;e++)t[c++]=h[e];t.length=c}return{startRow:a,endRow:a+n.length}}i.d(e,"a",(function(){return n}))},4713:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(4674),o=i(4670),s=i(4689),r=i(4653),a=i(4680),l=i(4679);class c extends n.a{initializeState({dimensions:t}){const{gl:e}=this.context;super.initializeState(t),this.setState({layerData:{},gpuGridAggregator:new o.a(e,{id:"".concat(this.id,"-gpu-aggregator")}),cpuGridAggregator:l.a})}updateState(t){super.updateState(t),this.updateAggregationState(t);const{aggregationDataDirty:e,aggregationWeightsDirty:i,gpuAggregation:n}=this.state;if(this.getNumInstances()<=0)return;let o=!1;(e||n&&i)&&(this._updateAggregation(t),o=!0),n||!e&&!i||(this._updateWeightBins(),this._uploadAggregationResults(),o=!0),this.setState({aggregationDirty:o})}finalizeState(){var t;const{count:e}=this.state.weights;e&&e.aggregationBuffer&&e.aggregationBuffer.delete(),null===(t=this.state.gpuGridAggregator)||void 0===t||t.delete(),super.finalizeState()}updateShaders(t){this.state.gpuAggregation&&this.state.gpuGridAggregator.updateShaders(t)}updateAggregationState(t){r.a.assert(!1)}allocateResources(t,e){if(this.state.numRow!==t||this.state.numCol!==e){const i=e*t*4*4,n=this.context.gl,{weights:o}=this.state;for(const t in o){const e=o[t];e.aggregationBuffer&&e.aggregationBuffer.delete(),e.aggregationBuffer=new s.a(n,{byteLength:i,accessor:{size:4,type:5126,divisor:1}})}}}updateResults({aggregationData:t,maxMinData:e,maxData:i,minData:n}){const{count:o}=this.state.weights;o&&(o.aggregationData=t,o.maxMinData=e,o.maxData=i,o.minData=n)}_updateAggregation(t){const{cpuGridAggregator:e,gpuGridAggregator:i,gridOffset:n,posOffset:o,translation:s=[0,0],scaling:r=[0,0,0],boundingBox:a,projectPoints:l,gpuAggregation:c,numCol:u,numRow:h}=this.state,{props:d}=t,{viewport:p}=this.context,g=this.getAttributes(),f=this.getNumInstances();if(c){const{weights:t}=this.state;i.run({weights:t,cellSize:[n.xOffset,n.yOffset],numCol:u,numRow:h,translation:s,scaling:r,vertexCount:f,projectPoints:l,attributes:g,moduleSettings:this.getModuleSettings()})}else{const t=e(d,{gridOffset:n,projectPoints:l,attributes:g,viewport:p,posOffset:o,boundingBox:a});this.setState({layerData:t})}}_updateWeightBins(){const{getValue:t}=this.state,e=new a.a(this.state.layerData.data||[],{getValue:t});this.setState({sortedBins:e})}_uploadAggregationResults(){const{numCol:t,numRow:e}=this.state,{data:i}=this.state.layerData,{aggregatedBins:n,minValue:o,maxValue:s,totalCount:r}=this.state.sortedBins,a=new Float32Array(t*e*4).fill(0);for(const e of n){const{lonIdx:n,latIdx:o}=i[e.i],{value:s,counts:r}=e,l=4*(n+o*t);a[l]=s,a[l+4-1]=r}const l=new Float32Array([s,0,0,o]),c=new Float32Array([s,0,0,r]),u=new Float32Array([o,0,0,r]);this.updateResults({aggregationData:a,maxMinData:l,maxData:c,minData:u})}}c.layerName="GridAggregationLayer"},4714:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i(4680),o=i(4673),s=i(4652);function r(){}const a=["getBins","getDomain","getScaleFunc"],l=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],c=t=>t.cellSize;class u{constructor(t){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=t.getCellSize||c,this._getAggregator=t.getAggregator,this._addDimension(t.dimensions||l)}static defaultDimensions(){return l}updateState(t,e){const{oldProps:i,props:n,changeFlags:o}=t;this.updateGetValueFuncs(i,n,o);const s=this.needsReProjectPoints(i,n,o);let r=!1;if(o.dataChanged||s)this.getAggregatedData(n,e),r=!0;else{(this.getDimensionChanges(i,n,o)||[]).forEach(t=>"function"==typeof t&&t()),r=!0}return this.setState({aggregationDirty:r}),this.state}setState(t){this.state={...this.state,...t}}setDimensionState(t,e){this.setState({dimensions:{...this.state.dimensions,[t]:{...this.state.dimensions[t],...e}}})}normalizeResult(t={}){return t.hexagons?{data:t.hexagons,...t}:t.layerData?{data:t.layerData,...t}:t}getAggregatedData(t,e){const i=this._getAggregator(t)(t,e);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(t)}updateGetValueFuncs(t,e,i){for(const n in this.dimensionUpdaters){const{value:o,weight:r,aggregation:a}=this.dimensionUpdaters[n].getBins.triggers;let l=e[o.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[n].getBins,t,e,i)&&(l=l?Object(s.c)(l,{data:e.data}):Object(s.b)(e[a.prop],e[r.prop],{data:e.data})),l&&this.setDimensionState(n,{getValue:l})}}needsReProjectPoints(t,e,i){return this._getCellSize(t)!==this._getCellSize(e)||this._getAggregator(t)!==this._getAggregator(e)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(t){this._addDimension(t)}_addDimension(t=[]){t.forEach(t=>{const{key:e}=t;this.dimensionUpdaters[e]=this.getDimensionUpdaters(t),this.state.dimensions[e]={getValue:null,domain:null,sortedBins:null,scaleFunc:r}})}getDimensionUpdaters({key:t,accessor:e,pickingInfo:i,getBins:n,getDomain:o,getScaleFunc:s,nullValue:r}){return{key:t,accessor:e,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins,...n},getDomain:{updater:this.getDimensionValueDomain,...o},getScaleFunc:{updater:this.getDimensionScale,...s},attributeAccessor:this.getSubLayerDimensionAttribute(t,r)}}needUpdateDimensionStep(t,e,i,n){return Object.values(t.triggers).some(t=>t.updateTrigger?n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged[t.updateTrigger]):e[t.prop]!==i[t.prop])}getDimensionChanges(t,e,i){const n=[];for(const o in this.dimensionUpdaters){const s=a.find(n=>this.needUpdateDimensionStep(this.dimensionUpdaters[o][n],t,e,i));s&&n.push(this.dimensionUpdaters[o][s].updater.bind(this,e,this.dimensionUpdaters[o]))}return n.length?n:null}getUpdateTriggers(t){const e=t.updateTriggers||{},i={};for(const n in this.dimensionUpdaters){const{accessor:o}=this.dimensionUpdaters[n];i[o]={},a.forEach(s=>{Object.values(this.dimensionUpdaters[n][s].triggers).forEach(({prop:n,updateTrigger:s})=>{if(s){const t=e[s];"object"!=typeof t||Array.isArray(t)?void 0!==t&&(i[o][n]=t):Object.assign(i[o],t)}else i[o][n]=t[n]})})}return i}getSortedBins(t){for(const e in this.dimensionUpdaters)this.getDimensionSortedBins(t,this.dimensionUpdaters[e])}getDimensionSortedBins(t,e){const{key:i}=e,{getValue:o}=this.state.dimensions[i],s=new n.a(this.state.layerData.data||[],{getValue:o,filterData:t._filterData});this.setDimensionState(i,{sortedBins:s}),this.getDimensionValueDomain(t,e)}getDimensionValueDomain(t,e){const{getDomain:i,key:n}=e,{triggers:{lowerPercentile:o,upperPercentile:s,scaleType:r}}=i,a=this.state.dimensions[n].sortedBins.getValueDomainByScale(t[r.prop],[t[o.prop],t[s.prop]]);this.setDimensionState(n,{valueDomain:a}),this.getDimensionScale(t,e)}getDimensionScale(t,e){const{key:i,getScaleFunc:n,getDomain:s}=e,{domain:r,range:a}=n.triggers,{scaleType:l}=s.triggers,{onSet:c}=n,u=t[a.prop],h=t[r.prop]||this.state.dimensions[i].valueDomain,d=Object(o.d)(l&&t[l.prop])(h,u);"object"==typeof c&&"function"==typeof t[c.props]&&t[c.props](d.domain()),this.setDimensionState(i,{scaleFunc:d})}getSubLayerDimensionAttribute(t,e){return i=>{const{sortedBins:n,scaleFunc:o}=this.state.dimensions[t],s=n.binMap[i.index];if(s&&0===s.counts)return e;const r=s&&s.value,a=o.domain();return r>=a[0]&&r<=a[a.length-1]?o(r):e}}getSubLayerAccessors(t){const e={};for(const i in this.dimensionUpdaters){const{accessor:n}=this.dimensionUpdaters[i];e[n]=this.getSubLayerDimensionAttribute(t,i)}return e}getPickingInfo({info:t}){let e=null;if(t.picked&&t.index>-1){const i=this.state.layerData.data[t.index],n={};for(const t in this.dimensionUpdaters){const{pickingInfo:e}=this.dimensionUpdaters[t],{sortedBins:o}=this.state.dimensions[t],s=o.binMap[i.index]&&o.binMap[i.index].value;n[e]=s}e=Object.assign(n,i,{points:i.filteredPoints||i.points})}return t.picked=Boolean(e),t.object=e,t}getAccessor(t){return this.dimensionUpdaters.hasOwnProperty(t)?this.dimensionUpdaters[t].attributeAccessor:r}}},4718:function(t,e,i){"use strict";i.d(e,"a",(function(){return P}));var n=i(4717),o=i(4802),s=i(4739),r=i(4837),a=i(4690),l=i(5018),c=i(4867),u=i(4992),h=i(4803),d=i(4693),p=i(4757),g=i(4645);class f extends p.a{constructor(t){const{fp64:e,IndexType:i=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:e?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(t){const{attributes:e}=this;return"indices"===t?e.indices&&e.indices.subarray(0,this.vertexCount):e[t]}updateGeometry(t){super.updateGeometry(t);const e=this.buffers.indices;e&&(this.vertexCount=(e.value||e).length)}normalizeGeometry(t){if(this.normalize){if(t=d.b(t,this.positionSize),this.opts.resolution)return Object(g.b)(t.positions||t,t.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return Object(g.c)(t.positions||t,t.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return t}getGeometrySize(t){if(Array.isArray(t)&&!Number.isFinite(t[0])){let e=0;for(const i of t)e+=this.getGeometrySize(i);return e}return(t.positions||t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):()=>null}updateGeometryAttributes(t,e){if(Array.isArray(t)&&!Number.isFinite(t[0]))for(const i of t){const t=this.getGeometrySize(i);e.geometrySize=t,this.updateGeometryAttributes(i,e),e.vertexStart+=t,e.indexStart=this.indexStarts[e.geometryIndex+1]}else this._updateIndices(t,e),this._updatePositions(t,e),this._updateVertexValid(t,e)}_updateIndices(t,{geometryIndex:e,vertexStart:i,indexStart:n}){const{attributes:o,indexStarts:s,typedArrayManager:r}=this;let a=o.indices;if(!a)return;let l=n;const c=d.a(t,this.positionSize,this.opts.preproject);a=r.allocate(a,n+c.length,{copy:!0});for(let t=0;t<c.length;t++)a[l++]=c[t]+i;s[e+1]=n+c.length,o.indices=a}_updatePositions(t,{vertexStart:e,geometrySize:i}){const{attributes:{positions:n},positionSize:o}=this;if(!n)return;const s=t.positions||t;for(let t=e,r=0;r<i;t++,r++){const e=s[r*o],i=s[r*o+1],a=o>2?s[r*o+2]:0;n[3*t]=e,n[3*t+1]=i,n[3*t+2]=a}}_updateVertexValid(t,{vertexStart:e,geometrySize:i}){const{attributes:{vertexValid:n},positionSize:o}=this,s=t&&t.holeIndices;if(t&&t.edgeTypes?n.set(t.edgeTypes,e):n.fill(1,e,e+i),s)for(let t=0;t<s.length;t++)n[e+s[t]/o-1]=0;n[e+i-1]=0}}var m="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec3 positions64Low;\n  vec3 nextPositions64Low;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n#ifdef IS_SIDE_VERTEX\n  if(vertexValid < 0.5){\n    gl_Position = vec4(0.);\n    return;\n  }\n#endif\n\n  vec3 pos;\n  vec3 pos64Low;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n  geometry.worldPosition = props.positions;\n  geometry.worldPositionAlt = props.nextPositions;\n  geometry.pickingColor = props.pickingColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);\n#else\n  pos = props.positions;\n  pos64Low = props.positions64Low;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(\n      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),\n      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),\n      0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n    geometry.normal = normal;\n  }\n\n  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity);\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",v="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 positions64Low;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(m,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64Low = positions64Low;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),y="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec3 nextPositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 nextPositions64Low;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(m,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  #if RING_WINDING_ORDER_CW == 1\n    props.positions = instancePositions;\n    props.positions64Low = instancePositions64Low;\n    props.nextPositions = nextPositions;\n    props.nextPositions64Low = nextPositions64Low;\n  #else\n    props.positions = nextPositions;\n    props.positions64Low = nextPositions64Low;\n    props.nextPositions = instancePositions;\n    props.nextPositions64Low = instancePositions64Low;\n  #endif\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n\n  calculatePosition(props);\n}\n");const x=[0,0,0,255],_={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:x},getLineColor:{type:"accessor",value:x},material:!0},b={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class P extends n.a{getShaders(t){return super.getShaders({vs:"top"===t?v:y,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[o.a,s.a,r.a]})}get wrapLongitude(){return!1}initializeState(){const{gl:t,viewport:e}=this.context;let{coordinateSystem:i}=this.props;e.isGeospatial&&i===a.a.DEFAULT&&(i=a.a.LNGLAT),this.setState({numInstances:0,polygonTesselator:new f({preproject:i===a.a.LNGLAT&&e.projectFlat,fp64:this.use64bitPositions(),IndexType:!t||Object(l.c)(t,c.a.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:b,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:b,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:b,accessor:"getFillColor",defaultValue:x,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:b,accessor:"getLineColor",defaultValue:x,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(t,{index:e,target:i})=>this.encodePickingColor(t&&t.__source?t.__source.index:e,i),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:i}=e,{data:n}=this.props;return n[0]&&n[0].__source&&(e.object=n.find(t=>t.__source.index===i)),e}disablePickingIndex(t){const{data:e}=this.props;if(e[0]&&e[0].__source)for(let i=0;i<e.length;i++)e[i].__source.index===t&&this._disablePickingIndex(i);else this._disablePickingIndex(t)}draw({uniforms:t}){const{extruded:e,filled:i,wireframe:n,elevationScale:o}=this.props,{topModel:s,sideModel:r,polygonTesselator:a}=this.state,l={...t,extruded:Boolean(e),elevationScale:o};r&&(r.setInstanceCount(a.instanceCount-1),r.setUniforms(l),n&&(r.setDrawMode(3),r.setUniforms({isWireframe:!0}).draw()),i&&(r.setDrawMode(6),r.setUniforms({isWireframe:!1}).draw())),s&&(s.setVertexCount(a.vertexCount),s.setUniforms(l).draw())}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:e,oldProps:i,changeFlags:n}=t,o=this.getAttributeManager();var s;(n.extensionsChanged||e.filled!==i.filled||e.extruded!==i.extruded)&&(null===(s=this.state.models)||void 0===s||s.forEach(t=>t.delete()),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}updateGeometry({props:t,oldProps:e,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:e}=this.state,n=t.data.attributes||{};e.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:n.getPolygon,buffers:n,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(t){const{id:e,filled:i,extruded:n}=this.props;let o,s;if(i){const i=this.getShaders("top");i.defines.NON_INSTANCED_MODEL=1,o=new u.a(t,{...i,id:"".concat(e,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return n&&(s=new u.a(t,{...this.getShaders("side"),id:"".concat(e,"-side"),geometry:new h.a({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),s.userData.excludeAttributes={indices:!0}),{models:[s,o].filter(Boolean),topModel:o,sideModel:s}}calculateIndices(t){const{polygonTesselator:e}=this.state;t.startIndices=e.indexStarts,t.value=e.get("indices")}calculatePositions(t){const{polygonTesselator:e}=this.state;t.startIndices=e.vertexStarts,t.value=e.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}P.layerName="SolidPolygonLayer",P.defaultProps=_},4723:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(4717),o=i(4667),s=i(4678);class r extends n.a{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:e}=t;return e&&e.__source&&e.__source.parent&&e.__source.parent.id===this.id?(t.object=e.__source.object,t.index=e.__source.index,t):t}renderLayers(){return null}filterSubLayer(t){return!0}shouldRenderSubLayer(t,e){const{_subLayerProps:i}=this.props;return e&&e.length||i&&i[t]}getSubLayerClass(t,e){const{_subLayerProps:i}=this.props;return i&&i[t]&&i[t].type||e}getSubLayerRow(t,e,i){return t.__source={parent:this,object:e,index:i},t}getSubLayerAccessor(t){if("function"==typeof t){const e={data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(e.index=i.__source.index,t(i.__source.object,e)):t(i,n)}return t}getSubLayerProps(t={}){const{opacity:e,pickable:i,visible:n,parameters:o,getPolygonOffset:s,highlightedObjectIndex:r,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:g,fetch:f,_subLayerProps:m}=this.props,v={opacity:e,pickable:i,visible:n,parameters:o,getPolygonOffset:s,highlightedObjectIndex:r,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:g,fetch:f},y=m&&m[t.id],x=y&&y.updateTriggers,_=t.id||"sublayer";if(y){const e=this.constructor._propTypes,i=t.type?t.type._propTypes:{};for(const t in y){const n=i[t]||e[t];n&&"accessor"===n.type&&(y[t]=this.getSubLayerAccessor(y[t]))}}Object.assign(v,t,y),v.id="".concat(this.props.id,"-").concat(_),v.updateTriggers={all:this.props.updateTriggers.all,...t.updateTriggers,...x};for(const t of g){const e=t.getSubLayerProps.call(this,t);e&&Object.assign(v,e,{updateTriggers:Object.assign(v.updateTriggers,e.updateTriggers)})}return v}_updateAutoHighlight(t){for(const e of this.getSubLayers())e.updateAutoHighlight(t)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:t}=this.internalState;const e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=Object(s.b)(t,Boolean),this.internalState.subLayers=t),Object(o.a)("compositeLayer.renderLayers",this,e,t);for(const e of t)e.parent=this}}r.layerName="CompositeLayer"},4724:function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,a,l,c,u,p,g,m=e&&e.length,v=m?e[0]*i:t.length,y=o(t,0,v,i,!0),x=[];if(!y||y.next===y.prev)return x;if(m&&(y=function(t,e,i,n){var r,a,l,c,u,p=[];for(r=0,a=e.length;r<a;r++)l=e[r]*n,c=r<a-1?e[r+1]*n:t.length,(u=o(t,l,c,n,!1))===u.next&&(u.steiner=!0),p.push(f(u));for(p.sort(h),r=0;r<p.length;r++)d(p[r],i),i=s(i,i.next);return i}(t,e,y,i)),t.length>80*i){n=l=t[0],a=c=t[1];for(var _=i;_<v;_+=i)(u=t[_])<n&&(n=u),(p=t[_+1])<a&&(a=p),u>l&&(l=u),p>c&&(c=p);g=0!==(g=Math.max(l-n,c-a))?1/g:0}return r(y,x,i,n,a,g),x}function o(t,e,i,n,o){var s,r;if(o===E(t,e,i,n)>0)for(s=e;s<i;s+=n)r=w(s,t[s],t[s+1],r);else for(s=i-n;s>=e;s-=n)r=w(s,t[s],t[s+1],r);return r&&x(r,r.next)&&(A(r),r=r.next),r}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!x(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(A(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function r(t,e,i,n,o,h,d){if(t){!d&&h&&function(t,e,i,n){var o=t;do{null===o.z&&(o.z=g(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,i,n,o,s,r,a,l,c=1;do{for(i=t,t=null,s=null,r=0;i;){for(r++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ);e++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(o=i,i=i.nextZ,a--):(o=n,n=n.nextZ,l--),s?s.nextZ=o:t=o,o.prevZ=s,s=o;i=n}s.nextZ=null,c*=2}while(r>1)}(o)}(t,n,o,h);for(var p,f,m=t;t.prev!==t.next;)if(p=t.prev,f=t.next,h?l(t,n,o,h):a(t))e.push(p.i/i),e.push(t.i/i),e.push(f.i/i),A(t),t=f.next,m=f.next;else if((t=f)===m){d?1===d?r(t=c(s(t),e,i),e,i,n,o,h,2):2===d&&u(t,e,i,n,o,h):r(s(t),e,i,n,o,h,1);break}}}function a(t){var e=t.prev,i=t,n=t.next;if(y(e,i,n)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(m(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&y(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function l(t,e,i,n){var o=t.prev,s=t,r=t.next;if(y(o,s,r)>=0)return!1;for(var a=o.x<s.x?o.x<r.x?o.x:r.x:s.x<r.x?s.x:r.x,l=o.y<s.y?o.y<r.y?o.y:r.y:s.y<r.y?s.y:r.y,c=o.x>s.x?o.x>r.x?o.x:r.x:s.x>r.x?s.x:r.x,u=o.y>s.y?o.y>r.y?o.y:r.y:s.y>r.y?s.y:r.y,h=g(a,l,e,i,n),d=g(c,u,e,i,n),p=t.prevZ,f=t.nextZ;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&m(o.x,o.y,s.x,s.y,r.x,r.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&m(o.x,o.y,s.x,s.y,r.x,r.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&m(o.x,o.y,s.x,s.y,r.x,r.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&m(o.x,o.y,s.x,s.y,r.x,r.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(t,e,i){var n=t;do{var o=n.prev,r=n.next.next;!x(o,r)&&_(o,n,n.next,r)&&C(o,r)&&C(r,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(r.i/i),A(n),A(n.next),n=t=r),n=n.next}while(n!==t);return s(n)}function u(t,e,i,n,o,a){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=S(l,c);return l=s(l,l.next),u=s(u,u.next),r(l,e,i,n,o,a),void r(u,e,i,n,o,a)}c=c.next}l=l.next}while(l!==t)}function h(t,e){return t.x-e.x}function d(t,e){if(e=function(t,e){var i,n=e,o=t.x,s=t.y,r=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=o&&a>r){if(r=a,a===o){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(o===r)return i;var l,c=i,u=i.x,h=i.y,d=1/0;n=i;do{o>=n.x&&n.x>=u&&o!==n.x&&m(s<h?o:r,s,u,h,s<h?r:o,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(o-n.x),C(n,t)&&(l<d||l===d&&(n.x>i.x||n.x===i.x&&p(i,n)))&&(i=n,d=l)),n=n.next}while(n!==c);return i}(t,e)){var i=S(e,t);s(e,e.next),s(i,i.next)}}function p(t,e){return y(t.prev,t,e.prev)<0&&y(e.next,t,t.next)<0}function g(t,e,i,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,n,o,s,r,a){return(o-r)*(e-a)-(t-r)*(s-a)>=0&&(t-r)*(n-a)-(i-r)*(e-a)>=0&&(i-r)*(s-a)-(o-r)*(n-a)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&_(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(C(t,e)&&C(e,t)&&function(t,e){var i=t,n=!1,o=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&o<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(y(t.prev,t,e.prev)||y(t,e.prev,e))||x(t,e)&&y(t.prev,t,t.next)>0&&y(e.prev,e,e.next)>0)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function _(t,e,i,n){var o=P(y(t,e,i)),s=P(y(t,e,n)),r=P(y(i,n,t)),a=P(y(i,n,e));return o!==s&&r!==a||(!(0!==o||!b(t,i,e))||(!(0!==s||!b(t,n,e))||(!(0!==r||!b(i,t,n))||!(0!==a||!b(i,e,n)))))}function b(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function P(t){return t>0?1:t<0?-1:0}function C(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function S(t,e){var i=new L(t.i,t.x,t.y),n=new L(e.i,e.x,e.y),o=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function w(t,e,i,n){var o=new L(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function L(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(t,e,i,n){for(var o=0,s=e,r=i-n;s<i;s+=n)o+=(t[r]-t[s])*(t[s+1]+t[r+1]),r=s;return o}t.exports=n,t.exports.default=n,n.deviation=function(t,e,i,n){var o=e&&e.length,s=o?e[0]*i:t.length,r=Math.abs(E(t,0,s,i));if(o)for(var a=0,l=e.length;a<l;a++){var c=e[a]*i,u=a<l-1?e[a+1]*i:t.length;r-=Math.abs(E(t,c,u,i))}var h=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,p=n[a+1]*i,g=n[a+2]*i;h+=Math.abs((t[d]-t[g])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[g+1]-t[d+1]))}return 0===r&&0===h?0:Math.abs((h-r)/r)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var s=0;s<t[o].length;s++)for(var r=0;r<e;r++)i.vertices.push(t[o][s][r]);o>0&&(n+=t[o-1].length,i.holes.push(n))}return i}},4738:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var n=i(4717),o=i(4802),s=i(4739),r=i(4837),a=i(4992),l=i(4653),c=i(4803),u=i(5015),h=i(4645);class d extends c.a{constructor(t={}){const{id:e=Object(u.c)("column-geometry")}=t,{indices:i,attributes:n}=function(t){const{radius:e,height:i=1,nradial:n=10}=t;let{vertices:o}=t;o&&(l.a.assert(o.length>=n),o=o.flatMap(t=>[t[0],t[1]]),Object(h.f)(o,h.a.COUNTER_CLOCKWISE));const s=i>0,r=n+1,a=s?3*r+1:n,c=2*Math.PI/n,u=new Uint16Array(s?3*n*2:0),d=new Float32Array(3*a),p=new Float32Array(3*a);let g=0;if(s){for(let t=0;t<r;t++){const s=t*c,r=t%n,a=Math.sin(s),l=Math.cos(s);for(let t=0;t<2;t++)d[g+0]=o?o[2*r]:l*e,d[g+1]=o?o[2*r+1]:a*e,d[g+2]=(.5-t)*i,p[g+0]=o?o[2*r]:l,p[g+1]=o?o[2*r+1]:a,g+=3}d[g+0]=d[g-3],d[g+1]=d[g-2],d[g+2]=d[g-1],g+=3}for(let t=s?0:1;t<r;t++){const s=Math.floor(t/2)*Math.sign(.5-t%2),r=s*c,a=(s+n)%n,l=Math.sin(r),u=Math.cos(r);d[g+0]=o?o[2*a]:u*e,d[g+1]=o?o[2*a+1]:l*e,d[g+2]=i/2,p[g+2]=1,g+=3}if(s){let t=0;for(let e=0;e<n;e++)u[t++]=2*e+0,u[t++]=2*e+2,u[t++]=2*e+0,u[t++]=2*e+1,u[t++]=2*e+1,u[t++]=2*e+3}return{indices:u,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:p}}}}(t);super({...t,id:e,indices:i,attributes:n})}}const p=[0,0,0,255],g={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:p},getLineColor:{type:"accessor",value:p},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class f extends n.a{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio -= sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[o.a,s.a,r.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:p},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:p},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState({props:t,oldProps:e,changeFlags:i}){super.updateState({props:t,oldProps:e,changeFlags:i});const n=i.extensionsChanged;if(n){var o;const{gl:t}=this.context;null===(o=this.state.model)||void 0===o||o.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}(n||t.diskResolution!==e.diskResolution||t.vertices!==e.vertices||(t.extruded||t.stroked)!==(e.extruded||e.stroked))&&this._updateGeometry(t)}getGeometry(t,e,i){const n=new d({radius:1,height:i?2:0,vertices:e,nradial:t});let o=0;if(e)for(let i=0;i<t;i++){const n=e[i];o+=Math.sqrt(n[0]*n[0]+n[1]*n[1])/t}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*o}),n}_getModel(t){return new a.a(t,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:t,vertices:e,extruded:i,stroked:n}){const o=this.getGeometry(t,e,i||n);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3,wireframeVertexCount:o.indices.value.length}),this.state.model.setProps({geometry:o})}draw({uniforms:t}){const{viewport:e}=this.context,{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:o,lineWidthMaxPixels:s,elevationScale:r,extruded:a,filled:l,stroked:c,wireframe:u,offset:h,coverage:d,radius:p,angle:g}=this.props,{model:f,fillVertexCount:m,wireframeVertexCount:v,edgeDistance:y}=this.state,x="pixels"===i?e.metersPerPixel:1;f.setUniforms(t).setUniforms({radius:p,angle:g/180*Math.PI,offset:h,extruded:a,coverage:d,elevationScale:r,edgeDistance:y,widthScale:n*x,widthMinPixels:o,widthMaxPixels:s}),a&&u&&(f.setProps({isIndexed:!0}),f.setVertexCount(v).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(f.setProps({isIndexed:!1}),f.setVertexCount(m).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!a&&c&&(f.setProps({isIndexed:!1}),f.setVertexCount(2*m/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}f.layerName="ColumnLayer",f.defaultProps=g},4739:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n";const o={lightSources:{}};function s({color:t=[0,0,0],intensity:e=1}={}){return t.map(t=>t*e/255)}const r={name:"lights",vs:n,fs:n,getUniforms:function t(e=o){if("lightSources"in e){const{ambientLight:t,pointLights:i,directionalLights:n}=e.lightSources||{};return t||i&&i.length>0||n&&n.length>0?Object.assign({},function({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const n={};return n["lighting_uAmbientLight.color"]=t?s(t):[0,0,0],e.forEach((t,e)=>{n["lighting_uPointLight[".concat(e,"].color")]=s(t),n["lighting_uPointLight[".concat(e,"].position")]=t.position,n["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]}),n.lighting_uPointLightCount=e.length,i.forEach((t,e)=>{n["lighting_uDirectionalLight[".concat(e,"].color")]=s(t),n["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction}),n.lighting_uDirectionalLightCount=i.length,n}({ambientLight:t,pointLights:i,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const i={pointLights:[],directionalLights:[]};for(const t of e.lights||[])switch(t.type){case"ambient":i.ambientLight=t;break;case"directional":i.directionalLights.push(t);break;case"point":i.pointLights.push(t)}return t({lightSources:i})}return{}},defines:{MAX_LIGHTS:3}};var a="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";const l={};function c(t=l){if(!("material"in t))return{};const{material:e}=t;return e?function(t){const{ambient:e=.35,diffuse:i=.6,shininess:n=32,specularColor:o=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:n,lighting_uSpecularColor:o.map(t=>t/255)}}(e):{lighting_uEnabled:!1}}const u={name:"gouraud-lighting",dependencies:[r],vs:a,defines:{LIGHTING_VERTEX:1},getUniforms:c}},4740:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i(4717),o=i(4802),s=i(4837),r=i(4992),a=i(4803);const l=[0,0,0,255],c={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:l},getLineColor:{type:"accessor",value:l},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class u extends n.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool billboard;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[o.a,s.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:t,oldProps:e,changeFlags:i}){if(super.updateState({props:t,oldProps:e,changeFlags:i}),i.extensionsChanged){var n;const{gl:t}=this.context;null===(n=this.state.model)||void 0===n||n.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{radiusUnits:i,radiusScale:n,radiusMinPixels:o,radiusMaxPixels:s,stroked:r,filled:a,billboard:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,p="pixels"===i?e.metersPerPixel:1,g="pixels"===c?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({stroked:r?1:0,filled:a,billboard:l,radiusScale:n*p,radiusMinPixels:o,radiusMaxPixels:s,lineWidthScale:u*g,lineWidthMinPixels:h,lineWidthMaxPixels:d}).draw()}_getModel(t){return new r.a(t,{...this.getShaders(),id:this.props.id,geometry:new a.a({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}u.layerName="ScatterplotLayer",u.defaultProps=c},4756:function(t,e,i){"use strict";t.exports=n,t.exports.default=n;function n(t,e,i,n,o,s){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=o||"sans-serif",this.fontWeight=s||"normal",this.radius=i||8;var r=this.size=this.fontSize+2*this.buffer,a=r+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=r,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(r/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function o(t,e,i,n,o,r){for(var a=0;a<e;a++)s(t,a,e,i,n,o,r);for(var l=0;l<i;l++)s(t,l*e,1,e,n,o,r)}function s(t,e,i,n,o,s,r){var a,l,c,u;for(s[0]=0,r[0]=-1e20,r[1]=1e20,a=0;a<n;a++)o[a]=t[e+a*i];for(a=1,l=0,c=0;a<n;a++){do{u=s[l],c=(o[a]-o[u]+a*a-u*u)/(a-u)/2}while(c<=r[l]&&--l>-1);s[++l]=a,r[l]=c,r[l+1]=1e20}for(a=0,l=0;a<n;a++){for(;r[l+1]<a;)l++;u=s[l],t[e+a*i]=o[u]+(a-u)*(a-u)}}n.prototype._draw=function(t,e){var i,n,s,r,a,l,c,u,h,d=this.ctx.measureText(t),p=d.width,g=2*this.buffer;e&&this.useMetrics?(a=Math.floor(d.actualBoundingBoxAscent),u=this.buffer+Math.ceil(d.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(n=Math.min(this.size,Math.ceil(d.actualBoundingBoxRight-d.actualBoundingBoxLeft)))+g,s=(r=Math.min(this.size-l,Math.ceil(d.actualBoundingBoxAscent+d.actualBoundingBoxDescent)))+g,this.ctx.textBaseline="alphabetic"):(i=n=this.size,s=r=this.size,a=19*this.fontSize/24,l=c=0,u=this.middle,this.ctx.textBaseline="middle"),n&&r&&(this.ctx.clearRect(c,l,n,r),this.ctx.fillText(t,this.buffer,u),h=this.ctx.getImageData(c,l,n,r));var f=new Uint8ClampedArray(i*s);return function(t,e,i,n,o,s,r){s.fill(1e20,0,e*i),r.fill(0,0,e*i);for(var a=(e-n)/2,l=0;l<o;l++)for(var c=0;c<n;c++){var u=(l+a)*e+c+a,h=t.data[4*(l*n+c)+3]/255;if(1===h)s[u]=0,r[u]=1e20;else if(0===h)s[u]=1e20,r[u]=0;else{var d=Math.max(0,.5-h),p=Math.max(0,h-.5);s[u]=d*d,r[u]=p*p}}}(h,i,s,n,r,this.gridOuter,this.gridInner),o(this.gridOuter,i,s,this.f,this.v,this.z),o(this.gridInner,i,s,this.f,this.v,this.z),function(t,e,i,n,o,s,r){for(var a=0;a<e*i;a++){var l=Math.sqrt(n[a])-Math.sqrt(o[a]);t[a]=Math.round(255-255*(l/s+r))}}(f,i,s,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:f,metrics:{width:n,height:r,sdfWidth:i,sdfHeight:s,top:a,left:0,advance:p}}},n.prototype.draw=function(t){return this._draw(t,!1).data},n.prototype.drawWithMetrics=function(t){return this._draw(t,!0)}},4757:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i(4692),o=i(4686),s=i(4671),r=i(4689);class a{constructor(t={}){const{attributes:e={}}=t;this.typedArrayManager=o.a,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=e,this.opts=t,this.updateGeometry(t),Object.seal(this)}updateGeometry(t){Object.assign(this.opts,t);const{data:e,buffers:i={},getGeometry:n,geometryBuffer:o,positionFormat:r,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=e,this.getGeometry=n,this.positionSize=o&&o.size||("XY"===r?2:3),this.buffers=i,this.normalize=l,o&&(Object(s.a)(e.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),l||(i.positions=o)),this.geometryBuffer=i.positions,Array.isArray(a))for(const t of a)this._rebuildGeometry(t);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:e}){this._rebuildGeometry({startRow:t,endRow:e})}normalizeGeometry(t){return t}updateGeometryAttributes(t,e,i){throw new Error("Not implemented")}getGeometrySize(t){throw new Error("Not implemented")}getGeometryFromBuffer(t){const e=t.value||t;return Object(s.a)(ArrayBuffer.isView(e)),Object(n.b)(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices})}_allocate(t,e){const{attributes:i,buffers:n,_attributeDefs:o,typedArrayManager:s}=this;for(const r in o)if(r in n)s.release(i[r]),i[r]=null;else{const n=o[r];n.copy=e,i[r]=s.allocate(i[r],t,n)}}_forEachGeometry(t,e,i){const{data:o,getGeometry:s}=this,{iterable:r,objectInfo:a}=Object(n.a)(o,e,i);for(const e of r){a.index++,t(s(e,a),a.index)}}_rebuildGeometry(t){if(!this.data||!this.getGeometry)return;let{indexStarts:e,vertexStarts:i,instanceCount:n}=this;const{data:o,geometryBuffer:s}=this,{startRow:a=0,endRow:l=1/0}=t||{},c={};if(t||(e=[0],i=[0]),this.normalize||!s)this._forEachGeometry((t,e)=>{t=this.normalizeGeometry(t),c[e]=t,i[e+1]=i[e]+this.getGeometrySize(t)},a,l),n=i[i.length-1];else if(s.buffer instanceof r.a){const t=s.stride||4*this.positionSize;i=o.startIndices,n=i[o.length]||s.buffer.byteLength/t}else{const t=s.value||s,e=s.stride/t.BYTES_PER_ELEMENT||this.positionSize;i=o.startIndices,n=i[o.length]||t.length/e}this._allocate(n,Boolean(t)),this.indexStarts=e,this.vertexStarts=i,this.instanceCount=n;const u={};this._forEachGeometry((t,o)=>{t=c[o]||t,u.vertexStart=i[o],u.indexStart=e[o];const s=o<i.length-1?i[o+1]:n;u.geometrySize=s-i[o],u.geometryIndex=o,this.updateGeometryAttributes(t,u)},a,l),this.vertexCount=e[e.length-1]}}},4804:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return d}));var n=i(4698),o=i(0),s=i.n(o),r=i(4650),a=i(4643),l=i(4659),c=i(4651);function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function h(t){return t.object.extraProps&&s.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(t.object.extraProps).map((e,i)=>s.a.createElement(c.a,{key:"prop-"+i,label:e+": ",value:""+t.object.extraProps[e]})))}function d(t,e,i,o){const s=t,l=s.color_picker,c=[l.r,l.g,l.b,255*l.a];let d=e.data.features.map(t=>u({},t,{path:t.path,width:s.line_width,color:c}));if(s.js_data_mutator){d=Object(a.a)(s.js_data_mutator)(d)}return new n.a(u({id:"path-layer-"+s.slice_id,getColor:t=>t.color,getPath:t=>t.path,getWidth:t=>t.width,data:d,rounded:!0,widthScale:1},Object(r.a)(s,o,h)))}e.default=Object(l.b)(d,(function(t){let e=[];return t.forEach(t=>{e=e.concat(t.path)}),e}))},4829:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return Et}));var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(4723),l=i(4653),c=i(4712);var u=i(4717),h=i(4802),d=i(4837),p=i(4992),g=i(4803),f=i(4995),m=i(4997),v=i(4772),y=i(5053),x=i(5048),_=i(4692);const b=()=>{},P={10241:9987,10240:9729,10242:33071,10243:33071};function C(t,e,i,n){return i===e.width&&n===e.height?e:(t.canvas.height=n,t.canvas.width=i,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,i,n),t.canvas)}function S(t){return t&&(t.id||t.url)}function w(t,e,i){for(let n=0;n<e.length;n++){const{icon:o,xOffset:s}=e[n];t[S(o)]={...o,x:s,y:i}}}class A{constructor(t,{onUpdate:e=b,onError:i=b}){this.gl=t,this.onUpdate=e,this.onError=i,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}finalize(){var t;null===(t=this._texture)||void 0===t||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?S(t):t;return this._mapping[e]||{}}setProps({loadOptions:t,autoPacking:e,iconAtlas:i,iconMapping:n,data:o,getIcon:s}){t&&(this._loadOptions=t),void 0!==e&&(this._autoPacking=e),s&&(this._getIcon=s),n&&(this._mapping=n),i&&this._updateIconAtlas(i),this._autoPacking&&(o||s)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(o))}get isLoaded(){return 0===this._pendingCount}_updateIconAtlas(t){var e;null===(e=this._texture)||void 0===e||e.delete(),this._texture=null,this._externalTexture=t,this.onUpdate()}_updateAutoPacking(t){const e=Object.values(function(t,e,i){if(!t||!e)return null;i=i||{};const n={},{iterable:o,objectInfo:s}=Object(_.a)(t);for(const t of o){s.index++;const o=e(t,s),r=S(o);if(!o)throw new Error("Icon is missing.");if(!o.url)throw new Error("Icon url is missing.");n[r]||i[r]&&o.url===i[r].url||(n[r]={...o,source:t,sourceIndex:s.index})}return n}(t,this._getIcon,this._mapping)||{});if(e.length>0){const{mapping:t,xOffset:i,yOffset:n,rowHeight:o,canvasHeight:s}=function({icons:t,buffer:e,mapping:i={},xOffset:n=0,yOffset:o=0,rowHeight:s=0,canvasWidth:r}){let a=[];for(let l=0;l<t.length;l++){const c=t[l];if(!i[S(c)]){const{height:t,width:l}=c;n+l+e>r&&(w(i,a,o),n=0,o=s+o+e,s=0,a=[]),a.push({icon:c,xOffset:n}),n=n+l+e,s=Math.max(s,t)}}return a.length>0&&w(i,a,o),{mapping:i,rowHeight:s,xOffset:n,yOffset:o,canvasWidth:r,canvasHeight:(l=s+o+e,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:e,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=o,this._mapping=t,this._xOffset=i,this._yOffset=n,this._canvasHeight=s,this._texture||(this._texture=new v.a(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:P})),this._texture.height!==this._canvasHeight&&(this._texture=function(t,e,i,n){const o=e.width,s=e.height,r=Object(f.a)(e,{width:i,height:n});return Object(m.b)(e,r,{targetY:0,width:o,height:s}),e.delete(),r}(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(e)}}_loadIcons(t){const e=this._canvas.getContext("2d");for(const i of t)this._pendingCount++,Object(x.a)(i.url,y.a,this._loadOptions).then(t=>{const n=S(i),{x:o,y:s,width:r,height:a}=this._mapping[n],l=C(e,t,r,a);this._texture.setSubImageData({data:l,x:o,y:s,width:r,height:a}),this._texture.generateMipmap(),this.onUpdate()}).catch(t=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:t})}).finally(()=>{this._pendingCount--})}}const L=[0,0,0,255],E={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:L},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class M extends u.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,d.a]})}initializeState(){this.state={iconManager:new A(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:L},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:t,props:e,changeFlags:i}){super.updateState({props:e,oldProps:t,changeFlags:i});const n=this.getAttributeManager(),{iconAtlas:o,iconMapping:s,data:r,getIcon:a}=e,{iconManager:l}=this.state;l.setProps({loadOptions:e.loadOptions});let c=!1;if(o||this.internalState.isAsyncPropLoading("iconAtlas")?(t.iconAtlas!==e.iconAtlas&&l.setProps({iconAtlas:o,autoPacking:!1}),t.iconMapping!==e.iconMapping&&(l.setProps({iconMapping:s}),c=!0)):l.setProps({autoPacking:!0}),(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&l.setProps({data:r,getIcon:a}),c&&(n.invalidate("instanceOffsets"),n.invalidate("instanceIconFrames"),n.invalidate("instanceColorModes")),i.extensionsChanged){var u;const{gl:t}=this.context;null===(u=this.state.model)||void 0===u||u.delete(),this.state.model=this._getModel(t),n.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:o,billboard:s,alphaCutoff:r}=this.props,{iconManager:a}=this.state,{viewport:l}=this.context,c=a.getTexture();c&&this.state.model.setUniforms(t).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeScale:e*("pixels"===o?l.metersPerPixel:1),sizeMinPixels:i,sizeMaxPixels:n,billboard:s,alphaCutoff:r}).draw()}_getModel(t){return new p.a(t,{...this.getShaders(),id:this.props.id,geometry:new g.a({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){const{onIconError:e}=this.getCurrentLayer().props;e?e(t):l.a.error(t.error)()}getInstanceOffset(t){const e=this.state.iconManager.getIconMapping(t);return[e.width/2-e.anchorX||0,e.height/2-e.anchorY||0]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const e=this.state.iconManager.getIconMapping(t);return[e.x||0,e.y||0,e.width||0,e.height||0]}}M.layerName="IconLayer",M.defaultProps=E;var O=i(4740);const k=[];class z extends M{getShaders(){return{...super.getShaders(),fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float buffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  if (!picking_uActive) {\n    float alpha = texture2D(iconsTexture, vTextureCoords).a;\n    vec4 color = vColor;\n    if (sdf) {\n      float distance = alpha;\n      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);\n\n      if (outlineBuffer > 0.0) {\n        float inFill = alpha;\n        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\n        color = mix(outlineColor, vColor, inFill);\n        alpha = inBorder;\n      }\n    }\n    float a = alpha * color.a;\n    \n    if (a < alphaCutoff) {\n      discard;\n    }\n\n    gl_FragColor = vec4(color.rgb, a * opacity);\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(t,{index:e,target:i})=>this.encodePickingColor(e,i)}})}updateState(t){super.updateState(t);const{props:e,oldProps:i}=t;let{outlineColor:n}=e;n!==i.outlineColor&&(n=n.map(t=>t/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!e.sdf&&e.outlineWidth&&l.a.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(t){const{sdf:e,smoothing:i,outlineWidth:n}=this.props,{outlineColor:o}=this.state;t.uniforms={...t.uniforms,buffer:.75,outlineBuffer:n?Math.max(i,.75*(1-n)):-1,gamma:i,sdf:Boolean(e),outlineColor:o},super.draw(t)}getInstanceOffset(t){return t?Array.from(t).map(t=>super.getInstanceOffset(t)):k}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).map(t=>super.getInstanceIconFrame(t)):k}}z.layerName="MultiIconLayer",z.defaultProps={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};var T=i(4756),I=i.n(T);const R=[];function D(t,e,i,n){let o=0;for(let s=e;s<i;s++){const e=t[s];let i=null;const r=n&&n[e];r&&(i=r.width),o+=i}return o}function F(t,e,i,n,o,s){let r=e,a=0;for(let l=e;l<i;l++){const e=D(t,l,l+1,o);a+e>n&&(r<l&&s.push(l),r=l,a=0),a+=e}return a}function j(t,e,i,n,o=0,s){void 0===s&&(s=t.length);const r=[];return"break-all"===e?F(t,o,s,i,n,r):function(t,e,i,n,o,s){let r=e,a=e,l=e,c=0;for(let u=e;u<i;u++)if(" "===t[u]?l=u+1:" "!==t[u+1]&&u+1!==i||(l=u+1),l>a){let e=D(t,a,l,o);c+e>n&&(r<a&&(s.push(a),r=a,c=0),e>n&&(e=F(t,a,l,n,o,s),r=s[s.length-1])),a=l,c+=e}}(t,o,s,i,n,r),r}function N(t,e,i,n,o,s){let r=0,a=0;for(let s=e;s<i;s++){const e=t[s],i=n[e];i?(a||(a=i.height),o[s]=r+i.width/2,r+=i.width):(l.a.warn("Missing character: ".concat(e," (").concat(e.codePointAt(0),")"))(),o[s]=r,r+=32)}s[0]=r,s[1]=a}function U(t,e,i,n,o){const s=(t=Array.from(t)).length,r=new Array(s),a=new Array(s),l=new Array(s),c=("break-word"===i||"break-all"===i)&&isFinite(n)&&n>0,u=[0,0],h=[];let d=0,p=0,g=0;for(let f=0;f<=s;f++){const m=t[f];if("\n"!==m&&f!==s||(g=f),g>p){const s=c?j(t,i,n,o,p,g):R;for(let i=0;i<=s.length;i++){const n=0===i?p:s[i-1],c=i<s.length?s[i]:g;N(t,n,c,o,r,h);for(let t=n;t<c;t++)a[t]=d+h[1]/2,l[t]=h[0];d+=h[1]*e,u[0]=Math.max(u[0],h[0])}p=g}"\n"===m&&(r[p]=0,a[p]=0,l[p]=0,p++)}return u[1]=d,{x:r,y:a,rowWidth:l,size:u}}const B=function(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}(),V=new class{constructor(t=5){this.limit=t,this.clear()}clear(){this._cache={},this._order=[]}get(t){const e=this._cache[t];return e&&(this._deleteOrder(t),this._appendOrder(t)),e}set(t,e){this._cache[t]?(this.delete(t),this._cache[t]=e,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=e,this._appendOrder(t))}delete(t){this._cache[t]&&(this._deleteCache(t),this._deleteOrder(t))}_deleteCache(t){delete this._cache[t]}_deleteOrder(t){const e=this._order.findIndex(e=>e===t);e>=0&&this._order.splice(e,1)}_appendOrder(t){this._order.push(t)}}(3),W=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function G(t,e){for(let i=0;i<t.length;i++)e.data[4*i+3]=t[i]}function H(t,e,i,n){t.font="".concat(n," ").concat(i,"px ").concat(e),t.fillStyle="#000",t.textBaseline="baseline",t.textAlign="left"}class q{constructor(){this.props={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:B,fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return 1.2}setProps(t={}){W.forEach(e=>{e in t&&(this.props[e]=t[e])});const e=this._key;this._key=this._getKey();const i=function(t,e){const i=V.get(t);if(!i)return e;const n=[],o=i.mapping;let s=Object.keys(o);s=new Set(s);let r=e;return r instanceof Array&&(r=new Set(r)),r.forEach(t=>{s.has(t)||n.push(t)}),n}(this._key,this.props.characterSet),n=V.get(this._key);if(n&&0===i.length)return void(this._key!==e&&(this._atlas=n));const o=this._generateFontAtlas(this._key,i,n);this._atlas=o,V.set(this._key,o)}_generateFontAtlas(t,e,i){const{fontFamily:n,fontWeight:o,fontSize:s,buffer:r,sdf:a,radius:l,cutoff:c}=this.props;let u=i&&i.data;u||(u=document.createElement("canvas"),u.width=1024);const h=u.getContext("2d");H(h,n,s,o);const{mapping:d,canvasHeight:p,xOffset:g,yOffset:f}=function({characterSet:t,getFontWidth:e,fontHeight:i,buffer:n,maxCanvasWidth:o,mapping:s={},xOffset:r=0,yOffset:a=0}){let l=0,c=r,u=0;for(const r of t)if(!s[r]){const t=e(r,u++);c+t+2*n>o&&(c=0,l++),s[r]={x:c+n,y:a+l*(i+2*n)+n,width:t,height:i},c+=t+2*n}const h=i+2*n;return{mapping:s,xOffset:c,yOffset:a+l*h,canvasHeight:(d=a+(l+1)*h,Math.pow(2,Math.ceil(Math.log2(d))))};var d}({getFontWidth:t=>h.measureText(t).width,fontHeight:1.2*s,buffer:r,characterSet:e,maxCanvasWidth:1024,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(u.height!==p){const t=h.getImageData(0,0,u.width,u.height);u.height=p,h.putImageData(t,0,0)}if(H(h,n,s,o),a){const t=new I.a(s,r,l,c,n,o),i=h.getImageData(0,0,t.size,t.size);for(const n of e)G(t.draw(n),i),h.putImageData(i,d[n].x-r,d[n].y+r)}else for(const t of e)h.fillText(t,d[t].x,d[t].y+.9*s);return{xOffset:g,yOffset:f,mapping:d,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:t,fontWeight:e,fontSize:i,buffer:n,sdf:o,radius:s,cutoff:r}=this.props;return o?"".concat(t," ").concat(e," ").concat(i," ").concat(n," ").concat(s," ").concat(r):"".concat(t," ").concat(e," ").concat(i," ").concat(n)}}const Q={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class K extends u.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME text-background-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceRects;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec2 instancePixelOffsets;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = radians(angle);\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n  vLineWidth = instanceLineWidths;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n\n  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\n\n  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\n  pixelOffset += instancePixelOffsets;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME text-background-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying float vLineWidth;\nvarying vec2 uv;\nvarying vec2 dimensions;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec2 pixelPosition = uv * dimensions;\n  if (stroked) {\n    float distToEdge = min(\n      min(pixelPosition.x, dimensions.x - pixelPosition.x),\n      min(pixelPosition.y, dimensions.y - pixelPosition.y)\n    );\n    float isBorder = smoothedge(distToEdge, vLineWidth);\n    gl_FragColor = mix(vFillColor, vLineColor, isBorder);\n  } else {\n    gl_FragColor = vFillColor;\n  }\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,d.a]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:t,oldProps:e,changeFlags:i}){if(super.updateState({props:t,oldProps:e,changeFlags:i}),i.extensionsChanged){var n;const{gl:t}=this.context;null===(n=this.state.model)||void 0===n||n.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{billboard:i,sizeScale:n,sizeUnits:o,sizeMinPixels:s,sizeMaxPixels:r,getLineWidth:a}=this.props;let{padding:l}=this.props;const c="pixels"===o?e.metersPerPixel:1;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(t).setUniforms({billboard:i,stroked:Boolean(a),padding:l,sizeScale:n*c,sizeMinPixels:s,sizeMaxPixels:r}).draw()}_getModel(t){return new p.a(t,{...this.getShaders(),id:this.props.id,geometry:new g.a({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}K.layerName="TextBackgroundLayer",K.defaultProps=Q;const Z={fontSize:64,buffer:4,sdf:!1,radius:12,cutoff:.25,smoothing:.1},X={start:1,middle:0,end:-1},$={top:1,center:0,bottom:-1},Y=[0,0,0,255],J=["fontSize","buffer","sdf","radius","cutoff"],tt={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Y},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:B},fontFamily:"Monaco, monospace",fontWeight:"normal",lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Y},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Y},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class et extends a.a{initializeState(){this.state={styleVersion:0,fontAtlasManager:new q}}updateState({props:t,oldProps:e,changeFlags:i}){const n=i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText),o=this.state.characterSet;n&&this._updateText();const s=o!==this.state.characterSet||this._fontChanged(e,t);s&&this._updateFontAtlas(e,t),(s||t.lineHeight!==e.lineHeight||t.wordBreak!==e.wordBreak||t.maxWidth!==e.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(t,e){const{fontSettings:i,fontFamily:n,fontWeight:o}=e,{fontAtlasManager:s,characterSet:r}=this.state;s.setProps({...Z,...i,characterSet:r,fontFamily:n,fontWeight:o})}_fontChanged(t,e){if(t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight)return!0;if(t.fontSettings===e.fontSettings)return!1;const i=t.fontSettings||{},n=e.fontSettings||{};return J.some(t=>i[t]!==n[t])}_updateText(){const{data:t,characterSet:e}=this.props,i=t.attributes&&t.attributes.getText;let n,{getText:o}=this.props,{startIndices:s}=t;const r="auto"===e&&new Set;if(i&&s){const{texts:e,characterCount:a}=function({value:t,length:e,stride:i,offset:n,startIndices:o,characterSet:s}){const r=t.BYTES_PER_ELEMENT,a=i?i/r:1,l=n?n/r:0,c=o[e]||Math.ceil((t.length-l)/a),u=s&&new Set,h=new Array(e);let d=t;if(a>1||l>0){d=new t.constructor(c);for(let e=0;e<c;e++)d[e]=t[e*a+l]}for(let t=0;t<e;t++){const e=o[t],i=o[t+1]||c,n=d.subarray(e,i);h[t]=String.fromCodePoint.apply(null,n),u&&n.forEach(u.add,u)}if(u)for(const t of u)s.add(String.fromCodePoint(t));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(i)?{value:i}:i,length:t.length,startIndices:s,characterSet:r});n=a,o=(t,{index:i})=>e[i]}else{const{iterable:e,objectInfo:i}=Object(_.a)(t);s=[0],n=0;for(const t of e){i.index++;const e=Array.from(o(t,i)||"");r&&e.forEach(r.add,r),n+=e.length,s.push(n)}}this.setState({getText:o,startIndices:s,numInstances:n,characterSet:r||e})}getBoundingRect(t,e){const i=this.state.fontAtlasManager.mapping,{getText:n}=this.state,{wordBreak:o,maxWidth:s,lineHeight:r,getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=n(t,e)||"",{size:[u,h]}=U(c,r,o,s,i);return[(X["function"==typeof a?a(t,e):a]-1)*u/2,($["function"==typeof l?l(t,e):l]-1)*h/2,u,h]}getIconOffsets(t,e){const i=this.state.fontAtlasManager.mapping,{getText:n}=this.state,{wordBreak:o,maxWidth:s,lineHeight:r,getTextAnchor:a,getAlignmentBaseline:l}=this.props,c=n(t,e)||"",{x:u,y:h,rowWidth:d,size:[p,g]}=U(c,r,o,s,i),f=X["function"==typeof a?a(t,e):a],m=$["function"==typeof l?l(t,e):l],v=u.length,y=new Array(2*v);let x=0;for(let t=0;t<v;t++){const e=(1-f)*(p-d[t])/2;y[x++]=(f-1)*p/2+e+u[t],y[x++]=(m-1)*g/2+h[t]}return y}renderLayers(){const{startIndices:t,numInstances:e,getText:i,fontAtlasManager:{scale:n,texture:o,mapping:s},styleVersion:r}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:g,getBorderColor:f,getBorderWidth:m,backgroundPadding:v,background:y,billboard:x,fontSettings:_,outlineWidth:b,outlineColor:P,sizeScale:C,sizeUnits:S,sizeMinPixels:w,sizeMaxPixels:A,transitions:L,updateTriggers:E}=this.props,M=this.getSubLayerClass("characters",z),O=this.getSubLayerClass("background",K);return[y&&new O({getFillColor:g,getLineColor:f,getLineWidth:m,padding:v,getPosition:c,getSize:h,getAngle:d,getPixelOffset:p,billboard:x,sizeScale:C/this.state.fontAtlasManager.props.fontSize,sizeUnits:S,sizeMinPixels:w,sizeMaxPixels:A,transitions:L&&{getPosition:L.getPosition,getAngle:L.getAngle,getSize:L.getSize,getFillColor:L.getBackgroundColor,getLineColor:L.getBorderColor,getLineWidth:L.getBorderWidth,getPixelOffset:L.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:E.getPosition,getAngle:E.getAngle,getSize:E.getSize,getFillColor:E.getBackgroundColor,getLineColor:E.getBorderColor,getLineWidth:E.getBorderWidth,getPixelOffset:E.getPixelOffset,getBoundingRect:{getText:E.getText,getTextAnchor:E.getTextAnchor,getAlignmentBaseline:E.getAlignmentBaseline,styleVersion:r}}}),{data:a.attributes?{length:a.length,attributes:a.attributes.background||{}}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new M({sdf:_.sdf,smoothing:Number.isFinite(_.smoothing)?_.smoothing:Z.smoothing,outlineWidth:b,outlineColor:P,iconAtlas:o,iconMapping:s,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:p,billboard:x,sizeScale:C*n,sizeUnits:S,sizeMinPixels:w*n,sizeMaxPixels:A*n,transitions:L&&{getPosition:L.getPosition,getAngle:L.getAngle,getColor:L.getColor,getSize:L.getSize,getPixelOffset:L.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:E.getText,getPosition:E.getPosition,getAngle:E.getAngle,getColor:E.getColor,getSize:E.getSize,getPixelOffset:E.getPixelOffset,getIconOffsets:{getText:E.getText,getTextAnchor:E.getTextAnchor,getAlignmentBaseline:E.getAlignmentBaseline,styleVersion:r}}}),{data:a,_dataDiff:l,startIndices:t,numInstances:e,getIconOffsets:this.getIconOffsets.bind(this),getIcon:i})]}}et.layerName="TextLayer",et.defaultProps=tt;var it=i(4698),nt=i(4718);const ot={circle:{type:O.a,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:M,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:et,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},st={type:it.a,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",getLineColor:"getColor",getLineWidth:"getWidth"}},rt={type:nt.a,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function at({type:t,props:e}){const i={};for(const n in e)i[n]=t.defaultProps[e[n]];return i}function lt(t,e){const{transitions:i,updateTriggers:n}=t.props,o={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const s in e){const r=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),o.updateTriggers[r]=n[s],i&&(o.transitions[r]=i[s])),o[r]=a}return o}function ct(t,e,i={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:o=0,endRow:s=t.length}=i;for(let i=o;i<s;i++){const o=t[i];l.a.assert(o&&o.geometry,"GeoJSON does not have geometry");const{geometry:s}=o;if("GeometryCollection"===s.type){l.a.assert(Array.isArray(s.geometries),"GeoJSON does not have geometries array");const{geometries:t}=s;for(let s=0;s<t.length;s++){ut(t[s],n,e,o,i)}}else ut(s,n,e,o,i)}return n}function ut(t,e,i,n,o){const{type:s,coordinates:r}=t,{pointFeatures:a,lineFeatures:c,polygonFeatures:u,polygonOutlineFeatures:h}=e;if(function(t,e){let i=ht[t];l.a.assert(i,"Unknown GeoJSON type ".concat(t));for(;e&&--i>0;)e=e[0];return e&&Number.isFinite(e[0])}(s,r))switch(s){case"Point":a.push(i({geometry:t},n,o));break;case"MultiPoint":r.forEach(t=>{a.push(i({geometry:{type:"Point",coordinates:t}},n,o))});break;case"LineString":c.push(i({geometry:t},n,o));break;case"MultiLineString":r.forEach(t=>{c.push(i({geometry:{type:"LineString",coordinates:t}},n,o))});break;case"Polygon":u.push(i({geometry:t},n,o)),r.forEach(t=>{h.push(i({geometry:{type:"LineString",coordinates:t}},n,o))});break;case"MultiPolygon":r.forEach(t=>{u.push(i({geometry:{type:"Polygon",coordinates:t}},n,o)),t.forEach(t=>{h.push(i({geometry:{type:"LineString",coordinates:t}},n,o))})})}else l.a.warn("".concat(s," coordinates are malformed"))()}const ht={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function dt(t){return t.geometry.coordinates}function pt(t,e){const i={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:n,lines:o,polygons:s}=t,r=function(t,e){const i={points:null,lines:null,polygons:null};for(const n in i){const o=t[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(3*o.length);const s=[];for(let t=0;t<o.length;t++)e(o[t],s),i[n][3*t+0]=s[0],i[n][3*t+1]=s[1],i[n][3*t+2]=s[2]}return i}(t,e);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{getPosition:n.positions,instancePickingColors:{size:3,value:r.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:o.pathIndices.value.length-1,startIndices:o.pathIndices.value,attributes:{getPath:o.positions,instancePickingColors:{size:3,value:r.lines}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},i.lines._pathType="open",i.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{getPolygon:s.positions,pickingColors:{size:3,value:r.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygons._normalize=!1,s.triangles&&(i.polygons.data.attributes.indices=s.triangles.value),i.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{getPath:s.positions,instancePickingColors:{size:3,value:r.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygonsOutline._pathType="open",i}const gt={...at(ot.circle),...at(ot.icon),...at(ot.text),...at(st),...at(rt),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class ft extends a.a{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&l.a.removed("getLineDashArray","PathStyleExtension")()}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const i=pt(t.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:t,changeFlags:e}){const i=function(t){if(Array.isArray(t))return t;switch(l.a.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return l.a.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(t.data),n=this.getSubLayerRow.bind(this);let o={};const s={};if(Array.isArray(e.dataChanged)){const t=this.state.features;for(const e in t)o[e]=t[e].slice(),s[e]=[];for(const r of e.dataChanged){const e=ct(i,n,r);for(const i in t)s[i].push(Object(c.a)({data:o[i],getIndex:t=>t.__source.index,dataRange:r,replace:e[i]}))}}else o=ct(i,n);const r=function(t,e){const i={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:n,lineFeatures:o,polygonFeatures:s,polygonOutlineFeatures:r}=t;return i.points.data=n,i.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),i.points.getPosition=dt,i.lines.data=o,i.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),i.lines.getPath=dt,i.polygons.data=s,i.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),i.polygons.getPolygon=dt,i.polygonsOutline.data=r,i.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),i.polygonsOutline.getPath=dt,i}(o,s);this.setState({features:o,featuresDiff:s,layerProps:r})}_updateAutoHighlight(t){const e="".concat(this.id,"-points-"),i=t.sourceLayer.id.startsWith(e);for(const n of this.getSubLayers())n.id.startsWith(e)===i&&n.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:e}=this.props,{layerProps:i}=this.state,n="polygons-fill",o=this.shouldRenderSubLayer(n,i.polygons.data)&&this.getSubLayerClass(n,rt.type);if(o){const s=lt(this,rt.props),r=t&&e;return r||delete s.getLineColor,s.updateTriggers.lineColors=r,new o(s,this.getSubLayerProps({id:n,updateTriggers:s.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:e}=this.props,{layerProps:i}=this.state,n=!t&&e&&this.shouldRenderSubLayer("polygons-stroke",i.polygonsOutline.data)&&this.getSubLayerClass("polygons-stroke",st.type),o=this.shouldRenderSubLayer("linestrings",i.lines.data)&&this.getSubLayerClass("linestrings",st.type);if(n||o){const t=lt(this,st.props);return[n&&new n(t,this.getSubLayerProps({id:"polygons-stroke",updateTriggers:t.updateTriggers}),i.polygonsOutline),o&&new o(t,this.getSubLayerProps({id:"linestrings",updateTriggers:t.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:e,binary:i}=this.state;let{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=e.points.data.findIndex(t=>t.__source.index===n));const o=new Set(t.split("+")),s=[];for(const t of o){const i="points-".concat(t),o=ot[t],r=o&&this.shouldRenderSubLayer(i,e.points.data)&&this.getSubLayerClass(i,o.type);if(r){const t=lt(this,o.props);s.push(new r(t,this.getSubLayerProps({id:i,updateTriggers:t.updateTriggers,highlightedObjectIndex:n}),e.points))}}return s}renderLayers(){const{extruded:t}=this.props,e=this._renderPolygonLayer();return[!t&&e,this._renderLineLayers(),this._renderPointLayers(),t&&e]}getSubLayerAccessor(t){const{binary:e}=this.state;return e&&"function"==typeof t?(e,i)=>{const{data:n,index:o}=i,s=function(t,e){if(!t)return null;const i="startIndices"in t?t.startIndices[e]:e,n=t.featureIds.value[i];return-1!==i?function(t,e,i){const n={properties:{...t.properties[e]}};for(const e in t.numericProps)n.properties[e]=t.numericProps[e].value[i];return n}(t,n,i):null}(n,o);return t(s,i)}:super.getSubLayerAccessor(t)}}ft.layerName="GeoJsonLayer",ft.defaultProps=gt;var mt=i(4647),vt=i(4665),yt=i(4643),xt=i(4650),_t=i(4651);function bt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Pt(){return(Pt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}const Ct={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},St=(t,e)=>{const i={};return Object.keys(t).forEach(e=>{e in Ct?i[Ct[e]]=t[e]:i[e]=t[e]}),"string"==typeof t.fillColor&&(i.fillColor=Object(vt.hexToRGB)(t.fillColor)),"string"==typeof t.strokeColor&&(i.strokeColor=Object(vt.hexToRGB)(t.strokeColor)),Pt({},i,{},e)};let wt;const At=(t,e,i)=>{if(t&&t.features&&t.features.forEach(n=>{At(n,e,t.extraProps||i)}),t&&t.geometry){const n=Pt({},t,{properties:St(t.properties,e)});n.extraProps||(n.extraProps=i),wt.push(n)}};function Lt(t){return t.object.extraProps&&o.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(t.object.extraProps).map((e,i)=>o.a.createElement(_t.a,{key:"prop-"+i,label:e+": ",value:""+t.object.extraProps[e]})))}function Et(t,e,i,n){const o=t,s=o.fill_color_picker,r=o.stroke_color_picker,a=[s.r,s.g,s.b,255*s.a],l=[r.r,r.g,r.b,255*r.a],c={};let u;return a[3]>0&&(c.fillColor=a),l[3]>0&&(c.strokeColor=l),wt=[],At(e.data,c),o.js_data_mutator&&(u=Object(yt.a)(o.js_data_mutator),wt=u(wt)),new ft(Pt({id:"geojson-layer-"+o.slice_id,filled:o.filled,data:wt,stroked:o.stroked,extruded:o.extruded,pointRadiusScale:o.point_radius_scale},Object(xt.a)(o,n,Lt)))}const Mt={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func},Ot={onAddFilter(){}};class kt extends o.a.Component{constructor(){super(...arguments),bt(this,"containerRef",o.a.createRef()),bt(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)})}render(){const{formData:t,payload:e,setControlValue:i,onAddFilter:n,viewport:s}=this.props,r=Et(t,e,0,this.setTooltip);return o.a.createElement(mt.a,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:s,layers:[r],mapStyle:t.mapbox_style,setControlValue:i})}}kt.propTypes=Mt,kt.defaultProps=Ot;e.default=kt},4830:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return X}));var n=i(4723),o=i(4670),s=i(4689),r=i(4653),a=i(4652),l=i(4663),c=i(4717),u=i(4802),h=i(4739),d=i(4837),p=i(4796),g=i(4992),f=i(4803),m=i(5015);const v=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),y=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),x=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),_=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),b={POSITION:{size:3,value:new Float32Array(y)},NORMAL:{size:3,value:new Float32Array(x)},TEXCOORD_0:{size:2,value:new Float32Array(_)}};class P extends f.a{constructor(t={}){const{id:e=Object(m.c)("cube-geometry")}=t;super({...t,id:e,indices:{size:1,value:new Uint16Array(v)},attributes:{...b,...t.attributes}})}}var C=i(4835);const S={colorDomain:null,colorRange:l.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,material:!0};class w extends c.a{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec3 centroidPosition64Low = vec3(instancePositionXFP64[1], instancePositionYFP64[1], 0.0);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:[u.a,h.a,d.a,C.a]})}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({colors:{size:4,noAlloc:!0},elevations:{size:4,noAlloc:!0}});const e=this._getModel(t);this._setupUniformBuffer(e),this.setState({model:e})}_getModel(t){return new g.a(t,{...this.getShaders(),id:this.props.id,geometry:new P,isInstanced:!0})}draw({uniforms:t}){const{cellSize:e,offset:i,extruded:n,elevationScale:o,coverage:s,gridSize:r,gridOrigin:a,gridOffset:c,elevationRange:u,colorMaxMinBuffer:h,elevationMaxMinBuffer:d}=this.props,g=[Object(p.b)(a[0]),Object(p.b)(a[1])],f=[Object(p.b)(c[0]),Object(p.b)(c[1])],m=this.getDomainUniforms(),v=Object(l.a)(this.props.colorRange);this.bindUniformBuffers(h,d),this.state.model.setUniforms(t).setUniforms(m).setUniforms({cellSize:e,offset:i,extruded:n,elevationScale:o,coverage:s,gridSize:r,gridOrigin:a,gridOriginLow:g,gridOffset:c,gridOffsetLow:f,colorRange:v,elevationRange:u}).draw(),this.unbindUniformBuffers(h,d)}bindUniformBuffers(t,e){t.bind({target:35345,index:0}),e.bind({target:35345,index:1})}unbindUniformBuffers(t,e){t.unbind({target:35345,index:0}),e.unbind({target:35345,index:1})}getDomainUniforms(){const{colorDomain:t,elevationDomain:e}=this.props,i={};return null!==t?(i.colorDomainValid=!0,i.colorDomain=t):i.colorDomainValid=!1,null!==e?(i.elevationDomainValid=!0,i.elevationDomain=e):i.elevationDomainValid=!1,i}_setupUniformBuffer(t){const e=this.context.gl,i=t.program.handle,n=e.getUniformBlockIndex(i,"ColorData"),o=e.getUniformBlockIndex(i,"ElevationData");e.uniformBlockBinding(i,n,0),e.uniformBlockBinding(i,o,1)}}w.layerName="GPUGridCellLayer",w.defaultProps=S;var A=i(4679),L=i(4713),E=i(4695);const M={colorDomain:null,colorRange:l.b,getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:1,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0},O={data:{props:["cellSize","colorAggregation","elevationAggregation"]}};class k extends L.a{initializeState(){const{gl:t}=this.context,e=o.a.isSupported(t);e||r.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")(),super.initializeState({dimensions:O}),this.setState({gpuAggregation:!0,projectPoints:!1,isSupported:e,weights:{color:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new s.a(t,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})},elevation:{needMin:!0,needMax:!0,combineMaxMin:!0,maxMinBuffer:new s.a(t,{byteLength:16,accessor:{size:4,type:5126,divisor:1}})}},positionAttributeName:"positions"}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},color:{size:3,accessor:"getColorWeight"},elevation:{size:3,accessor:"getElevationWeight"}})}updateState(t){if(!1===this.state.isSupported)return;super.updateState(t);const{aggregationDirty:e}=this.state;e&&this.setState({gridHash:null})}getHashKeyForIndex(t){const{numRow:e,numCol:i,boundingBox:n,gridOffset:o}=this.state,s=[i,e],r=[n.xMin,n.yMin],a=[o.xOffset,o.yOffset],l=Math.floor(t/s[0]),c=t-l*s[0],u=Math.floor((l*a[1]+r[1]+90+a[1]/2)/a[1]),h=Math.floor((c*a[0]+r[0]+180+a[0]/2)/a[0]);return"".concat(u,"-").concat(h)}getPositionForIndex(t){const{numRow:e,numCol:i,boundingBox:n,gridOffset:o}=this.state,s=[i,e],r=[n.xMin,n.yMin],a=[o.xOffset,o.yOffset],l=Math.floor(t/s[0]);return[(t-l*s[0])*a[0]+r[0],l*a[1]+r[1]]}getPickingInfo({info:t,mode:e}){const{index:i}=t;let n=null;if(i>=0){const{gpuGridAggregator:t}=this.state,s=this.getPositionForIndex(i),r=o.a.getAggregationData({pixelIndex:i,...t.getData("color")}),a=o.a.getAggregationData({pixelIndex:i,...t.getData("elevation")});if(n={colorValue:r.cellWeight,elevationValue:a.cellWeight,count:r.cellCount||a.cellCount,position:s,totalCount:r.totalCount||a.totalCount},"hover"!==e){const{props:t}=this;let{gridHash:e}=this.state;if(!e){const{gridOffset:i,translation:n,boundingBox:o}=this.state,{viewport:s}=this.context,r=this.getAttributes();e=Object(A.a)(t,{gridOffset:i,attributes:r,viewport:s,translation:n,boundingBox:o}).gridHash,this.setState({gridHash:e})}const o=e[this.getHashKeyForIndex(i)];Object.assign(n,o)}}return t.picked=Boolean(n),t.object=n,t}renderLayers(){if(!this.state.isSupported)return null;const{elevationScale:t,extruded:e,cellSize:i,coverage:n,material:o,elevationRange:s,colorDomain:r,elevationDomain:a}=this.props,{weights:c,numRow:u,numCol:h,gridOrigin:d,gridOffset:p}=this.state,{color:g,elevation:f}=c,m=Object(l.a)(this.props.colorRange);return new(this.getSubLayerClass("gpu-grid-cell",w))({gridSize:[h,u],gridOrigin:d,gridOffset:[p.xOffset,p.yOffset],colorRange:m,elevationRange:s,colorDomain:r,elevationDomain:a,cellSize:i,coverage:n,material:o,elevationScale:t,extruded:e},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:{attributes:{colors:g.aggregationBuffer,elevations:f.aggregationBuffer}},colorMaxMinBuffer:g.maxMinBuffer,elevationMaxMinBuffer:f.maxMinBuffer,numInstances:h*u})}finalizeState(){const{color:t,elevation:e}=this.state.weights;[t,e].forEach(t=>{const{aggregationBuffer:e,maxMinBuffer:i}=t;i.delete(),null==e||e.delete()}),super.finalizeState()}updateAggregationState(t){const{props:e,oldProps:i}=t,{cellSize:n,coordinateSystem:o}=e,{viewport:s}=this.context,r=i.cellSize!==n,{dimensions:a}=this.state,l=this.isAttributeChanged("positions"),c=l||this.isAttributeChanged();let{boundingBox:u}=this.state;if(l&&(u=Object(E.a)(this.getAttributes(),this.getNumInstances()),this.setState({boundingBox:u})),l||r){const{gridOffset:t,translation:e,width:i,height:r,numCol:a,numRow:l}=Object(E.c)(u,n,s,o);this.allocateResources(l,a),this.setState({gridOffset:t,translation:e,gridOrigin:[-1*e[0],-1*e[1]],width:i,height:r,numCol:a,numRow:l})}const h=c||this.isAggregationDirty(t,{dimension:a.data,compareAll:!0});h&&this._updateAccessors(t),this.setState({aggregationDataDirty:h})}_updateAccessors(t){const{colorAggregation:e,elevationAggregation:i}=t.props,{color:n,elevation:o}=this.state.weights;n.operation=a.a[e],o.operation=a.a[i]}}k.layerName="GPUGridLayer",k.defaultProps=M;var z=i(4738);class T extends z.a{getGeometry(t){return new P}draw({uniforms:t}){const{elevationScale:e,extruded:i,offset:n,coverage:o,cellSize:s,angle:r}=this.props;this.state.model.setUniforms(t).setUniforms({radius:s/2,angle:r,offset:n,extruded:i,coverage:o,elevationScale:e,edgeDistance:1,isWireframe:!1}).draw()}}T.layerName="GridCellLayer",T.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var I=i(4714),R=i(4674);function D(){}const F={colorDomain:null,colorRange:l.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:D,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:D,gridAggregator:A.a,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},extruded:!1,material:!0,_filterData:{type:"function",value:null,optional:!0}};class j extends R.a{initializeState(){const t=new I.a({getAggregator:t=>t.gridAggregator,getCellSize:t=>t.cellSize});this.state={cpuAggregator:t,aggregatorState:t.state},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(t){super.updateState(t),this.setState({aggregatorState:this.state.cpuAggregator.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes(),numInstances:this.getNumInstances(t.props)})})}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,cellSize:i,coverage:n,material:o,transitions:s}=this.props,{cpuAggregator:r}=this.state,a=this.getSubLayerClass("grid-cell",T),l=this._getSublayerUpdateTriggers();return new a({cellSize:i,coverage:n,material:o,elevationScale:t,extruded:e,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:l}),{data:r.state.layerData.data})}}j.layerName="CPUGridLayer",j.defaultProps=F;const N={...k.defaultProps,...j.defaultProps,gpuAggregation:!1};class U extends n.a{initializeState(){this.state={useGPUAggregation:!0}}updateState({oldProps:t,props:e,changeFlags:i}){const n={};n.useGPUAggregation=this.canUseGPUAggregation(e),this.setState(n)}renderLayers(){const{data:t,updateTriggers:e}=this.props,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",k):this.getSubLayerClass("CPU",j))(this.props,this.getSubLayerProps({id:i,updateTriggers:e}),{data:t})}canUseGPUAggregation(t){const{gpuAggregation:e,lowerPercentile:i,upperPercentile:n,getColorValue:s,getElevationValue:r,colorScaleType:a}=t;return!!e&&(!!o.a.isSupported(this.context.gl)&&(0===i&&100===n&&(null===s&&null===r&&("quantile"!==a&&"ordinal"!==a))))}}U.layerName="GridLayer",U.defaultProps=N;var B=i(0),V=i.n(B),W=i(13),G=i(4650),H=i(4643),q=i(4659),Q=i(4651);function K(){return(K=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function Z(t){return V.a.createElement("div",{className:"deckgl-tooltip"},V.a.createElement(Q.a,{label:Object(W.e)("Longitude and Latitude")+": ",value:t.coordinate[0]+", "+t.coordinate[1]}),V.a.createElement(Q.a,{label:Object(W.e)("Height")+": ",value:""+t.object.elevationValue}))}function X(t,e,i,n){const o=t,s=o.color_picker;let r=e.data.features.map(t=>K({},t,{color:[s.r,s.g,s.b,255*s.a]}));if(o.js_data_mutator){r=Object(H.a)(o.js_data_mutator)(r)}const a=Object(G.b)(o.js_agg_function,t=>t.weight);return new U(K({id:"grid-layer-"+o.slice_id,data:r,pickable:!0,cellSize:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[s.r,s.g,s.b,255*s.a],outline:!1,getElevationValue:a,getColorValue:a},Object(G.a)(o,n,Z)))}e.default=Object(q.b)(X,(function(t){return t.map(t=>t.position)}))},4831:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return w}));var n=i(4653),o=i(4738),s=i(4663),r=Math.PI/3,a=[0,r,2*r,3*r,4*r,5*r];function l(t){return t[0]}function c(t){return t[1]}var u=i(4692);var h=i(4714),d=i(4674);function p(){}const g={colorDomain:null,colorRange:s.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:p,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:p,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(t,e){const{data:i,radius:o}=t,{viewport:s,attributes:h}=e,d=i.length?function(t,e){const{attributes:i}=e,n=i.positions.value,{size:o}=i.positions.getAccessor();let s,r=1/0,a=1/0,l=-1/0,c=-1/0;for(s=0;s<o*t.length;s+=o){const t=n[s],e=n[s+1];Number.isFinite(t)&&Number.isFinite(e)&&(r=Math.min(t,r),l=Math.max(t,l),a=Math.min(e,a),c=Math.max(e,c))}return[r,a,l,c].every(Number.isFinite)?[(r+l)/2,(a+c)/2]:null}(i,e):null,p=function(t,e,i){const{unitsPerMeter:n}=e.getDistanceScales(i);return t*n[0]}(o,s,d),g=[],{iterable:f,objectInfo:m}=Object(u.a)(i),v=h.positions.value,{size:y}=h.positions.getAccessor();for(const t of f){m.index++;const e=m.index*y,i=[v[e],v[e+1]];Number.isFinite(i[0])&&Number.isFinite(i[1])?g.push({screenCoord:s.projectFlat(i),source:t,index:m.index}):n.a.warn("HexagonLayer: invalid position")()}return{hexagons:function(){var t,e,i,n=0,o=0,s=1,u=1,h=l,d=c;function p(t){var n,o={},s=[],r=t.length;for(n=0;n<r;++n)if(!isNaN(l=+h.call(null,a=t[n],n,t))&&!isNaN(c=+d.call(null,a,n,t))){var a,l,c,u=Math.round(c/=i),p=Math.round(l=l/e-(1&u)/2),g=c-u;if(3*Math.abs(g)>1){var f=l-p,m=p+(l<p?-1:1)/2,v=u+(c<u?-1:1),y=l-m,x=c-v;f*f+g*g>y*y+x*x&&(p=m+(1&u?1:-1)/2,u=v)}var _=p+"-"+u,b=o[_];b?b.push(a):(s.push(b=o[_]=[a]),b.x=(p+(1&u)/2)*e,b.y=u*i)}return s}function g(t){var e=0,i=0;return a.map((function(n){var o=Math.sin(n)*t,s=-Math.cos(n)*t,r=o-e,a=s-i;return e=o,i=s,[r,a]}))}return p.hexagon=function(e){return"m"+g(null==e?t:+e).join("l")+"z"},p.centers=function(){for(var r=[],a=Math.round(o/i),l=Math.round(n/e),c=a*i;c<u+t;c+=i,++a)for(var h=l*e+(1&a)*e/2;h<s+e/2;h+=e)r.push([h,c]);return r},p.mesh=function(){var e=g(t).slice(0,4).join("l");return p.centers().map((function(t){return"M"+t+"m"+e})).join("")},p.x=function(t){return arguments.length?(h=t,p):h},p.y=function(t){return arguments.length?(d=t,p):d},p.radius=function(n){return arguments.length?(e=2*(t=+n)*Math.sin(r),i=1.5*t,p):t},p.size=function(t){return arguments.length?(n=o=0,s=+t[0],u=+t[1],p):[s-n,u-o]},p.extent=function(t){return arguments.length?(n=+t[0][0],o=+t[0][1],s=+t[1][0],u=+t[1][1],p):[[n,o],[s,u]]},p.radius(1)}().radius(p).x(t=>t.screenCoord[0]).y(t=>t.screenCoord[1])(g).map((t,e)=>({position:s.unprojectFlat([t.x,t.y]),points:t,index:e})),radiusCommon:p}},getPosition:{type:"accessor",value:t=>t.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class f extends d.a{shouldUpdateState({changeFlags:t}){return t.somethingChanged}initializeState(){const t=new h.a({getAggregator:t=>t.hexagonAggregator,getCellSize:t=>t.radius});this.state={cpuAggregator:t,aggregatorState:t.state,hexagonVertices:null},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(t){super.updateState(t);const{cpuAggregator:e,hexagonVertices:i}=this.state;t.changeFlags.propsOrDataChanged&&this.setState({aggregatorState:e.updateState(t,{viewport:this.context.viewport,attributes:this.getAttributes()})});const{hexagonVertices:n}=e.state.layerData||{};if(n&&i!==n){const t=this.convertLatLngToMeterOffset(n);t&&this.setState({hexagonVertices:n,vertices:t})}else this.updateRadiusAngle()}updateRadiusAngle(t){const{viewport:e}=this.context,{unitsPerMeter:i}=e.getDistanceScales(),{cpuAggregator:n}=this.state;if(n.state.layerData&&n.state.layerData.radiusCommon){const{radiusCommon:t}=n.state.layerData,e=t/i[0];this.setState({angle:90,radius:e})}}convertLatLngToMeterOffset(t){const{viewport:e}=this.context;if(Array.isArray(t)&&6===t.length){const i=t[0],n=t[3],o=[(i[0]+n[0])/2,(i[1]+n[1])/2],s=e.projectFlat(o),{metersPerUnit:r}=e.getDistanceScales(o);return t.map(t=>{const i=e.projectFlat(t);return[(i[0]-s[0])*r[0],(i[1]-s[1])*r[1]]})}return n.a.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:t}){return this.state.cpuAggregator.getPickingInfo({info:t})}_onGetSublayerColor(t){return this.state.cpuAggregator.getAccessor("fillColor")(t)}_onGetSublayerElevation(t){return this.state.cpuAggregator.getAccessor("elevation")(t)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:t,extruded:e,coverage:i,material:n,transitions:s}=this.props,{angle:r,radius:a,cpuAggregator:l,vertices:c}=this.state,u=this.getSubLayerClass("hexagon-cell",o.a),h=this._getSublayerUpdateTriggers();return new u({...c&&c.length?{vertices:c,radius:1}:{radius:a,angle:r},diskResolution:6,elevationScale:t,extruded:e,coverage:i,material:n,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:h}),{data:l.state.layerData.data})}}f.layerName="HexagonLayer",f.defaultProps=g;var m=i(0),v=i.n(m),y=i(13),x=i(4650),_=i(4643),b=i(4659),P=i(4651);function C(){return(C=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function S(t){return v.a.createElement("div",{className:"deckgl-tooltip"},v.a.createElement(P.a,{label:Object(y.e)("Centroid (Longitude and Latitude)")+": ",value:"("+t.coordinate[0]+", "+t.coordinate[1]+")"}),v.a.createElement(P.a,{label:Object(y.e)("Height")+": ",value:""+t.object.elevationValue}))}function w(t,e,i,n){const o=t,s=o.color_picker;let r=e.data.features.map(t=>C({},t,{color:[s.r,s.g,s.b,255*s.a]}));if(o.js_data_mutator){r=Object(_.a)(o.js_data_mutator)(r)}const a=Object(x.b)(o.js_agg_function,t=>t.weight);return new f(C({id:"hex-layer-"+o.slice_id,data:r,pickable:!0,radius:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[s.r,s.g,s.b,255*s.a],outline:!1,getElevationValue:a,getColorValue:a},Object(x.a)(o,n,S)))}e.default=Object(b.b)(w,(function(t){return t.map(t=>t.position)}))},4832:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return F}));var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(4653),l=i(4670),c=i(4652),u=i(5018),h=i(4867),d=i(4992),p=i(4803),g=i(4717),f=i(4837),m=i(4663);const v=[0,0,0,0],y=[0,255,0,255],x=["minColor","maxColor","colorRange","colorDomain"],_={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:m.b};class b extends g.a{static isSupported(t){return Object(u.c)(t,[h.a.TEXTURE_FLOAT])}getShaders(){return{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;\n\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[f.a]}}initializeState(){const{gl:t}=this.context;this.getAttributeManager().addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,noAlloc:!0}}),this.setState({model:this._getModel(t)})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({oldProps:t,props:e,changeFlags:i}){super.updateState({oldProps:t,props:e,changeFlags:i});const n=this.getAttributeManager();e.numInstances!==t.numInstances?n.invalidateAll():t.cellSizePixels!==e.cellSizePixels&&n.invalidate("instancePositions"),this._updateUniforms(t,e,i)}draw({uniforms:t}){const{parameters:e,maxTexture:i}=this.props,n=this.props.minColor||v,o=this.props.maxColor||y,s=this.props.colorDomain||[1,0],{model:r}=this.state;r.setUniforms(t).setUniforms({minColor:n,maxColor:o,maxTexture:i,colorDomain:s}).draw({parameters:{depthTest:!1,depthMask:!1,...e}})}calculateInstancePositions(t,{numInstances:e}){const{width:i,height:n}=this.context.viewport,{cellSizePixels:o}=this.props,s=Math.ceil(i/o),{value:r,size:a}=t;for(let t=0;t<e;t++){const e=t%s,l=Math.floor(t/s);r[t*a+0]=e*o/i*2-1,r[t*a+1]=1-l*o/n*2,r[t*a+2]=0}}_getModel(t){return new d.a(t,{...this.getShaders(),id:this.props.id,geometry:new p.a({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0})}_shouldUseMinMax(){const{minColor:t,maxColor:e,colorDomain:i,colorRange:n}=this.props;return t||e?(a.a.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!i&&!n}_updateUniforms(t,e,i){const{model:n}=this.state;if(x.some(i=>t[i]!==e[i])&&n.setUniforms({shouldUseMinMax:this._shouldUseMinMax()}),t.colorRange!==e.colorRange&&n.setUniforms({colorRange:Object(m.a)(e.colorRange)}),t.cellMarginPixels!==e.cellMarginPixels||t.cellSizePixels!==e.cellSizePixels||i.viewportChanged){const{width:t,height:e}=this.context.viewport,{cellSizePixels:i,cellMarginPixels:o}=this.props,s=i>o?o:0,r=new Float32Array([(i-s)/t*2,-(i-s)/e*2,1]);n.setUniforms({cellScale:r})}}}b.layerName="ScreenGridCellLayer",b.defaultProps=_;var P=i(4713),C=i(4694);const S={...b.defaultProps,getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},w={data:{props:["cellSizePixels"]},weights:{props:["aggregation"],accessors:["getWeight"]}};class A extends P.a{initializeState(){const{gl:t}=this.context;if(!b.isSupported(t))return this.setState({supported:!1}),void a.a.error("ScreenGridLayer: ".concat(this.id," is not supported on this browser"))();super.initializeState({dimensions:w,getCellSize:t=>t.cellSizePixels});const e={count:{size:1,operation:c.a.SUM,needMax:!0,maxTexture:Object(C.a)(t,{id:"".concat(this.id,"-max-texture")})}};this.setState({supported:!0,projectPoints:!0,weights:e,subLayerData:{attributes:{}},maxTexture:e.count.maxTexture,positionAttributeName:"positions",posOffset:[0,0],translation:[1,-1]}),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:5130,fp64:this.use64bitPositions()},count:{size:3,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return this.state.supported&&t.somethingChanged}updateState(t){super.updateState(t)}renderLayers(){if(!this.state.supported)return[];const{maxTexture:t,numRow:e,numCol:i,weights:n}=this.state,{updateTriggers:o}=this.props,{aggregationBuffer:s}=n.count;return new(this.getSubLayerClass("cells",b))(this.props,this.getSubLayerProps({id:"cell-layer",updateTriggers:o}),{data:{attributes:{instanceCounts:s}},maxTexture:t,numInstances:e*i})}finalizeState(){super.finalizeState();const{aggregationBuffer:t,maxBuffer:e,maxTexture:i}=this.state;null==t||t.delete(),null==e||e.delete(),null==i||i.delete()}getPickingInfo({info:t,mode:e}){const{index:i}=t;if(i>=0){const{gpuGridAggregator:e,gpuAggregation:n,weights:o}=this.state,s=n?e.getData("count"):o.count;t.object=l.a.getAggregationData({pixelIndex:i,...s})}return t}updateResults({aggregationData:t,maxData:e}){const{count:i}=this.state.weights;i.aggregationData=t,i.aggregationBuffer.setData({data:t}),i.maxData=e,i.maxTexture.setImageData({data:e})}updateAggregationState(t){const e=t.props.cellSizePixels,i=t.oldProps.cellSizePixels!==e,{viewportChanged:n}=t.changeFlags;let o=t.props.gpuAggregation;this.state.gpuAggregation!==t.props.gpuAggregation&&o&&!l.a.isSupported(this.context.gl)&&(a.a.warn("GPU Grid Aggregation not supported, falling back to CPU")(),o=!1);const s=o!==this.state.gpuAggregation;this.setState({gpuAggregation:o});const r=this.isAttributeChanged("positions"),{dimensions:c}=this.state,{data:u,weights:h}=c,d=r||s||n||this.isAggregationDirty(t,{compareAll:o,dimension:u}),p=this.isAggregationDirty(t,{dimension:h});this.setState({aggregationDataDirty:d,aggregationWeightsDirty:p});const{viewport:g}=this.context;if(n||i){const{width:t,height:i}=g,n=Math.ceil(t/e),o=Math.ceil(i/e);this.allocateResources(o,n),this.setState({scaling:[t/2,-i/2,1],gridOffset:{xOffset:e,yOffset:e},width:t,height:i,numCol:n,numRow:o})}p&&this._updateAccessors(t),(d||p)&&this._resetResults()}_updateAccessors(t){const{getWeight:e,aggregation:i,data:n}=t.props,{count:o}=this.state.weights;o&&(o.getWeight=e,o.operation=c.a[i]),this.setState({getValue:Object(c.b)(i,e,{data:n})})}_resetResults(){const{count:t}=this.state.weights;t&&(t.aggregationData=null)}}A.layerName="ScreenGridLayer",A.defaultProps=S;var L=i(13),E=i(4648),M=i(4646),O=i(4643),k=i(4650),z=i(4651),T=i(4640);function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function R(){return(R=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function D(t){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(z.a,{label:Object(L.e)("Longitude and Latitude")+": ",value:t.coordinate[0]+", "+t.coordinate[1]}),o.a.createElement(z.a,{label:Object(L.e)("Weight")+": ",value:""+t.object.weight}))}function F(t,e,i,n,o,s,r){const a=t,l=a.color_picker;let c=e.data.features.map(t=>R({},t,{color:[l.r,l.g,l.b,255*l.a]}));if(a.js_data_mutator){const t=Object(O.a)(a.js_data_mutator);c=t(c)}return null!=r&&r.forEach(t=>{c=c.filter(e=>t(e))}),new A(R({id:"screengrid-layer-"+a.slice_id,data:c,pickable:!0,cellSizePixels:a.grid_size,minColor:[l.r,l.g,l.b,0],maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getWeight:t=>t.weight||0},Object(k.a)(a,n,D)))}const j={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},N={onAddFilter(){}};class U extends o.a.PureComponent{constructor(t){super(t),I(this,"containerRef",o.a.createRef()),I(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state=U.getDerivedStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(t,e){if(e&&t.payload.form_data===e.formData)return null;const i=t.payload.data.features||[],n=i.map(t=>t.__timestamp),o=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:s,end:r,getStep:a,values:l,disabled:c}=Object(M.a)(n,o),{width:u,height:h,formData:d}=t;let{viewport:p}=t;var g;return d.autozoom&&(p=Object(T.a)(p,{width:u,height:h,points:(g=i,g.map(t=>t.position))})),{start:s,end:r,getStep:a,values:l,disabled:c,viewport:p,selected:[],lastClick:0,formData:t.payload.form_data}}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getLayers(t){const e=[];return t[0]===t[1]||t[1]===this.end?e.push(e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1]):e.push(e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]),[F(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip)]}render(){const{formData:t,payload:e,setControlValue:i}=this.props;return o.a.createElement("div",null,o.a.createElement(E.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:i,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange}))}}U.propTypes=j,U.defaultProps=N;e.default=U},4833:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return y}));var n=i(4717),o=i(4802),s=i(4837),r=i(4992),a=i(4803);const l=[0,0,0,255],c={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:l},getTargetColor:{type:"accessor",value:l},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class u extends n.a{getShaders(){return super.getShaders({vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform bool greatCircle;\nuniform bool useShortestPath;\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nfloat paraboloid(float distance, float sourceZ, float targetZ, float ratio) {\n\n  float deltaZ = targetZ - sourceZ;\n  float dh = distance * instanceHeights;\n  if (dh == 0.0) {\n    return sourceZ + deltaZ * ratio;\n  }\n  float unitZ = deltaZ / dh;\n  float p2 = unitZ * unitZ + 1.0;\n  float dir = step(deltaZ, 0.0);\n  float z0 = mix(sourceZ, targetZ, dir);\n  float r = mix(ratio, 1.0 - ratio, dir);\n  return sqrt(r * (p2 - r)) * dh + z0;\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {\n  float distance = length(source.xy - target.xy);\n  float z = paraboloid(distance, source.z, target.z, segmentRatio);\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target.xy - source.xy);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n\n  return vec3(\n    mix(source.xy, target.xy, segmentRatio) + tilt,\n    z * cos(tiltAngle)\n  );\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 sourceRadians = radians(source);\n  vec2 targetRadians = radians(target);\n  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);\n  vec2 shd_sq = sin_half_delta * sin_half_delta;\n\n  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;\n  return 2.0 * asin(sqrt(a));\n}\n\nvec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {\n  vec2 lngLat;\n  if(abs(angularDist - PI) < 0.001) {\n    lngLat = (1.0 - t) * source.xy + t * target.xy;\n  } else {\n    float a = sin((1.0 - t) * angularDist);\n    float b = sin(t * angularDist);\n    vec3 p = source3D.yxz * a + target3D.yxz * b;\n    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));\n  }\n\n  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);\n\n  return vec3(lngLat, z);\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));\n  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  isValid = 1.0;\n\n  uv = vec2(segmentRatio, positions.y);\n  geometry.uv = uv;\n  geometry.pickingColor = instancePickingColors;\n\n  vec4 curr;\n  vec4 next;\n  vec3 source;\n  vec3 target;\n\n  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));\n    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));\n    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);\n\n    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);\n    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);\n    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);\n\n    if (abs(currPos.x - prevPos.x) > 180.0) {\n      indexDir = -1.0;\n      isValid = 0.0;\n    } else if (abs(currPos.x - nextPos.x) > 180.0) {\n      indexDir = 1.0;\n      isValid = 0.0;\n    }\n    nextPos = indexDir < 0.0 ? prevPos : nextPos;\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n\n    if (isValid == 0.0) {\n      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;\n      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);\n      currPos = mix(currPos, nextPos, t);\n      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);\n    }\n\n    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);\n    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);\n  \n    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);\n    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  \n  } else {\n    vec3 source_world = instanceSourcePositions;\n    vec3 target_world = instanceTargetPositions;\n    if (useShortestPath) {\n      source_world.x = mod(source_world.x + 180., 360.0) - 180.;\n      target_world.x = mod(target_world.x + 180., 360.0) - 180.;\n\n      float deltaLng = target_world.x - source_world.x;\n      if (deltaLng > 180.) target_world.x -= 360.;\n      if (deltaLng < -180.) source_world.x -= 360.;\n    }\n    source = project_position(source_world, instanceSourcePositions64Low);\n    target = project_position(target_world, instanceTargetPositions64Low);\n    float antiMeridianX = 0.0;\n\n    if (useShortestPath) {\n      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;\n      }\n      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);\n\n      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {\n        isValid = 0.0;\n        indexDir = sign(segmentRatio - thresholdRatio);\n        segmentRatio = thresholdRatio;\n      }\n    }\n\n    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;\n    vec3 currPos = interpolateFlat(source, target, segmentRatio);\n    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);\n\n    if (useShortestPath) {\n      if (nextPos.x < antiMeridianX) {\n        currPos.x += TILE_SIZE;\n        nextPos.x += TILE_SIZE;\n      }\n    }\n\n    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n    geometry.position = vec4(currPos, 1.0);\n  }\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec3 offset = vec3(\n    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);\n  vColor = vec4(color.rgb, color.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid == 0.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  geometry.uv = uv;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[o.a,s.a]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:l},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:l},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState({props:t,oldProps:e,changeFlags:i}){if(super.updateState({props:t,oldProps:e,changeFlags:i}),i.extensionsChanged){var n;const{gl:t}=this.context;null===(n=this.state.model)||void 0===n||n.delete(),this.state.model=this._getModel(t),this.getAttributeManager().invalidateAll()}}draw({uniforms:t}){const{viewport:e}=this.context,{widthUnits:i,widthScale:n,widthMinPixels:o,widthMaxPixels:s,greatCircle:r,wrapLongitude:a}=this.props,l="pixels"===i?e.metersPerPixel:1;this.state.model.setUniforms(t).setUniforms({greatCircle:r,widthScale:n*l,widthMinPixels:o,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(t){let e=[];for(let t=0;t<50;t++)e=e.concat([t,1,0,t,-1,0]);const i=new r.a(t,{...this.getShaders(),id:this.props.id,geometry:new a.a({drawMode:5,attributes:{positions:new Float32Array(e)}}),isInstanced:!0});return i.setUniforms({numSegments:50}),i}}u.layerName="ArcLayer",u.defaultProps=c;var h=i(0),d=i.n(h),p=i(13),g=i(4650),f=i(4659),m=i(4651);function v(){return(v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function y(t,e,i,n){const o=e.data.features,s=t.color_picker,r=t.target_color_picker;return new u(v({data:o,getSourceColor:t=>t.sourceColor||t.color||[s.r,s.g,s.b,255*s.a],getTargetColor:t=>t.targetColor||t.color||[r.r,r.g,r.b,255*r.a],id:"path-layer-"+t.slice_id,strokeWidth:t.stroke_width?t.stroke_width:3},Object(g.a)(t,n,(a=t,t=>d.a.createElement("div",{className:"deckgl-tooltip"},d.a.createElement(m.a,{label:Object(p.e)("Start (Longitude, Latitude)")+": ",value:t.object.sourcePosition[0]+", "+t.object.sourcePosition[1]}),d.a.createElement(m.a,{label:Object(p.e)("End (Longitude, Latitude)")+": ",value:t.object.targetPosition[0]+", "+t.object.targetPosition[1]}),a.dimension&&d.a.createElement(m.a,{label:a.dimension+": ",value:""+t.object.cat_color}))))));var a}e.default=Object(f.a)(y,(function(t){const e=[];return t.forEach(t=>{e.push(t.sourcePosition),e.push(t.targetPosition)}),e}))},4834:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return I}));var n=i(0),o=i.n(n),s=i(2),r=i.n(s),a=i(4723),l=i(4653),c=i(4692),u=i(4718),h=i(4698),d=i(4693),p=i(4712);const g=[0,0,0,255],f={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:g},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class m extends a.a{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&l.a.removed("getLineDashArray","PathStyleExtension")()}updateState({oldProps:t,props:e,changeFlags:i}){const n=i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon);if(n&&Array.isArray(i.dataChanged)){const t=this.state.paths.slice(),e=i.dataChanged.map(e=>Object(p.a)({data:t,getIndex:t=>t.__source.index,dataRange:e,replace:this._getPaths(e)}));this.setState({paths:t,pathsDiff:e})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:e,getPolygon:i,positionFormat:n,_normalize:o}=this.props,s=[],r="XY"===n?2:3,{startRow:a,endRow:l}=t,{iterable:u,objectInfo:h}=Object(c.a)(e,a,l);for(const t of u){h.index++;let e=i(t,h);o&&(e=d.b(e,r));const{holeIndices:n}=e,a=e.positions||e;if(n)for(let e=0;e<=n.length;e++){const i=a.slice(n[e-1]||0,n[e]||a.length);s.push(this.getSubLayerRow({path:i},t,h.index))}else s.push(this.getSubLayerRow({path:a},t,h.index))}return s}renderLayers(){const{data:t,_dataDiff:e,stroked:i,filled:n,extruded:o,wireframe:s,_normalize:r,_windingOrder:a,elevationScale:l,transitions:c,positionFormat:d}=this.props,{lineWidthUnits:p,lineWidthScale:f,lineWidthMinPixels:m,lineWidthMaxPixels:v,lineJointRounded:y,lineMiterLimit:x,lineDashJustified:_}=this.props,{getFillColor:b,getLineColor:P,getLineWidth:C,getLineDashArray:S,getElevation:w,getPolygon:A,updateTriggers:L,material:E}=this.props,{paths:M,pathsDiff:O}=this.state,k=this.getSubLayerClass("fill",u.a),z=this.getSubLayerClass("stroke",h.a),T=this.shouldRenderSubLayer("fill",M)&&new k({_dataDiff:e,extruded:o,elevationScale:l,filled:n,wireframe:s,_normalize:r,_windingOrder:a,getElevation:w,getFillColor:b,getLineColor:o&&s?P:g,material:E,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:L.getPolygon,getElevation:L.getElevation,getFillColor:L.getFillColor,lineColors:o&&s,getLineColor:L.getLineColor}}),{data:t,positionFormat:d,getPolygon:A});return[!o&&T,!o&&i&&this.shouldRenderSubLayer("stroke",M)&&new z({_dataDiff:O&&(()=>O),widthUnits:p,widthScale:f,widthMinPixels:m,widthMaxPixels:v,jointRounded:y,miterLimit:x,dashJustified:_,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(P),getWidth:this.getSubLayerAccessor(C),getDashArray:this.getSubLayerAccessor(S)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:L.getLineWidth,getColor:L.getLineColor,getDashArray:L.getLineDashArray}}),{data:M,positionFormat:d,getPath:t=>t.path}),o&&T]}}m.layerName="PolygonLayer",m.defaultProps=f;var v=i(4648),y=i(4661),x=i(4651),_=i(167),b=i(4631),P=i(384),C=i(598),S=i(4665);function w(t,e,i){let{break_points:n,num_buckets:o}=t;if(!e)return[];if(void 0===n||0===n.length){const t=o?parseInt(o,10):10,[n,s]=Object(_.extent)(e,i);if(void 0===n)return[];const r=(s-n)/t,a=0===r?0:Math.max(0,Math.ceil(Math.log10(1/r))),l=s>s.toFixed(a)?1:0;return new Array(t+1+l).fill().map((t,e)=>(n+e*r).toFixed(a))}return n.sort((t,e)=>parseFloat(t)-parseFloat(e))}function A(t,e,i){let{break_points:n,num_buckets:o,linear_color_scheme:s,opacity:r}=t;const a=n||o?w({break_points:n,num_buckets:o},e,i):null,l=Array.isArray(s)?new P.a({colors:s,id:"custom"}):Object(C.a)().get(s);let c,u;if(null!==a){const t=a.length-1,e=t>1?l.getColors(t):[l.colors[l.colors.length-1]],i=e[0],n=e[e.length-1];e.unshift(i),e.push(n);const o=a.map(t=>parseFloat(t));c=Object(b.a)().domain(o).range(e),u=e=>e>a[t]||e<a[0]}else c=l.createLinearScale(Object(_.extent)(e,i)),u=()=>!1;return t=>{const e=i(t),n=Object(S.hexToRGB)(c(e));return u(e)?n[3]=0:n[3]=r/100*255,n}}var L=i(4650),E=i(4646),M=i(4643);function O(t){return"geometry"in t.polygon?t.polygon.geometry.coordinates[0]:t.polygon}var k=i(4640);function z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function T(){return(T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function I(t,e,i,n,s,r,a){const l=t,c=l.fill_color_picker,u=l.stroke_color_picker;let h=[...e.data.features];if(null!=a&&a.forEach(t=>{h=h.filter(e=>t(e))}),l.js_data_mutator){const t=Object(M.a)(l.js_data_mutator);h=t(h)}const d=l.metric?l.metric.label||l.metric:null,p=null===l.metric?()=>[c.r,c.g,c.b,255*c.a]:A(l,h,t=>t[d]),g=t=>{const e=p(t);return s.length>0&&!s.includes(t[l.line_column])&&(e[3]/=2),e},f=l.line_column&&l.metric&&["json","geohash","zipcode"].includes(l.line_type)?function(t){return e=>{const i=t.metric.label||t.metric;return o.a.createElement("div",{className:"deckgl-tooltip"},e.object.name&&o.a.createElement(x.a,{label:"name: ",value:""+e.object.name}),e.object[t.line_column]&&o.a.createElement(x.a,{label:t.line_column+": ",value:""+e.object[t.line_column]}),t.metric&&o.a.createElement(x.a,{label:i+": ",value:""+e.object[i]}))}}(l):void 0;return new m(T({id:"path-layer-"+l.slice_id,data:h,pickable:!0,filled:l.filled,stroked:l.stroked,getPolygon:O,getFillColor:g,getLineColor:[u.r,u.g,u.b,255*u.a],getLineWidth:l.line_width,extruded:l.extruded,getElevation:t=>function(t,e){return 0===e(t)[3]?0:t.elevation}(t,g),elevationScale:l.multiplier,fp64:!0},Object(L.a)(l,n,f,r)))}const R={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},D={onAddFilter(){}};class F extends o.a.Component{constructor(t){super(t),z(this,"containerRef",o.a.createRef()),z(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state=F.getDerivedStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onSelect=this.onSelect.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(t,e){const{width:i,height:n,formData:o,payload:s}=t;if(e&&s.form_data===e.formData)return null;const r=s.data.features||[],a=r.map(t=>t.__timestamp),l=s.form_data.time_grain_sqla||s.form_data.granularity||"P1D",{start:c,end:u,getStep:h,values:d,disabled:p}=Object(E.a)(a,l);let{viewport:g}=t;return o.autozoom&&(g=Object(k.a)(g,{width:i,height:n,points:r.flatMap(O)})),{start:c,end:u,getStep:h,values:d,disabled:p,viewport:g,selected:[],lastClick:0,formData:s.form_data}}onSelect(t){const{formData:e,onAddFilter:i}=this.props,n=new Date,o=n-this.state.lastClick<=250,s=[...this.state.selected];if(o)s.splice(0,s.length,t);else if(e.toggle_polygons){const e=s.indexOf(t);-1===e?s.push(t):s.splice(e,1)}else s.splice(0,1,t);this.setState({selected:s,lastClick:n}),e.table_filter&&i(e.line_column,s,!1,!0)}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getLayers(t){if(void 0===this.props.payload.data.features)return[];const e=[];return t[0]===t[1]||t[1]===this.end?e.push(e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1]):e.push(e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]),[I(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip,this.state.selected,this.onSelect,e)]}render(){const{payload:t,formData:e,setControlValue:i}=this.props,{start:n,end:s,getStep:r,values:a,disabled:l,viewport:c}=this.state,u=e,h=u.metric?u.metric.label||u.metric:null,d=function(t,e,i){const n=w(t,e,i),o=A(t,e,i),s={};return n.slice(1).forEach((e,i)=>{const r=n[i]+" - "+n[i+1],a=.5*(parseFloat(n[i])+parseFloat(n[i+1])),l=t.metric?t.metric.label||t.metric:null;s[r]={color:o({[l||t.metric]:a}),enabled:!0}}),s}(e,t.data.features,t=>t[h]);return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(v.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:n,end:s,getStep:r,values:a,disabled:l,viewport:c,width:this.props.width,height:this.props.height,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:e.mapbox_style,setControlValue:i,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange},null!==e.metric&&o.a.createElement(y.a,{categories:d,position:e.legend_position,format:e.legend_format})))}}F.propTypes=R,F.defaultProps=D;e.default=F},4835:function(t,e,i){"use strict";function n(t,e=[],i=0){const n=Math.fround(t),o=t-n;return e[i]=n,e[i+1]=o,e}function o(t){return t-Math.fround(t)}function s(t){const e=new Float32Array(32);for(let i=0;i<4;++i)for(let o=0;o<4;++o){const s=4*i+o;n(t[4*o+i],e,2*s)}return e}i.d(e,"a",(function(){return a}));const r={ONE:1};const a={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",fs:null,getUniforms:function(){return r},fp64ify:n,fp64LowPart:o,fp64ifyMatrix4:s}},4836:function(t,e,i){"use strict";i.r(e),i.d(e,"getLayer",(function(){return h}));var n=i(4740),o=i(0),s=i.n(o),r=i(13),a=i(4650),l=i(4659),c=i(4651);function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function h(t,e,i,o){const l=t,h=e.data.features.map(t=>{let e=(i=l.point_unit,n=t.radius,("square_m"===i?Math.sqrt(n/Math.PI):"radius_m"===i?n:"radius_km"===i?1e3*n:"radius_miles"===i?1609.34*n:"square_km"===i?1e3*Math.sqrt(n/Math.PI):"square_miles"===i?1609.34*Math.sqrt(n/Math.PI):null)||10);var i,n;if(l.multiplier&&(e*=l.multiplier),t.color)return u({},t,{radius:e});const o=l.color_picker||{r:0,g:0,b:0,a:1};return u({},t,{radius:e,color:[o.r,o.g,o.b,255*o.a]})});return new n.a(u({id:"scatter-layer-"+l.slice_id,data:h,fp64:!0,getFillColor:t=>t.color,getRadius:t=>t.radius,radiusMinPixels:l.min_radius||null,radiusMaxPixels:l.max_radius||null,stroked:!1},Object(a.a)(l,o,function(t){return e=>s.a.createElement("div",{className:"deckgl-tooltip"},s.a.createElement(c.a,{label:Object(r.e)("Longitude and Latitude")+": ",value:e.object.position[0]+", "+e.object.position[1]}),e.object.cat_color&&s.a.createElement(c.a,{label:Object(r.e)("Category")+": ",value:""+e.object.cat_color}),e.object.metric&&s.a.createElement(c.a,{label:t.point_radius_fixed.value.label+": ",value:""+e.object.metric}))}(l))))}e.default=Object(l.a)(h,(function(t){return t.map(t=>t.position)}))},5065:function(t,e,i){"use strict";i.r(e);var n=i(0),o=i.n(n),s=i(134),r=i.n(s),a=i(2),l=i.n(a),c=i(66),u=i(4647),h=i(303),d=i.n(h);function p(t,e,i,n){if(void 0===i&&(i=!0),void 0===n&&(n={}),!t.datasource)return null;const o=new d.a("/"),s=function(t,e){void 0===e&&(e="base");let i="/superset/explore/";return["json","csv","query","results","samples"].includes(e)&&(i="/superset/explore_json/"),i}(0,e),r=o.search(!0);Object.keys(n).forEach(t=>{r[t]=n[t]}),r.form_data=function(t){const e=new Set;return JSON.stringify(t,(t,i)=>{if("object"==typeof i&&null!==i){if(e.has(i))try{return JSON.parse(JSON.stringify(i))}catch(t){return}e.add(i)}return i})}(t),"standalone"===e&&(r.standalone="true");const a=o.directory(s).search(r).toString();if(!i&&a.length>8e3){return p({datasource:t.datasource,viz_type:t.viz_type},e,!1,{URL_IS_TOO_LONG_TO_SHARE:null})}return a}var g=i(4830),f=i(4832),m=i(4804),v=i(4831),y=i(4836),x=i(4829),_=i(4833),b=i(4834);var P={deck_grid:g.getLayer,deck_screengrid:f.getLayer,deck_path:m.getLayer,deck_hex:v.getLayer,deck_scatter:y.getLayer,deck_geojson:x.getLayer,deck_arc:_.getLayer,deck_polygon:b.getLayer};function C(){return(C=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const w={formData:l.a.object.isRequired,payload:l.a.object.isRequired,setControlValue:l.a.func.isRequired,viewport:l.a.object.isRequired,onAddFilter:l.a.func,onSelect:l.a.func},A={onAddFilter(){},onSelect(){}};class L extends o.a.PureComponent{constructor(t){super(t),S(this,"containerRef",o.a.createRef()),S(this,"setTooltip",t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}),this.state={subSlicesLayers:{}},this.onViewportChange=this.onViewportChange.bind(this)}componentDidMount(){const{formData:t,payload:e}=this.props;this.loadLayers(t,e)}UNSAFE_componentWillReceiveProps(t){const{formData:e,payload:i}=t;!r.a.isEqual(this.props.formData.deck_slices,t.formData.deck_slices)&&this.loadLayers(e,i)}onViewportChange(t){this.setState({viewport:t})}loadLayers(t,e,i){this.setState({subSlicesLayers:{},viewport:i}),e.data.slices.forEach(e=>{const i=[...e.form_data.filters||[],...t.filters||[],...t.extra_filters||[]],n=C({},e,{form_data:C({},e.form_data,{filters:i})});c.a.get({endpoint:p(n.form_data,"json")}).then(t=>{let{json:e}=t;const i=P[n.form_data.viz_type](n.form_data,e,this.props.onAddFilter,this.setTooltip,[],this.props.onSelect);this.setState({subSlicesLayers:C({},this.state.subSlicesLayers,{[n.slice_id]:i})})}).catch(()=>{})})}render(){const{payload:t,formData:e,setControlValue:i}=this.props,{subSlicesLayers:n}=this.state,s=Object.values(n);return o.a.createElement(u.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:this.state.viewport||this.props.viewport,layers:s,mapStyle:e.mapbox_style,setControlValue:i,onViewportChange:this.onViewportChange})}}L.propTypes=w,L.defaultProps=A;e.default=L},722:function(t,e,i){(function(t,n){var o;!function(s){e&&e.nodeType,t&&t.nodeType;var r="object"==typeof n&&n;r.global!==r&&r.window!==r&&r.self;var a,l=2147483647,c=/^xn--/,u=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,g=String.fromCharCode;function f(t){throw new RangeError(d[t])}function m(t,e){for(var i=t.length,n=[];i--;)n[i]=e(t[i]);return n}function v(t,e){var i=t.split("@"),n="";return i.length>1&&(n=i[0]+"@",t=i[1]),n+m((t=t.replace(h,".")).split("."),e).join(".")}function y(t){for(var e,i,n=[],o=0,s=t.length;o<s;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<s?56320==(64512&(i=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&i)+65536):(n.push(e),o--):n.push(e);return n}function x(t){return m(t,(function(t){var e="";return t>65535&&(e+=g((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=g(t)})).join("")}function _(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function b(t,e,i){var n=0;for(t=i?p(t/700):t>>1,t+=p(t/e);t>455;n+=36)t=p(t/35);return p(n+36*t/(t+38))}function P(t){var e,i,n,o,s,r,a,c,u,h,d,g=[],m=t.length,v=0,y=128,_=72;for((i=t.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)t.charCodeAt(n)>=128&&f("not-basic"),g.push(t.charCodeAt(n));for(o=i>0?i+1:0;o<m;){for(s=v,r=1,a=36;o>=m&&f("invalid-input"),((c=(d=t.charCodeAt(o++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||c>p((l-v)/r))&&f("overflow"),v+=c*r,!(c<(u=a<=_?1:a>=_+26?26:a-_));a+=36)r>p(l/(h=36-u))&&f("overflow"),r*=h;_=b(v-s,e=g.length+1,0==s),p(v/e)>l-y&&f("overflow"),y+=p(v/e),v%=e,g.splice(v++,0,y)}return x(g)}function C(t){var e,i,n,o,s,r,a,c,u,h,d,m,v,x,P,C=[];for(m=(t=y(t)).length,e=128,i=0,s=72,r=0;r<m;++r)(d=t[r])<128&&C.push(g(d));for(n=o=C.length,o&&C.push("-");n<m;){for(a=l,r=0;r<m;++r)(d=t[r])>=e&&d<a&&(a=d);for(a-e>p((l-i)/(v=n+1))&&f("overflow"),i+=(a-e)*v,e=a,r=0;r<m;++r)if((d=t[r])<e&&++i>l&&f("overflow"),d==e){for(c=i,u=36;!(c<(h=u<=s?1:u>=s+26?26:u-s));u+=36)P=c-h,x=36-h,C.push(g(_(h+P%x,0))),c=p(P/x);C.push(g(_(c,0))),s=b(i,v,n==o),i=0,++n}++i,++e}return C.join("")}a={version:"1.3.2",ucs2:{decode:y,encode:x},decode:P,encode:C,toASCII:function(t){return v(t,(function(t){return u.test(t)?"xn--"+C(t):t}))},toUnicode:function(t){return v(t,(function(t){return c.test(t)?P(t.slice(4).toLowerCase()):t}))}},void 0===(o=function(){return a}.call(e,i,e,t))||(t.exports=o)}()}).call(this,i(235)(t),i(179))},723:function(t,e,i){var n,o;!function(s,r){"use strict";t.exports?t.exports=r():void 0===(o="function"==typeof(n=r)?n.call(e,i,e,t):n)||(t.exports=o)}(0,(function(t){"use strict";var e=t&&t.IPv6;return{best:function(t){var e,i,n=t.toLowerCase().split(":"),o=n.length,s=8;for(""===n[0]&&""===n[1]&&""===n[2]?(n.shift(),n.shift()):""===n[0]&&""===n[1]?n.shift():""===n[o-1]&&""===n[o-2]&&n.pop(),-1!==n[(o=n.length)-1].indexOf(".")&&(s=7),e=0;e<o&&""!==n[e];e++);if(e<s)for(n.splice(e,1,"0000");n.length<s;)n.splice(e,0,"0000");for(var r=0;r<s;r++){i=n[r].split("");for(var a=0;a<3&&("0"===i[0]&&i.length>1);a++)i.splice(0,1);n[r]=i.join("")}var l=-1,c=0,u=0,h=-1,d=!1;for(r=0;r<s;r++)d?"0"===n[r]?u+=1:(d=!1,u>c&&(l=h,c=u)):"0"===n[r]&&(d=!0,h=r,u=1);u>c&&(l=h,c=u),c>1&&n.splice(l,c,""),o=n.length;var p="";for(""===n[0]&&(p=":"),r=0;r<o&&(p+=n[r],r!==o-1);r++)p+=":";return""===n[o-1]&&(p+=":"),p},noConflict:function(){return t.IPv6===this&&(t.IPv6=e),this}}}))},724:function(t,e,i){var n,o;!function(s,r){"use strict";t.exports?t.exports=r():void 0===(o="function"==typeof(n=r)?n.call(e,i,e,t):n)||(t.exports=o)}(0,(function(t){"use strict";var e=t&&t.SecondLevelDomains,i={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return!1;var n=t.lastIndexOf(".",e-1);if(n<=0||n>=e-1)return!1;var o=i.list[t.slice(e+1)];return!!o&&o.indexOf(" "+t.slice(n+1,e)+" ")>=0},is:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return!1;if(t.lastIndexOf(".",e-1)>=0)return!1;var n=i.list[t.slice(e+1)];return!!n&&n.indexOf(" "+t.slice(0,e)+" ")>=0},get:function(t){var e=t.lastIndexOf(".");if(e<=0||e>=t.length-1)return null;var n=t.lastIndexOf(".",e-1);if(n<=0||n>=e-1)return null;var o=i.list[t.slice(e+1)];return o?o.indexOf(" "+t.slice(n+1,e)+" ")<0?null:t.slice(n+1):null},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return i}))}}]);